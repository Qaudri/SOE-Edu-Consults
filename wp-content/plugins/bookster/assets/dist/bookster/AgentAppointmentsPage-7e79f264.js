import{R as e,f as t,h as a,_ as n,c as r,a as l,I as s,b as o,r as i,L as c}from"./prefetch.helper-04349684.js";import{A as m,a as b,b as p}from"./ApptsFilterService-c1f460fc.js";import{A as u,a as w,u as d,i as g,b as E,c as y,R as x}from"./ReloadButton-f13d4c5e.js";import{N as f}from"./CalendarNav.styled-cb1aebbc.js";import{a as h,P as C}from"./UIComponents-7ff4460b.js";import{A as v}from"./AgentAppointmentFormDrawer-da983b4b.js";import{a as k,c as N,d as _,u as S,q as T,e as j}from"./page-agent.js";import{f as A,u as P}from"./BEConfigProvider-705eafe2.js";import{s as R,i as F,b as M,c as q,d as L,p as I,t as O,a as D}from"./apptDataTable-a0a4fccd.js";import"./useCacheCustomers-102bfcf8.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./appointment.helper-07645f99.js";import"./store-bdc614dc.js";import"./ReloadButton-117ef334.js";import"./BackendRouteErrorElement-6f34d3c9.js";import"./lodash-f550b173.js";function K(){return e.createElement(e.Fragment,null,e.createElement(u,null),e.createElement(m,null),e.createElement(w,null),e.createElement(b,null),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.BeforeApptsFilterClear,[]))}function H({appt:t,queryClient:a}){return A.writeAppt?e.createElement(B,{appt:t,queryClient:a}):e.createElement(Q,{bookStatus:t.book_status})}function B({appt:t,queryClient:s}){const o=t.book_status,i=a(o),{agent_id:c}=k(),{toast:m}=n.useToast(),b=r.useMutation({mutationKey:["appointments",t.appointment_id,"updateStatus"],mutationFn:({id:e,status:t})=>N(c,e,t),onSuccess:e=>{s.invalidateQueries({queryKey:["appointment",{id:e.appointment_id}]}),s.invalidateQueries({queryKey:["appointments"]})}});return e.createElement(n.Select,{value:o,onValueChange:async function(e){if(!b.isLoading)try{await b.mutateAsync({id:t.appointment_id,status:e}),m.success("Appointment has been Saved Successfully!")}catch(a){m.error(await r.getErrorMsg(a))}}},e.createElement(n.Tooltip,{content:i,side:"left"},e.createElement(n.SelectTrigger,{size:"medium",className:"bw-w-[60px] bw-ps-2.5 hover:bw-border-gray-100 focus:bw-border-gray-100 [&>span]:bw-justify-start",withStatus:!1,onClick:e=>{e.stopPropagation()}},b.isLoading?e.createElement(l.Loader2,{className:"bw-h-3.5 bw-w-3.5 bw-animate-spin bw-text-gray-500"}):e.createElement(e.Fragment,null,"pending"===o&&e.createElement(l.Pending,{className:"bw-h-3.5 bw-w-3.5 bw-text-warning"}),"approved"===o&&e.createElement(l.CheckCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-success"}),"canceled"===o&&e.createElement(l.XCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-error"})))),e.createElement(n.SelectContent,{align:"end"},e.createElement(n.SelectGroup,null,e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"pending"},e.createElement(l.Pending,{className:"bw-text-warning"})," ",a("pending")),e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"approved"},e.createElement(l.CheckCircle,{className:"bw-text-success"})," ",a("approved")),e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"canceled"},e.createElement(l.XCircle,{className:"bw-text-error"})," ",a("canceled")))))}function Q({bookStatus:t}){const a=s(t);return e.createElement(n.Badge,{variant:"outline",color:"warning",size:"large"},a)}const z=[R,F,M,q,L,r.createColumnHelper().accessor("book_status",{id:"status",size:60,header:o.__("Status","bookster"),cell:({getValue:t,row:a,table:n})=>{const r=n.options.meta;return(null==r?void 0:r.queryClient)?e.createElement(H,{appt:a.original,queryClient:r.queryClient}):t()}}),I,O,D];function $({appts:t}){const{agent_id:s}=k(),{toast:o}=n.useToast(),c=r.useQueryClient(),m=i.useMemo((()=>t.map((e=>e.appointment_id))),[t]),b=i.useMemo((()=>{if(0===t.length)return;const e=t.map((e=>e.book_status));return e.some((t=>t!==e[0]))?void 0:e[0]}),[t]),p=r.useIsMutating({mutationKey:["appointments"]}),u=r.useMutation({mutationKey:["appointments",m,"updateStatus"],mutationFn:({ids:e,bookStatus:t})=>_(s,e,{book_status:t}),onSuccess:()=>{c.invalidateQueries({queryKey:["appointment"]}),c.invalidateQueries({queryKey:["appointments"]})}});return e.createElement(n.Select,{value:b,onValueChange:async function(e){if(m&&0!==m.length&&!p)try{await u.mutateAsync({ids:m,bookStatus:e}),o.success("Appointment Rows has been Updated Successfully!")}catch(t){o.error(await r.getErrorMsg(t))}}},e.createElement(n.SelectTrigger,{size:"medium",className:"bw-w-[60px] bw-ps-2.5 hover:bw-border-gray-100 focus:bw-border-gray-100 [&>span]:bw-justify-start",withStatus:!1,onClick:e=>{e.stopPropagation()}},u.isLoading?e.createElement(l.Loader2,{className:"bw-h-3.5 bw-w-3.5 bw-animate-spin bw-text-gray-500"}):e.createElement(e.Fragment,null,void 0===b&&e.createElement(l.Circle,{className:"bw-h-3.5 bw-w-3.5 bw-text-gray-500"}),"pending"===b&&e.createElement(l.Pending,{className:"bw-h-3.5 bw-w-3.5 bw-text-warning"}),"approved"===b&&e.createElement(l.CheckCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-success"}),"canceled"===b&&e.createElement(l.XCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-error"}))),e.createElement(n.SelectContent,{align:"end",side:"top",sideOffset:10},e.createElement(n.SelectGroup,null,e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"pending"},e.createElement(l.Pending,{className:"bw-text-warning"})," ",a("pending")),e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"approved"},e.createElement(l.CheckCircle,{className:"bw-text-success"})," ",a("approved")),e.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"canceled"},e.createElement(l.XCircle,{className:"bw-text-error"})," ",a("canceled")))))}function V(){const a=S((e=>e.appointments.ui.order)),l=i.useMemo((()=>["select","appointment_id",...a,"actions"]),[a]),s=S((e=>e.appointments.ui.hidden)),c=i.useMemo((()=>s.reduce(((e,t)=>(e[t]=!1,e)),{select:A.writeAppt})),[l,s]),m=i.useMemo((()=>[]),[]),[b,p]=i.useState({}),{pagination:u,setPagination:w,pagingPayload:E}=r.usePagination(),y={...E,...d()},{agent_id:x}=k(),f=r.useQueryClient(),h=P(),{data:C,isLoading:v}=r.useQuery({queryKey:["appointments",y],queryFn:()=>T(x,y),keepPreviousData:!0}),N=i.useMemo((()=>t.booksterHooks.applyFilters(t.HOOK_NAMES.agentApptList.apptColumnDefs,z)),[]),_=r.useReactTable({data:(null==C?void 0:C.data)||m,columns:N,getRowId:e=>e.appointment_id.toString(),getCoreRowModel:r.getCoreRowModel(),state:{pagination:u,rowSelection:b,columnOrder:l,columnVisibility:c},onPaginationChange:w,onRowSelectionChange:p,manualPagination:!0,rowCount:null==C?void 0:C.total,autoResetPageIndex:!1,meta:{queryClient:f}});return n.useRemoveSelectOnChange(_,(e=>e.appointment_id.toString()),C),n.useResetPageOnOverflow(_,C),e.createElement(e.Fragment,null,e.createElement(n.Table,null,e.createElement(n.TableHeader,null,e.createElement(n.TableHeadRow,null,_.getLeafHeaders().map((t=>e.createElement(n.TableHead,{key:t.id,style:{width:`${t.column.getSize()}px`}},r.flexRender(t.column.columnDef.header,t.getContext())))))),e.createElement(n.TableBody,null,_.getRowModel().rows.map((t=>e.createElement(n.TableRow,{key:t.original.appointment_id,isSelected:t.getIsSelected(),onClick:()=>{var e;const a=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString();var n;(null==a?void 0:a.length)||g(f,t.original.appointment_id)||(n=t.original,f.setQueryData(["appointment",n.appointment_id],n),h(`${n.appointment_id}`))}},t.getVisibleCells().map((t=>e.createElement(n.TableCell,{key:t.id,style:{width:`${t.column.getSize()}px`}},r.flexRender(t.column.columnDef.cell,t.getContext()))))))),(v||0===(null==C?void 0:C.data.length))&&e.createElement(n.TableRow,{className:"bw-pointer-events-none"},e.createElement(n.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},e.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-gray-500"},v?`${o.__("Loading","bookster")}...`:o.__("No Data Found","bookster")))))),e.createElement(n.Pagination,{table:_}),e.createElement(n.TableToaster,null,e.createElement(n.TableToast,{open:Object.keys(b).length>0,onOpenChange:e=>{e||_.resetRowSelection()}},e.createElement(n.TableToastClose,null),e.createElement(n.TableToastTitle,null,Object.keys(b).length," ",o.__("Selected","bookster")),A.writeAppt&&e.createElement(e.Fragment,null,e.createElement(n.Separator,{orientation:"vertical"}),e.createElement($,{appts:_.getSelectedRowModel().rows.map((e=>e.original))})))))}function X({className:a,...s}){const i=S((e=>e.appointments.ui.hidden)),m=S((e=>e.appointments.ui.order)),b=S((e=>e.hideAppointmentColumn)),p=S((e=>e.showAppointmentColumn)),u=S((e=>e.moveAppointmentColumnUp)),w=S((e=>e.moveAppointmentColumnDown)),d=S((e=>e.persistAppointmentColsForAgent)),[g]=r.useAutoAnimate();return e.createElement(n.Popover,null,e.createElement(n.PopoverTrigger,{asChild:!0,onClick:e=>e.stopPropagation()},e.createElement(n.Button,{variant:"trivial",className:n.cx("bw-bg-white bw-px-2",a),...s},e.createElement(l.SlidersHorizontal,null),o.__("Columns","bookster"))),e.createElement(n.PopoverPortal,{forceMount:!0},e.createElement(n.PopoverContent,{className:"bw-min-w-[15rem] data-[state=closed]:bw-hidden",align:"end",side:"bottom"},e.createElement("div",{ref:g,className:"bw-flex bw-flex-col bw-gap-2.5"},m.map(((a,r)=>{const s=!i.includes(a),g=`bw-col-toggle_${a}`,E=function(e){let a;switch(e){case"service":a=c.service;break;case"customer":a=c.customer;break;case"status":a=o.__("Status","bookster");break;case"payment":a=o.__("Payment","bookster");break;case"total":a=o.__("Total","bookster");break;case"book_time":a=o.__("Date / Time","bookster");break;default:a=e}return t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.columnToggleLabel,a,e)}(a);return e.createElement("div",{key:a,className:"bw-flex bw-items-center bw-gap-3"},e.createElement(n.Checkbox,{id:g,checked:s,onCheckedChange:e=>{!0===e?p(a):b(a),d()}}),e.createElement(n.Label,{htmlFor:g,className:"bw-me-auto bw-cursor-pointer"},E),e.createElement("div",{className:"bw-flex bw-items-center bw-gap-1"},e.createElement(n.Button,{className:"bw-h-4 bw-border-none bw-p-0 disabled:bw-text-gray-300",onClick:()=>{u(a),d()},variant:"link",disabled:0===r},e.createElement(l.ChevronUp,{className:"bw-h-2.5 bw-w-2.5 bw-cursor-pointer",strokeWidth:"4"})),e.createElement(n.Button,{className:"bw-ms-2 bw-h-4 bw-border-none bw-p-0 disabled:bw-text-gray-300",onClick:()=>{w(a),d()},variant:"link",disabled:r===m.length-1},e.createElement(l.ChevronDown,{className:"bw-h-2.5 bw-w-2.5 bw-cursor-pointer",strokeWidth:"4"}))))}))))))}function U(){const{agent_id:t}=k(),[a,l]=r.useSearchParams(),s=a.get("payment"),{data:i,isLoading:c}=r.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await j(t),keepPreviousData:!0}),m=1===a.size&&"incomplete"===s;return e.createElement("div",{className:n.cx("-bw-my-4 bw-flex bw-min-w-[190px] bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-bg-white bw-px-2.5 bw-py-[5px] bw-text-gray-500 hover:bw-border-gray-900 hover:bw-text-gray-900 ",m&&"bw-border-gray-900 bw-text-gray-900"),onClick:()=>{m||l({payment:"incomplete"})}},e.createElement("span",{className:n.cx("bw-flex bw-items-center bw-text-sm bw-font-normal")},o.__("Payment Incomplete","bookster")),e.createElement("span",{className:n.cx("bw-flex  bw-items-center bw-font-normal ",c&&"bw-animate-pulse bw-text-lg bw-leading-none")},e.createElement("span",{className:"bw-rounded-[5px] bw-bg-gray-70 bw-px-2 bw-py-[1px] bw-text-sm bw-leading-4 bw-text-gray-900"},c?"...":null==i?void 0:i.payment_status_incomplete)))}function W(){const{agent_id:t}=k(),[l,s]=r.useSearchParams(),o=l.get("status"),{data:i,isLoading:c}=r.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await j(t),keepPreviousData:!0}),m=1===l.size&&"pending"===o;return e.createElement("div",{className:n.cx("-bw-my-4 bw-flex bw-min-w-[180px] bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-bg-white bw-px-2.5 bw-py-[5px] bw-text-gray-500 hover:bw-border-gray-900 hover:bw-text-gray-900",m&&"bw-border-gray-900 bw-text-gray-900"),onClick:()=>{m||s({status:"pending"})}},e.createElement("span",{className:n.cx("bw-flex bw-items-center bw-text-sm bw-font-normal")},a("pending")),e.createElement("span",{className:n.cx("bw-flex  bw-items-center bw-font-normal",c&&"bw-animate-pulse")},e.createElement("span",{className:"bw-rounded-[5px] bw-bg-gray-70 bw-px-2 bw-py-[1px] bw-text-sm bw-leading-4 bw-text-gray-900"},c?"...":null==i?void 0:i.book_status_pending)))}function G(){return e.createElement(h,null,e.createElement(C.Wrapper,null,e.createElement(C.Title,{className:"bw-flex-initial"},o.__("My Appointments","bookster"))),e.createElement(n.Collapsible,null,e.createElement("div",{className:"bw-mb-2.5 bw-flex bw-flex-wrap bw-items-center bw-gap-2"},e.createElement(n.CollapsibleTrigger,{asChild:!0},e.createElement(f,null,e.createElement(l.Filter,null)," ",o.__("Filters","bookster"))),e.createElement(W,null),e.createElement(U,null),e.createElement("div",{className:"bw-flex bw-flex-grow bw-items-center bw-whitespace-nowrap"},e.createElement(E,null)),e.createElement(y,{className:"bw-w-80 bw-flex-none"}),e.createElement(X,null),e.createElement(x,null)),e.createElement(n.CollapsibleContent,{forceMountWithAnimation:!0},e.createElement("div",{className:"bw-mb-2.5 bw-mt-1.5 bw-flex bw-flex-wrap bw-items-center bw-gap-x-4 bw-gap-y-3 bw-rounded bw-border bw-border-solid bw-border-gray-100 bw-bg-white bw-px-4 bw-py-3.5"},e.createElement("span",{className:"bw-text-sm"},o.__("Select","booster")),e.createElement(K,null),e.createElement(p,null)))),e.createElement(V,null),e.createElement(v,{parentPath:"/appointments"},e.createElement(r.Outlet,null)))}export{G as default};
