import{c as e,R as t,b as a,_ as r,a as n,f as l,r as s}from"./prefetch.helper-04349684.js";import{u as o,a as i,b as m,C as c,m as d,r as p,d as u}from"./CalendarContent-e50ff6c3.js";import{P as b,a as w}from"./UIComponents-7ff4460b.js";import{A as E}from"./AgentAppointmentFormDrawer-da983b4b.js";import{m as f,a as v}from"./main-70b6d0e7.js";import{u as g,a as h,b as C}from"./page-agent.js";import{k as y,j as k}from"./appointment.helper-07645f99.js";import{c as _,u as j,f as x}from"./BEConfigProvider-705eafe2.js";import{S as A,P as S}from"./queue.helper-cc60359e.js";import{u as N}from"./useAgentAppointmentEvents-802c31ca.js";import{A as M,a as F,b as T}from"./ApptsFilterService-c1f460fc.js";import{N as P,a as R,b as D}from"./CalendarNav.styled-cb1aebbc.js";import{T as G}from"./ReloadButton-117ef334.js";import"./react-dom-3e43fe1d.js";import"./useCacheCustomers-102bfcf8.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./BackendRouteErrorElement-6f34d3c9.js";import"./lodash-f550b173.js";function W({isFetching:s,isSaving:i}){const{getCalendarApi:m}=o(),{title:c,type:d}=g((e=>e.calendar.view)),p=g((e=>e.calendarToday)),u=g((e=>e.calendarPrev)),w=g((e=>e.calendarNext)),E=g((e=>e.calendarChangeView)),f=e.useQueryClient();return t.createElement(t.Fragment,null,t.createElement(b.Standalone,null,"resourceTimelineDay"===d&&a.__("Day Schedule","bookster"),"timeGridWeek"===d&&a.__("Week Schedule","bookster"),"dayGridMonth"===d&&a.__("Month Schedule","bookster")),t.createElement(r.Collapsible,null,t.createElement("div",{className:"bw-mb-4 bw-flex bw-flex-wrap bw-items-center bw-gap-2"},t.createElement(r.CollapsibleTrigger,{asChild:!0},t.createElement(P,null,t.createElement(n.Filter,null)," ",a.__("Filters","bookster"))),t.createElement(P,{onClick:()=>p(m())},a.__("Today","bookster")),t.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(R,{onClick:()=>u(m())},t.createElement(n.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(R,{onClick:()=>w(m())},t.createElement(n.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(D,null,c," ",t.createElement(A,{isSaving:i})),t.createElement(r.SegmentGroup,{size:"medium",value:d,onValueChange:e=>{_({calendarViewAgent:e}),E(m(),e)}},t.createElement(r.SegmentGroupItem,{value:"timeGridWeek"},a.__("Week","bookster")),t.createElement(r.SegmentGroupItem,{value:"dayGridMonth"},a.__("Month","bookster"))),t.createElement(G,{className:"bw-bg-white",onClick:()=>f.invalidateQueries({queryKey:["appointments","events"]}),isFetching:s})),t.createElement(r.CollapsibleContent,{forceMountWithAnimation:!0},t.createElement("div",{className:"bw-mb-3 bw-flex bw-flex-wrap bw-items-center bw-gap-x-4 bw-gap-y-3 bw-rounded bw-border bw-border-solid bw-border-gray-100 bw-bg-white bw-px-4 bw-py-3.5"},t.createElement("span",{className:"bw-text-sm"},a.__("Select","booster")),t.createElement(r.Separator,{orientation:"vertical",className:"bw-h-6 bw-bg-gray-100"}),t.createElement(M,null),t.createElement(F,null),l.booksterHooks.applyFilters(l.HOOK_NAMES.adminCalendar.BeforeApptsFilterClear,[]),t.createElement(T,null)))))}const B=new S;function I(){const[a,n]=s.useState(null),{activeStart:l,activeEnd:u,type:b}=g((e=>e.calendar.view)),w=g((e=>e.calendarRefresh)),E=h(),{businessHours:_,slotMinAbs:A,slotMaxAbs:S}=y(E.weekly_schedule??void 0),{toast:M}=r.useToast(),{invalidateLazy:F,invalidateNow:T,updateModel:P}=i(),R=m(l,u),{data:D,isFetching:G,isRefetching:I}=N(E.agent_id,R),{getCalendarApi:H,calendarRef:L}=o();s.useEffect((()=>{if(void 0!==D&&L.current){const e=H();e.batchRendering((()=>{e.removeAllEvents(),D.forEach((t=>e.addEvent(t)))}))}}),[D,L.current]),s.useEffect((()=>{w(H())}),[]);const Q=e.useQueryClient(),V=j();return t.createElement(t.Fragment,null,t.createElement(W,{isSaving:a,isFetching:G||I}),t.createElement("div",{className:"bw-mt-1.5 bw-rounded-lg bw-bg-white bw-p-2.5 bw-shadow-sm"},t.createElement(c,{key:"agent-calendar",plugins:[f,v,d],initialView:b,allDaySlot:!1,slotMinTime:60*A*1e3,slotMaxTime:60*S*1e3,businessHours:_,eventContent:p,eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,Q.setQueryData(["appointment",t.appointment_id],t),V(`${t.appointment_id}`)},eventDrop:async function(t){if(!x.writeAppt)return;const a=t.event;if(!a.start||!a.end)return;const r=k(a.extendedProps.model,a.start,a.end);B.add((async()=>{n(!0);try{const e=await C(E.agent_id,parseInt(t.event.id),r);t.event.setExtendedProp("model",e),P(e),F()}catch(a){throw n(null),M.error(await e.getErrorMsg(a)),T(),t.revert(),a}}),(()=>{n(!1)}))},editable:x.writeAppt,schedulerLicenseKey:void 0})))}function H(){return t.createElement(w,null,t.createElement(u,null,t.createElement(I,null)),t.createElement(E,{parentPath:"/calendar"},t.createElement(e.Outlet,null)))}export{H as default};
