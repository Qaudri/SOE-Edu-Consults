import{c as e,R as t,_ as a,b as n,a as r,r as s,L as l}from"./prefetch.helper-04349684.js";import{a as o}from"./UIComponents-7ff4460b.js";import{A as i}from"./AgentAppointmentFormDrawer-da983b4b.js";import{u as c,a as m,b as u,C as d,m as p,r as v,c as w,d as b}from"./CalendarContent-e50ff6c3.js";import{m as E}from"./main-6566bc29.js";import{u as g,a as f,b as y}from"./page-agent.js";import{u as h}from"./useAgentAppointmentEvents-802c31ca.js";import{k as C,j as k}from"./appointment.helper-07645f99.js";import{u as _,f as j,g as x}from"./BEConfigProvider-705eafe2.js";import{S as D,P as N}from"./queue.helper-cc60359e.js";import{N as P,a as R,b as A}from"./CalendarNav.styled-cb1aebbc.js";import{G as S}from"./ReloadButton-117ef334.js";import{c as T,a as M,P as F,C as I,e as L,f as Q,h as H,S as q,j as B,k as G,l as V,m as W,n as z}from"./StatsRate-10303d5b.js";import"./react-dom-3e43fe1d.js";import"./useCacheCustomers-102bfcf8.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./BackendRouteErrorElement-6f34d3c9.js";import"./lodash-f550b173.js";function K({isFetching:s,isSaving:l}){const{getCalendarApi:o}=c(),{title:i}=g((e=>e.agentDashboard.dayPreview)),m=g((e=>e.agentDashboardDayPreviewToday)),u=g((e=>e.agentDashboardDayPreviewPrev)),d=g((e=>e.agentDashboardDayPreviewNext)),p=e.useQueryClient();return t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,n.__("Day Schedule","bookster")),t.createElement(S,{onClick:()=>p.invalidateQueries({queryKey:["appointments","events"]}),isFetching:s})),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(P,{onClick:()=>m(o())},"Today"),t.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(R,{onClick:()=>u(o())},t.createElement(r.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(R,{onClick:()=>d(o())},t.createElement(r.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(A,null,i,t.createElement(D,{isSaving:l}))))}const O=new N;function $(){const[n,r]=s.useState(null),{activeStart:l,activeEnd:o}=g((e=>e.agentDashboard.dayPreview)),i=g((e=>e.agentDashboardDayPreviewRefresh)),b=f(),{businessHours:x,slotMinAbs:D,slotMaxAbs:N}=C(b.weekly_schedule??void 0),P=s.useMemo((()=>[{id:b.agent_id.toString(),title:b.first_name+" "+b.last_name,businessHours:x,model:b}]),[b]),{toast:R}=a.useToast(),{invalidateLazy:A,invalidateNow:S,updateModel:T}=m(),M=u(l,o),{data:F,isFetching:I,isRefetching:L}=h(b.agent_id,M),{getCalendarApi:Q,calendarRef:H}=c();s.useEffect((()=>{if(void 0!==F&&H.current){const e=Q();e.batchRendering((()=>{e.removeAllEvents(),F.forEach((t=>e.addEvent(t)))}))}}),[F,H.current]),s.useEffect((()=>{i(Q())}),[]);const q=e.useQueryClient(),B=_();return t.createElement(a.Card,{className:"bw-mb-6"},t.createElement(K,{isSaving:n,isFetching:I||L}),t.createElement(a.CardContent,{className:"bw-px-2.5"},t.createElement(d,{key:"agent-day-preview-calendar",plugins:[E,p],initialView:"resourceTimelineDay",slotMinTime:60*D*1e3,slotMaxTime:60*N*1e3,businessHours:x,eventContent:v,eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,q.setQueryData(["appointment",t.appointment_id],t),B(`${t.appointment_id}`)},eventDrop:async function(t){if(!j.writeAppt)return;const a=t.event;if(!a.start||!a.end)return;const n=k(a.extendedProps.model,a.start,a.end);O.add((async()=>{r(!0);try{const e=await y(b.agent_id,parseInt(t.event.id),n);t.event.setExtendedProp("model",e),T(e),A()}catch(a){throw r(null),R.error(await e.getErrorMsg(a)),S(),t.revert(),a}}),(()=>{r(!1)}))},editable:j.writeAppt,resources:P,resourceAreaHeaderContent:t.createElement(t.Fragment,null),resourceAreaWidth:58,resourceLabelContent:w})))}function U(){return t.createElement(b,null,t.createElement($,null))}const J=x().dashboardIntervalRange;function X(o){var i;const{agent_id:c}=f(),m=e.useQueryClient(),u=e.useNavigate(),d=g((e=>e.agentDashboard.intervalRange)),p=g((e=>e.agentDashboardSetIntervalRange)),[v,w]=s.useState(!1),{preloadReportQuery:b,defaultIntervalRange:E}=function(){const{agent_id:t}=f();return{preloadReportQuery:e.useQuery({queryKey:["analytics","overview",J],queryFn:async()=>{const a=T();return await async function(t,a){return await e.api.patch(`analytics/as-agent/${t}/overview`,{json:a}).json()}(t,{performance:M(J),agentLeaderboard:{filter:a},serviceLeaderboard:{filter:a}})},refetchOnMount:!1,refetchOnWindowFocus:!1}),defaultIntervalRange:J}}(),{data:y,isFetching:h}=e.useQuery({queryKey:["analytics","performance",d],queryFn:async()=>await async function(t,a){return await e.api.patch(`analytics/as-agent/${t}/performance`,{json:a}).json()}(c,M(d)),enabled:E!==d||v,keepPreviousData:!0,placeholderData:E===d?null==(i=b.data)?void 0:i.performance:void 0,staleTime:6e5});return t.createElement(F,{...o},t.createElement(I,null,t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-flex-row bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,n.__("Performance","bookster")),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(a.SegmentGroup,{size:"medium",value:d,onValueChange:e=>(p(e),void w(!0))},t.createElement(a.SegmentGroupItem,{value:"day"},n.__("Day","bookster")),t.createElement(a.SegmentGroupItem,{value:"week"},n.__("Week","bookster")),t.createElement(a.SegmentGroupItem,{value:"month"},n.__("Month","bookster"))),t.createElement(S,{onClick:()=>(m.invalidateQueries({queryKey:["analytics","performance",d]}),void w(!0)),isFetching:h}))),t.createElement(L,null)),t.createElement(a.CardContent,{className:"bw-flex-grow bw-px-0"},!y&&t.createElement(Q,null),y&&t.createElement(H,{intervals:y.intervals}))),t.createElement(q,null,t.createElement("div",null,t.createElement(B,null,n.__("Revenue","bookster"),t.createElement(a.Tooltip,{content:"Total Revenue in the Last 30 Days"},t.createElement(r.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!y&&t.createElement(G,null),y&&t.createElement(V,null,t.createElement(W,null,e.formatPrice(y.totals.current.revenue)),t.createElement(z,{current:y.totals.current.revenue,previous:y.totals.previous.revenue})),t.createElement(a.Button,{onClick:()=>u("/appointments"),className:"bw-rounded-sm bw-border-gray-300 bw-text-gray-900",size:"small",variant:"trivial"},n.__("View Appointment","bookster"))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/revenue-page.svg"})),t.createElement(q,null,t.createElement("div",null,t.createElement(B,null,n.__("Appointments","bookster"),t.createElement(a.Tooltip,{content:"Total Appointments in the Last 30 Days"},t.createElement(r.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!y&&t.createElement(G,null),y&&t.createElement(V,null,t.createElement(W,null,y.totals.current.apptCount),t.createElement(z,{current:y.totals.current.apptCount,previous:y.totals.previous.apptCount})),t.createElement(a.Button,{onClick:()=>u("/calendar"),className:"bw-rounded-sm bw-border-gray-300 bw-text-gray-900",size:"small",variant:"trivial"},n.__("View Calendar","bookster"))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/appt-page.svg"})),t.createElement(q,null,t.createElement("div",null,t.createElement(B,null,n.__("New Customers","bookster"),t.createElement(a.Tooltip,{content:n.sprintf(n.__("Total New %(customers)s in the Last 30 Days","bookster"),l)},t.createElement(r.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!y&&t.createElement(G,null),y&&t.createElement(V,null,t.createElement(W,null,y.totals.current.newCustomerCount),t.createElement(z,{current:y.totals.current.newCustomerCount,previous:y.totals.previous.newCustomerCount}))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/customer-page.svg"})))}function Y(){return t.createElement(o,null,t.createElement(X,null),t.createElement(U,null),t.createElement(i,{parentPath:"/dashboard"},t.createElement(e.Outlet,null)))}export{Y as default};
