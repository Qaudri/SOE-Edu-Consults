import{r as e,R as t,_ as a,d as r,c as l,a as n,b as s,L as i,e as o}from"./prefetch.helper-04349684.js";import{g as c,l as m,b,C as u}from"./CoverPicker-52693ec5.js";import{H as d}from"./BEConfigProvider-705eafe2.js";import{v as w}from"./phoneInput.helper-806287af.js";function _({formNamePrefix:l,service:n,className:s}){if(!n.service_id)return null;const i=e.useMemo((()=>[...l,n.service_id.toString(),"service_id"]),[l,n.service_id]),o=e.useMemo((()=>[...l,n.service_id.toString(),"available"]),[l,n.service_id]);return t.createElement(a.Label,{htmlFor:`service-${n.service_id}`,className:a.cx("bw-flex bw-h-[34px] bw-cursor-pointer bw-items-center bw-gap-2 bw-rounded-sm bw-px-6 bw-duration-300 hover:bw-bg-gray-50",s)},t.createElement(r.Form.Item,{name:i,hidden:!0},t.createElement(a.InputNumber,null)),t.createElement(r.Form.Item,{name:o,trigger:"onCheckedChange",valuePropName:"checked",noStyle:!0},t.createElement(a.Checkbox,{className:"bw-h-3.5 bw-w-3.5",id:`service-${n.service_id}`})),t.createElement("span",{className:"bw-text-sm bw-text-gray-900"},n.name))}function p({formNamePrefix:l,category:n}){const s=r.Form.useFormInstance(),i=r.Form.useWatch(l,s),o=e.useMemo((()=>{if(!i)return{checkAll:!1,indeterminate:!1};const e=n.services.filter((e=>e.service_category_id===n.service_category_id)).map((e=>e.service_id)),t=Object.values(i).filter((t=>e.includes(t.service_id)));if(0===t.length)return{checkAll:!1,indeterminate:!1};const a=t.every((e=>e.available));return{checkAll:a,indeterminate:t.some((e=>e.available))&&!a}}),[i]);return t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},t.createElement(a.Checkbox,{id:`category-${n.service_category_id}`,checked:o.indeterminate?"indeterminate":o.checkAll,onClick:()=>(e=>{const t={...i},a=e.services.filter((t=>t.service_category_id===e.service_category_id)).map((e=>e.service_id));Object.values(i).filter((e=>a.includes(e.service_id))).forEach((e=>{if(!e.service_id)return;const a=e.service_id.toString();t[a]={...t[a],available:!o.checkAll}})),s.setFieldsValue({available_agent_services:t})})(n),className:"bw-h-3.5 bw-w-3.5"}),t.createElement(a.Label,{className:"bw-cursor-pointer bw-text-xs bw-font-medium bw-text-gray-500",htmlFor:`category-${n.service_category_id}`},n.name))}function v({formNamePrefix:o}){const[c,m]=e.useState(""),b=l.useActiveServices(),u=r.Form.useFormInstance(),d=r.Form.useWatch(o,u),{selected:w,total:v}=e.useMemo((()=>{const e=Object.values(d||{});return{selected:e.filter((({available:e})=>e)).length,total:e.length}}),[d]),g=(e,t)=>e.toLowerCase().includes(c.toLowerCase())||t.toLowerCase().includes(c.toLowerCase()),f=b.some((e=>e.services.some((t=>g(t.name,e.name)))));return t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-relative"},t.createElement(a.InputPrefix,{className:"bw-opacity-100"},t.createElement(n.Search,{className:"bw-text-gray-500"})),t.createElement(a.Input,{size:"medium",className:"bw-h-9 bw-ps-10",withStatus:!1,onChange:e=>{m(e.target.value)},placeholder:s.__("Search","bookster")})),t.createElement("p",{className:"bw-my-4 bw-text-xs bw-italic bw-text-gray-500"},s.sprintf(s.__("Selected %(services)s","bookster"),i),": ",w,"/",v),t.createElement("div",{className:"btr-scrollbar-sm bw-mb-16 bw-flex-grow bw-divide-y bw-divide-gray-100 bw-overflow-y-auto bw-rounded bw-border bw-border-gray-100"},!f&&t.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-px-2.5 bw-text-sm"},s.sprintf(s.__("No %(services)s found.","bookster"),i)),b.map((e=>{const r=e.services.some((t=>g(t.name,e.name)));return t.createElement(a.Collapsible,{className:a.cx("bw-group !bw-border-t-0",!r&&"bw-hidden"),key:e.service_category_id,defaultOpen:!0},t.createElement("div",{className:"bw-mx-3.5 bw-flex bw-items-center bw-justify-between bw-border-t bw-border-solid bw-border-gray-100 bw-py-3 group-first:bw-border-t-0"},t.createElement(p,{formNamePrefix:o,category:e}),t.createElement(a.CollapsibleTrigger,{asChild:!0},t.createElement("span",{className:"bw-flex bw-w-6 bw-cursor-pointer bw-items-center bw-justify-end bw-text-gray-500/40 bw-transition-transform [&>svg]:data-[state=open]:bw-rotate-180"},t.createElement(n.ChevronDown,{size:8,className:"bw-duration-300"})))),t.createElement(a.CollapsibleContent,{className:"",forceMountWithAnimation:!0},t.createElement("div",{className:"bw-flex bw-flex-col bw-gap-y-1.5 bw-pb-4"},e.services.map((r=>t.createElement(_,{className:a.cx(!g(r.name,e.name)&&"bw-hidden"),key:r.service_id,service:r,formNamePrefix:o}))))))}))))}function g({formNamePrefix:l,allLabel:o}){const c=r.Form.useFormInstance(),m=r.Form.useWatch(l,c),b=e.useMemo((()=>{if(!m)return{checkAll:!1,indeterminate:!1};const e=Object.values(m);if(0===e.length)return{checkAll:!1,indeterminate:!1};const t=e.every((e=>e.available));return{checkAll:t,indeterminate:e.some((e=>e.available))&&!t}}),[m]);return t.createElement(t.Fragment,null,t.createElement(v,{formNamePrefix:l}),t.createElement("div",{className:"bw-absolute bw-bottom-[65px] bw-left-0 bw-flex bw-h-14 bw-w-full bw-items-center bw-gap-2 bw-bg-white bw-px-5 bw-shadow-[0px_-2px_10px_rgba(0,0,0,0.04)]"},t.createElement(a.Checkbox,{className:"bw-h-[18px] bw-w-[18px]",id:"check-all",checked:b.indeterminate?"indeterminate":b.checkAll,onClick:()=>{const e={...m};Object.values(m).forEach((t=>{if(!t.service_id)return!1;const a=t.service_id.toString();e[a]={...e[a],available:!b.checkAll}})),c.setFieldsValue({available_agent_services:e})}}),t.createElement(a.Label,{className:"bw-cursor-pointer bw-text-sm",htmlFor:"check-all"},o),t.createElement(a.Tooltip,{content:s.sprintf(s.__("Available only apply to %(customer)s Booking Form. For Manager, there is no restriction.","bookster"),i)},t.createElement(n.HelpCircle,{size:8,className:"bw-text-gray-500"}))))}function f(){return t.createElement(g,{formNamePrefix:["available_agent_services"],allLabel:s.sprintf(s.__("This %(agent)s is available for all %(services)s","bookster"),i)})}function E(){return t.createElement("div",{className:"bw-mb-3"},t.createElement("div",{className:"bw-mb-1 bw-flex bw-items-center bw-gap-1 bw-text-xs"},t.createElement("span",null,s.__("Active","bookster")),t.createElement("span",{className:"bw-text-error"},"*"),t.createElement(a.Tooltip,{content:s.sprintf(s.__("Archiving %(agent)s to avoid Deleting referencing Appointment, Analytics Data in the past.","bookster"),i)},t.createElement(n.HelpCircle,{size:10,className:"bw-text-gray-500"}))),t.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-gap-4 bw-rounded bw-border bw-px-3 bw-text-sm"},t.createElement("div",{className:"bw-me-auto"},s.sprintf(s.__("Active %(agents)s are available for booking.","bookster"),i)),t.createElement(a.Separator,{orientation:"vertical"}),t.createElement(a.FormItem,{noStyle:!0,name:"activated",valuePropName:"checked",rules:[{required:!0}],trigger:"onCheckedChange"},t.createElement(a.Switch,null))))}function h(){const{agentId:e}=l.useParams();return isNaN(Number(e))?null:Number(e)}function y(e){return l.useQuery({queryKey:["agent",e],queryFn:()=>e?c(e):null,staleTime:0})}function k(){const e=r.Form.useFormInstance(),{toast:c}=a.useToast(),u=h(),{data:d}=y(u),w=null===u,_=r.Form.useWatch("wp_user_id",e),p=r.Form.useWatch("wp_user_display_name",e),v=_&&p,g=l.useQueryClient(),f=l.useMutation({mutationFn:({id:e,email:t})=>m(e,t),onSuccess:t=>{e.setFieldsValue({wp_user_id:t.wp_user_id,wp_user_display_name:t.wp_user_display_name}),g.invalidateQueries({queryKey:["agents"]})}}),E=l.useMutation({mutationFn:({id:e})=>b(e),onSuccess:t=>{e.setFieldsValue({wp_user_id:t.wp_user_id,wp_user_display_name:t.wp_user_display_name}),g.invalidateQueries({queryKey:["agents"]})}});return t.createElement("div",{className:"bw-mb-4"},w?null:t.createElement(a.FormItem,{label:t.createElement("span",{className:"bw-flex bw-items-center bw-gap-1"},t.createElement("span",null,s.__("Wordpress User","bookster"))),tooltip:s.sprintf(s.__("Link %(agent)s with WP User to allow them to login and browse Working Calendar.","bookster"),i)},t.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-gap-4 bw-rounded bw-border bw-px-3 bw-text-sm"},t.createElement("div",{className:"bw-me-auto"},v?t.createElement("span",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(n.Link,null)," ",s.__("Linked to the WP User","bookster"),t.createElement(o,{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${_}`,target:"_blank"},p)):t.createElement("span",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(n.Unlink,null)," ",s.__("Not Linked to any WP User.","bookster"))),t.createElement(a.Separator,{orientation:"vertical"}),v?t.createElement(t.Fragment,null,E.isLoading?t.createElement(n.Loader2,{className:"bw-animate-spin"}):t.createElement(o,{onClick:async function(){(null==d?void 0:d.agent_id)&&await E.mutateAsync({id:d.agent_id})}},s.__("Unlink Now","bookster"))):t.createElement(t.Fragment,null,f.isLoading?t.createElement(n.Loader2,{className:"bw-animate-spin"}):t.createElement(o,{onClick:async function(){if(!(null==d?void 0:d.agent_id))return;try{await e.validateFields(["email","first_name","last_name"])}catch(a){return}const t=e.getFieldValue("email");if(t===d.email)try{await f.mutateAsync({id:d.agent_id,email:t})}catch(a){c.error(await l.getErrorMsg(a))}else c.warning("Email has changed! Please save form before linking.")}},s.__("Link Now","bookster"))))),t.createElement(r.Form.Item,{name:"wp_user_id",hidden:!0},t.createElement(a.InputNumber,null)),t.createElement(r.Form.Item,{name:"wp_user_display_name",hidden:!0},t.createElement(a.Input,null)))}function x(){const l=h(),{data:n}=y(l),[o,c]=e.useState(""),m=r.Form.useFormInstance(),b=r.Form.useWatch("wp_user_id",m);return e.useEffect((()=>{n&&c((null==n?void 0:n.transient_avatar_url)??"")}),[n]),t.createElement(t.Fragment,null,t.createElement(u,{coverSrc:o,onSelectCover:e=>{m.setFieldValue("avatar_id",+e.id),c(e.url)},onRemoveCover:e=>{m.setFieldValue("avatar_id",null),c(e)}}),t.createElement(r.Form.Item,{name:"avatar_id",hidden:!0},t.createElement(d,null)),t.createElement("div",{className:"bw-mb-1 bw-mt-4 bw-grid bw-grid-cols-1 bw-gap-x-5 bw-gap-y-1 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{label:s.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},t.createElement(a.Input,{placeholder:s.__("Please enter First Name","bookster"),autoFocus:!0})),t.createElement(r.Form.Item,{label:s.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},t.createElement(a.Input,{placeholder:s.__("Please enter Last Name","bookster")})),t.createElement(a.FormItem,{label:s.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"],tooltip:void 0!==b&&t.createElement(t.Fragment,null,s.__("Please change Email from","bookster")," Â ",t.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${b}`,className:"bw-text-info",target:"_blank"},s.__("Wordpress Profile","bookster")))},t.createElement(a.Input,{placeholder:s.__("Please enter Email","bookster"),disabled:void 0!==b})),t.createElement(r.Form.Item,{label:s.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:w,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},t.createElement(a.PhoneInput,null)),t.createElement(a.FormItem,{label:s.__("Priority","bookster"),name:"priority",rules:[{required:!0}]},t.createElement(a.InputStepNumber,{min:0,max:100,step:5,className:"bw-w-full"})),t.createElement("div",{className:"bw-mb-2 bw-flex bw-text-xs bw-font-normal bw-italic bw-text-gray-500 sm:bw-mt-7 sm:bw-items-center"},s.__("Display priority (from 0 to 100)","bookster"))),t.createElement(k,null),t.createElement(E,null),t.createElement(a.FormItem,{label:s.__("Visibility","bookster"),name:"visibility",trigger:"onValueChange",tooltip:s.sprintf(s.__("Private %(agents)s are visible to Staff only.","bookster"),i)},t.createElement(a.RadioGroupCard,null,t.createElement(a.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},t.createElement(a.RadioGroupCardItem,{value:"public",align:"middle"}),t.createElement(a.RadioGroupCardTitle,null,s.__("Public","bookster"))),t.createElement(a.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},t.createElement(a.RadioGroupCardItem,{value:"private",align:"middle"}),t.createElement(a.RadioGroupCardTitle,null,s.__("Private","bookster"))))))}export{x as A,f as a,y as b,h as u};
