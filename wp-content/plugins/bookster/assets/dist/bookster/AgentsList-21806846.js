import{c as e,R as t,_ as a,b as n,a as l,r}from"./prefetch.helper-04349684.js";import{u as o}from"./BEConfigProvider-705eafe2.js";import{e as i,q as s}from"./CoverPicker-52693ec5.js";import{b as c}from"./agent.helper-a271074e.js";import{s as m,a as u}from"./apptDataTable-a0a4fccd.js";import{i as g}from"./store-bdc614dc.js";function d({children:n}){const l=e.useMatch("/agents"),r=o(),i=null===l,s=e.useIsMutating({mutationKey:["agents"]});return t.createElement(a.Drawer,{open:i,onOpenChange:e=>{e||s||r(".")}},t.createElement(a.DrawerPortalContent,null,n))}function b({agent:e}){return e.activated?"private"===e.visibility?t.createElement(a.Badge,{variant:"outline",color:"warning",size:"large"},n.__("Private","bookster")):"public"===e.visibility?t.createElement(a.Badge,{variant:"outline",color:"success",size:"large"},n.__("Public","bookster")):null:t.createElement(a.Badge,{variant:"outline",color:"error",size:"large"},n.__("Inactive","bookster"))}const w=e.createColumnHelper(),p=[m,w.accessor((e=>e.first_name+" "+e.last_name),{id:"name",header:n.__("Name","bookster"),cell:({row:e})=>t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(a.Avatar,{className:"bw-h-[30px] bw-w-[30px]"},t.createElement(a.AvatarImage,{src:e.original.transient_avatar_url}),t.createElement(a.AvatarFallback,{className:"bw-text-xs"},t.createElement(l.User,{className:"bw-h-3 bw-w-3"}))),e.original.first_name," ",e.original.last_name)}),w.accessor("email",{id:"email",header:n.__("Email","bookster")}),w.accessor("wp_user_id",{id:"wp_user_id",header:n.__("WP User","bookster"),cell:({row:e})=>t.createElement(t.Fragment,null,e.original.wp_user_id&&e.original.wp_user_display_name?t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(l.Link,{className:"bw-text-info"}),t.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${e.original.wp_user_id}`,target:"_blank",onClick:e=>e.stopPropagation(),className:"bw-text-info bw-no-underline hover:bw-text-info"},e.original.wp_user_display_name)):t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(l.Unlink,null),t.createElement("span",null,n.__("Not Linked","bookster"))))}),w.accessor("priority",{id:"priority",header:n.__("Priority","bookster")}),w.accessor("visibility",{id:"visibility",header:n.__("Visibility","bookster"),cell:({row:e})=>t.createElement(b,{agent:e.original})}),u];function _({ids:o}){const{toast:s}=a.useToast(),c=e.useQueryClient(),[m,u]=r.useState(!1),d=e.useQuery({queryKey:["appointments","by-agents",o],queryFn:()=>g({in_args:{agent_id:{values:o,placeholder:"%d",alias:"assignment"}}}),enabled:m}),b=e.useIsMutating({mutationKey:["agents"]}),w=e.useMutation({mutationKey:["agents",o,"delete"],mutationFn:i,onSuccess:()=>{c.invalidateQueries({queryKey:["agent"]}),c.invalidateQueries({queryKey:["agents"]})}});return t.createElement(a.Popover,{open:m,onOpenChange:u},t.createElement(a.PopoverTrigger,{asChild:!0},t.createElement(a.Button,{color:"error",variant:"link"},w.isLoading?t.createElement(l.Loader2,{className:"bw-h-4 bw-w-4 bw-animate-spin"}):t.createElement(l.Trash,{className:"bw-h-4 bw-w-4"}),n.__("Delete Data","bookster"))),t.createElement(a.ConfirmPopoverContent,null,t.createElement(l.AlertFilled,{className:"bw-text-error"}),t.createElement(a.ConfirmPopoverTitle,null,n.__("Delete Multiple Agents","bookster")),t.createElement(a.ConfirmPopoverDescription,null,n.sprintf(n.__("This action cannot be undone. This will permanently delete %s agents and their %s appointments.","bookster"),o.length,d.data??"...")),t.createElement(a.ConfirmPopoverActions,null,t.createElement(a.PopoverClose,{asChild:!0},t.createElement(a.Button,{variant:"soft"},n.__("Cancel","bookster"))),t.createElement(a.Button,{variant:"fill",onClick:async function(){if(o&&0!==o.length&&!b)try{await w.mutateAsync(o),u(!1),s.success("Agent Rows has been Deleted Successfully!")}catch(t){s.error(await e.getErrorMsg(t))}}},n.__("Confirm Delete","bookster")))))}function E(){const[l]=e.useSearchParams(),i=l.get("keywords"),m=a.useDebounce(i,{wait:500}),u=l.get("visibility"),g=r.useMemo((()=>[]),[]),[d,b]=r.useState({}),{pagination:w,setPagination:E,pagingPayload:y}=e.usePagination(),v={...y,...m?{keywords:m}:{},...c(u)},h=e.useQueryClient(),f=o(),{data:k,isLoading:C}=e.useQuery({queryKey:["agents",v],queryFn:()=>s(v),keepPreviousData:!0}),P=e.useReactTable({data:(null==k?void 0:k.data)||g,columns:p,getRowId:e=>e.agent_id.toString(),getCoreRowModel:e.getCoreRowModel(),state:{pagination:w,rowSelection:d},onPaginationChange:E,onRowSelectionChange:b,manualPagination:!0,rowCount:null==k?void 0:k.total,autoResetPageIndex:!1});return a.useRemoveSelectOnChange(P,(e=>e.agent_id.toString()),k),a.useResetPageOnOverflow(P,k),t.createElement(t.Fragment,null,t.createElement(a.Table,null,t.createElement(a.TableHeader,null,t.createElement(a.TableHeadRow,null,P.getLeafHeaders().map((n=>t.createElement(a.TableHead,{key:n.id,style:{width:`${n.column.getSize()}px`}},e.flexRender(n.column.columnDef.header,n.getContext())))))),t.createElement(a.TableBody,null,P.getRowModel().rows.map((n=>t.createElement(a.TableRow,{key:n.original.agent_id,isSelected:n.getIsSelected(),onClick:()=>{var e;const t=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString();var a;(null==t?void 0:t.length)||(a=n.original,f(`${a.agent_id}`),h.setQueryData(["agent",a.agent_id],a))}},n.getAllCells().map((n=>t.createElement(a.TableCell,{key:n.id,style:{width:`${n.column.getSize()}px`}},e.flexRender(n.column.columnDef.cell,n.getContext()))))))),(C||0===(null==k?void 0:k.data.length))&&t.createElement(a.TableRow,{className:"bw-pointer-events-none"},t.createElement(a.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},t.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-gray-500"},C?`${n.__("Loading","bookster")}...`:n.__("No Data Found","bookster")))))),t.createElement(a.Pagination,{table:P}),t.createElement(a.TableToaster,null,t.createElement(a.TableToast,{open:Object.keys(d).length>0,onOpenChange:e=>{e||P.resetRowSelection()}},t.createElement(a.TableToastClose,null),t.createElement(a.TableToastTitle,null,Object.keys(d).length," ",n.__("Selected","bookster")),t.createElement(a.Separator,{orientation:"vertical"}),t.createElement(_,{ids:Object.keys(d).map(Number)}))))}export{E as A,d as a};
