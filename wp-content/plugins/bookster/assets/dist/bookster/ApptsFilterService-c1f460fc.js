import{c as e,f as t,R as a,_ as s,a as r,b as m,r as n,L as l}from"./prefetch.helper-04349684.js";import{b as o}from"./useCacheCustomers-102bfcf8.js";const c=["code","date-from","date-to","status","payment","agent","service","customer"];function b(){const[n,l]=e.useSearchParams(),o=t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.apptsFilterSearchParamKeys,c),b=o.some((e=>n.get(e)));return a.createElement("div",{className:"bw-ms-auto bw-flex bw-h-3 bw-items-center"},a.createElement(s.Separator,{orientation:"vertical",className:"bw-me-2"}),a.createElement(s.Button,{className:s.clsx(!b&&"bw-hidden","bw-h-6 bw-text-error hover:bw-text-error hover:bw-no-underline"),variant:"link",onClick:function(){l((e=>(o.forEach((t=>e.delete(t))),e)))}},a.createElement(r.Trash,null),m.__("Clear Filters","bookster")))}function i({className:t,...c}){const[b,i]=n.useState(!1),[w,u]=n.useState(""),d=s.useDebounce(w,{wait:300}),[p,h]=e.useSearchParams(),x=p.get("customer"),E=x?parseInt(x,10):null,g=e.useQueryClient(),v=()=>{h((e=>(e.delete("customer"),e)))},{data:y}=e.useQuery(["customers",E],(async()=>E?await o(E):null)),{data:C,isFetching:N}=e.useQuery({queryKey:["customers",{keywords:d}],queryFn:async()=>d?await e.queryCustomers({keywords:d,limit:10}):await e.queryCustomers({limit:10}),keepPreviousData:!0}),f=n.useMemo((()=>E?a.createElement(a.Fragment,null,a.createElement(s.Separator,{orientation:"vertical",className:"bw-mx-1.5 bw-h-[14px] bw-bg-gray-500/15"}),a.createElement("div",{className:"bw-mr-[-5px] bw-flex bw-items-center bw-gap-2 bw-rounded-sm bw-bg-white bw-p-1 bw-pr-2 bw-shadow-sm"},a.createElement(s.Avatar,{className:"bw-h-[18px] bw-w-[18px]"},a.createElement(s.AvatarImage,{src:null==y?void 0:y.transient_avatar_url}),a.createElement(s.AvatarFallback,{className:"bw-text-xs"},a.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),a.createElement("span",{className:"bw-text-xs bw-font-medium"},y?`${y.first_name} ${y.last_name}`:`Customer #${E}`),a.createElement(r.X,{className:"bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),v()}}))):null),[y,E,v]);return a.createElement(s.Combobox,{open:b,onOpenChange:i},a.createElement(s.ComboboxTrigger,{size:"medium",withStatus:!1,className:s.clsx("bw-w-auto bw-gap-1 bw-rounded bw-border-dashed bw-border-gray-500/30 bw-bg-gray-50 bw-pe-2 bw-ps-2 bw-text-sm",t),...c},a.createElement(r.UsersPlus,{className:"bw-text-gray-500"}),a.createElement("span",{className:"bw-text-gray-500"},l.customer),f),a.createElement(s.ComboboxPortalContent,{className:"bw-w-72 bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(s.Command,{loop:!0,shouldFilter:!1},a.createElement(s.CommandInput,{placeholder:"Search",value:w,onValueChange:u,isFetching:N}),a.createElement(s.CommandList,{className:"bw-max-h-none"},a.createElement(s.CommandEmpty,null,m.sprintf(m.__("No %(customer)s found.","bookster"),l)),a.createElement(s.CommandGroup,null,null==C?void 0:C.data.map((e=>a.createElement(s.ComboboxItem,{key:e.customer_id,value:`${e.customer_id}`,isActive:E===e.customer_id,keywords:[e.first_name,e.last_name,e.email,e.phone],onSelect:()=>(e=>{g.setQueryData(["customers",e.customer_id],e),E!==e.customer_id?h((t=>(t.set("customer",`${e.customer_id}`),t))):h((e=>(e.delete("customer"),e)))})(e)},a.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},a.createElement(s.Avatar,{className:"bw-h-6 bw-w-6"},a.createElement(s.AvatarImage,{src:e.transient_avatar_url}),a.createElement(s.AvatarFallback,{className:"bw-text-xs"},a.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),a.createElement("span",null,`${e.first_name} ${e.last_name}`)),a.createElement(s.ComboboxItemIcon,null)))))))))}function w({className:t,...o}){const[c,b]=n.useState(!1),i=e.useActiveServices(),[w,u]=e.useSearchParams(),d=w.get("service"),p=(d?d.split(","):[]).map((e=>parseInt(e,10))),h=e=>{if(p.includes(e)){const t=p.filter((t=>t!==e));t.length>0?u((e=>(e.set("service",t.join(",")),e))):u((e=>(e.delete("service"),e)))}else u((t=>(t.set("service",[...p,e].join(",")),t)))},x=n.useMemo((()=>{if(0===p.length)return null;const e=i.flatMap((e=>e.services)).find((e=>e.service_id===p[0]));return e?a.createElement(a.Fragment,null,a.createElement(s.Separator,{orientation:"vertical",className:"bw-mx-1.5 bw-h-[14px] bw-bg-gray-500/15"}),a.createElement("div",{className:"bw-mr-[-5px] bw-flex bw-items-center bw-gap-1"},a.createElement("span",{className:"bw-flex bw-items-center bw-gap-2 bw-rounded-sm bw-bg-white bw-p-1 bw-pr-2 bw-shadow-sm"},a.createElement("span",{className:"bw-text-xs bw-font-medium"},e.name),a.createElement(r.X,{className:"bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:t=>{t.stopPropagation(),h(e.service_id)}})),p.length>1&&a.createElement("span",{className:"bw-inline-flex bw-h-[26px] bw-w-[26px] bw-items-center bw-justify-center bw-rounded-[8px] bw-bg-gray-500 bw-text-xs bw-font-medium bw-text-white"},"+",p.length-1))):null}),[p,i,h]);return a.createElement(s.Combobox,{open:c,onOpenChange:b},a.createElement(s.ComboboxTrigger,{size:"medium",withStatus:!1,className:s.clsx("bw-w-auto bw-gap-1 bw-rounded bw-border-dashed bw-border-gray-500/30 bw-bg-gray-50 bw-pe-2 bw-ps-2 bw-text-sm",t),...o},a.createElement(r.Box,{className:"bw-text-gray-500"}),a.createElement("span",{className:"bw-text-gray-500"},l.service),x),a.createElement(s.ComboboxPortalContent,{className:"bw-w-72 bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(s.Command,{loop:!0},a.createElement(s.CommandInput,{placeholder:"Search"}),a.createElement(s.CommandList,null,a.createElement(s.CommandEmpty,null,m.sprintf(m.__("No %(services)s found","bookster"),l)),i.map((e=>a.createElement(s.CommandGroup,{key:e.service_category_id,heading:e.name,className:"[&_[cmdk-item]]:bw-pl-5"},e.services.map((e=>a.createElement(s.ComboboxItem,{key:e.service_id,value:e.name,isActive:p.includes(e.service_id),onSelect:()=>h(e.service_id)},e.name,a.createElement(s.ComboboxItemIcon,null)))))))))))}export{w as A,i as a,b};
