import{_ as e,c as t}from"./createBookTimeInput.helper-ed47ae63.js";import{c as a,f as o,g as n,T as r,C as l,D as s,r as i,E as c,F as m,R as u,_ as b,b as d,s as w,d as p,a as f,e as k,u as g,G as E,L as y}from"./prefetch.helper-04349684.js";import{g as v}from"./agentSchedule.helper-648c495b.js";import{E as _}from"./ErrorAlert-4c797dab.js";import{v as h}from"./phoneInput.helper-806287af.js";import{S as x}from"./ServiceCard-1f94e7ea.js";const S=window.booksterPublicData.customizeSettings.content.steps;function N(){return{steps:[{title:S.service.title,description:S.service.description,phase:"browse",name:"service",acts:[e.ACT_NAME.selectService]},{title:S.agent.title,description:S.agent.description,phase:"browse",name:"agent",acts:[e.ACT_NAME.selectAgent]},{title:S.datetime.title,description:S.datetime.description,phase:"browse",name:"datetime",acts:[e.ACT_NAME.selectDateTime]},{title:S.contact.title,description:S.contact.description,phase:"checkout",name:"contact",acts:[e.ACT_NAME.formContact]},{title:S.checkout.title,description:S.checkout.description,phase:"checkout",name:"checkout",acts:[e.ACT_NAME.selectPayOption]},{title:S.confirmation.title,description:S.confirmation.description,phase:"complete",name:"confirmation",acts:[e.ACT_NAME.showAppointment]}]}}function A(e){return{context:{formId:e||a.genUniqueId(),parent:{is:"dialog"}},process:N()}}function M(e,t){return{context:{formId:t||a.genUniqueId(),parent:{is:"body",parentWidth:e}},process:N()}}function C(e,t={}){return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.bookingConfig,e,t)}const B={desktop:65*function(){const e=document.querySelector("html");return e?parseInt(window.getComputedStyle(e).fontSize):16}()},T=e=>e>=B.desktop?"desktop":"mobile";function F(){const e=n.dayjs().add(1,"minute").startOf("minute"),t=function(e){const[t,a]=window.booksterPublicData.generalSettings.book_restriction_earliest;if("no_restriction"===t||!a)return e;switch(t){case"minutes":case"hours":return e.add(a,t).startOf("minute");case"days":case"months":case"years":return e.add(a,t).startOf("day");default:return e.add(a,t)}}(e),a=function(e){const[t,a]=window.booksterPublicData.generalSettings.book_restriction_latest;if("no_restriction"===t||!a)return null;switch(t){case"minutes":case"hours":return e.add(a,t).endOf("minute");case"days":case"months":case"years":return e.add(a,t).endOf("day");default:return e.add(a,t)}}(e);return{now:e,earliest:t,latest:a}}function O(e,t){return null!==t&&e.isAfter(t)}const D=F();function P(e){return n.dayjs().hour(e.hour).minute(e.minute).format(a.TIME_TEMPLATE)}function L(e,t){if(!t)return P(e);const o=a.bookHelper.booktime.createFromAbsMinute(e.absMinute+t);return`${P(e)} - ${P(o)}`}function I(e){return{...e,startLabel:P(e.start),endLabel:P(e.end)}}const H=(e,t,o,l)=>{const s=l.duration,i=function(e,t){return e.map((e=>{const o=e.periods.map((e=>function(e,t){const o=[];let n=e.start.absMinute;const l=e.end.absMinute;for(;n+t<=l;n+=r){const e=a.bookHelper.booktime.createFromAbsMinute(n),r=a.bookHelper.booktime.createFromAbsMinute(n+t);o.push({start:e,end:r})}return{...e,timeSlots:o.map(I)}}(I(e),t)));return{periods:o}}))}(e.weekly,s),c={};let m=t.startOf("month");for(;m.isSame(t,"month");m=m.add(1,"day")){const t=(u=m.endOf("date"),b=o.earliest,u.isBefore(b)),r=O(m,o.latest),l=t||r,s=m.format(n.DAY_KEY_FORMAT),d=a.calculateIsDayOff(m,e),w=(null==d?void 0:d.isDayOff)||!1;c[s]={isRestricted:l,isDayOff:w,dayOffLabel:null==d?void 0:d.name,periods:w?[]:i[m.day()].periods}}var u,b;return c},j=(e,t,o,r,l,s,i)=>{const c={};let m=l.startOf("month");for(;m.isSame(l,"month");m=m.add(1,"day")){const r=m.format(n.DAY_KEY_FORMAT),l=e[r];if(l.isRestricted||l.isDayOff){c[r]={isRestricted:l.isRestricted,isDayOff:l.isDayOff,timeSlotCountTotal:0,timeSlotCountAvailable:0,periods:[]};continue}const u=m.isSame(s.earliest,"day"),b=u?a.bookHelper.booktime.createFromDayjs(s.earliest).absMinute:Number.MAX_SAFE_INTEGER,d=m.isSame(s.latest,"day"),w=d&&s.latest?a.bookHelper.booktime.createFromDayjs(s.latest).absMinute:-1;let p=0,f=0;const k=[];l.periods.forEach((e=>{const n=t[r],l=o[r],s=[];e.timeSlots.forEach((e=>{let t=!0;t&&u&&(t=e.start.absMinute>=b),t&&d&&(t=e.end.absMinute<=w),t&&(t=l.every((t=>!a.bookHelper.overlap.isApptOverlapWithTimeSlot(t,e.start.absMinute,i)))),t&&(t=n.every((t=>!a.bookHelper.overlap.isApptOverlapWithTimeSlot(t,e.start.absMinute,i)))),t&&f++,p++,s.push({...e,isAvailable:t})})),k.push({...e,timeSlots:s})})),c[r]={isRestricted:l.isRestricted,isDayOff:l.isDayOff,dayOffLabel:l.dayOffLabel,timeSlotCountTotal:p,timeSlotCountAvailable:f,periods:k}}return c};function q(e,t){const a={};let o=e.startOf("month");for(;o.isSame(e,"month");o=o.add(1,"day")){const e=o.format(n.DAY_KEY_FORMAT);a[e]=[]}return t.forEach((e=>{const t=n.dayjs(e.datetime_start).format(n.DAY_KEY_FORMAT);a[t].push(e)})),a}const z={};function K(e,t){const{stepIndex:a,actIndex:n}=e.current,r=t.process.steps[a],l=a>0||n>0,s=!("complete"===r.phase)&&a>0,i=a<t.process.steps.length-1,c=n>0||s,m={nextAct:n<r.acts.length-1||i,prevAct:c,nextStep:i,prevStep:s,reset:l};return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.canMutateProcess,m,e,t)}const R=(t,a,n)=>{const r=e.beginMutatePrevAct(t,a);return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.mutatePrevAct,!1,t,a,r,n)},V=(t,a,n)=>{const r=e.beginMutateNextAct(t,a);return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.mutateNextAct,!1,t,a,r,n)};function Y({children:n}){const r=e.useBookingConfig(),b=e.useBookingState((e=>e)),d=function(){const t=e.useBookingConfig(),a=e.useBookingStore(),n=e.useBookingState((e=>e.process)),r=e.useBookingState((e=>e.booked.state)),l=function(e,t){const{stepIndex:a,actIndex:o}=e.current,n=t.process.steps[a],r=n.acts[o];return{stepName:n.name,phase:n.phase,act:r,title:n.title,description:n.description}}(n,t),s=K(n,t);function i(e=!1){if(!e&&!s.prevAct)return;const o=a.getState();if(e&&!K(o.process,t).prevAct)return;let n=!1;a.setState((e=>{n=R(e,t,o)})),n&&i()}function c(e=!1){if(!e&&!s.nextAct)return;const o=a.getState();if(e&&!K(o.process,t).nextAct)return;let n=!1;a.setState((e=>{n=V(e,t,o)})),n&&c(!0)}return"processing"===r&&(s.reset=!1),{computed:l,can:s,mutate:{nextAct:c,prevAct:i,nextStep:function(){if(!s.nextStep)return;const e=a.getState();let o=!1;a.setState((a=>{do{o=V(a,t,e)}while(a.process.current.stepIndex===e.process.current.stepIndex)})),o&&c(!0)},prevStep:function(){if(!s.prevStep)return;const e=a.getState();let o=!1;a.setState((a=>{do{o=R(a,t,e)}while(a.process.current.stepIndex===e.process.current.stepIndex)})),o&&i(!0)},reset:function(){if(!s.reset)return;const e=a.getState();a.setState((a=>{do{R(a,t,e)}while(0!==a.process.current.stepIndex||0!==a.process.current.actIndex)})),a.setState((a=>{o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.mutateReset,a,t,e)}))}}}}(),w=function(){const t=e.useBookingStore(),n=i.useCallback((()=>{t.setState((e=>{const{now:t,earliest:a,latest:o}=F();e.datetime.timestamps.now=t,a===e.datetime.timestamps.earliest||a.isSame(e.datetime.timestamps.earliest)||(e.datetime.timestamps.earliest=a),o===e.datetime.timestamps.latest||(null==o?void 0:o.isSame(e.datetime.timestamps.latest))||(e.datetime.timestamps.latest=o)}))}),[t]);i.useEffect((()=>{const e=setInterval((()=>{n()}),15e3);return()=>clearInterval(e)}),[n]);const r=e.useBookingState((e=>e.select.agent)),u=i.useMemo((()=>null===r?null:v(r)),[r]),b=e.useBookingState((e=>e.datetime.timestamps)),d=e.useBookingState((e=>e.datetime.picker.bookMonth)),w=e.useBookingState((e=>e.select.service)),{queryByAgent:p,queryByUser:f}=function(e,t){const o=a.useQuery({queryKey:["bookedApptsByAgent",e?e.agent_id:null,t.format("YYYY-MM")],queryFn:async()=>e?await l(e,t):null,staleTime:6e4,select:e=>e?q(t,e):null}),n=a.useQuery({queryKey:["bookedApptsByUser",t.format("YYYY-MM")],queryFn:async()=>await s(t),staleTime:6e4,select:e=>e?q(t,e):null});return i.useEffect((()=>{e&&c(e,t.add(1,"month"))}),[e,t]),i.useEffect((()=>{m(t.add(1,"month"))}),[t]),{queryByAgent:o,queryByUser:n}}(r,d),k=p.data,g=f.data,E=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.bookingDuration,{bufferBefore:(null==w?void 0:w.buffer_before)||0,bufferAfter:(null==w?void 0:w.buffer_after)||0,duration:(null==w?void 0:w.duration)||0},t),y=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingFormDatetime.getMonthTimeSlotsFn,H,t),_=i.useMemo((()=>null===w||null===u?null:y(u,d,b,E,t)),[u,d,b,E,y]),h=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingFormDatetime.getMonthAvailableTimeSlotsFn,j,t),x=i.useMemo((()=>null===_||null===E||null===u||null==k||null==g?null:h(_,k,g,u,d,b,E,t)),[_,k,g,u,d,b,E,h]);return i.useMemo((()=>({computed:{bookingDuration:E,agentSchedule:u,monthTimeSlots:_,monthAvailableTimeSlots:x},mutate:{refreshTimestamps:n}})),[E,u,_,x])}(),p={process:d,datetime:w,input:function(o){const n=e.useBookingState((e=>e.select)),{service:r,agent:l,bookDate:s,bookTime:c,payOption:m,contact:u}=n,b=i.useMemo((()=>{if(!r)return;const t=e.makeBlueprintBooking(r,l,s,c,u);return e.calculateDetails(t)}),[r,l,s,c,u]),{apptInput:d,apptTransient:w}=i.useMemo((()=>{if(!(r&&l&&s&&c&&b&&u))return{apptInput:void 0,apptTransient:void 0};const e=o.bookingDuration||{duration:0,bufferBefore:0,bufferAfter:0},n=a.bookHelper.booktime.createFromAbsMinute(c.absMinute+e.duration),i=t(s,c,n,e.bufferBefore,e.bufferAfter),m={service_id:r.service_id,agent_ids:[l.agent_id],datetime_start:i.datetime_start};return{apptInput:m,apptTransient:{...m,...i}}}),[r,l,s,c,u]),p=i.useMemo((()=>{if(m){if("later"===m&&window.booksterPublicData.paymentGateway.later)return{payment_gateway:window.booksterPublicData.paymentGateway.later};if("full"===m&&window.booksterPublicData.paymentGateway.now)return{payment_gateway:window.booksterPublicData.paymentGateway.now};throw new Error("Sorry, the Payment is not available. Please contact the admin for more information.")}}),[m]);return{apptInput:d,bookingMetaInput:z,transactionInput:p,apptTransient:w,bookingDetailsValue:b}}(w.computed)},f=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.bookingLogic,p,r,b);return u.createElement(e.BookingLogicContext.Provider,{value:f},n)}function $({className:t,...a}){const{formLayout:o,showSidebar:n,showSummary:r}=e.useBookingLayout(),{sidebar:l,main:s,summary:i}=e.useBookingParts();return u.createElement("div",{className:b.cx("bw-relative bw-flex bw-items-stretch bw-gap-0 bw-overscroll-none",t),style:{..."desktop"===o&&{width:(r?65:52)+"rem"}},...a},n&&u.createElement(b.Slot,{key:l.key,className:"bw-flex bw-flex-none bw-flex-col bw-border-0 bw-border-e bw-border-solid bw-px-5 bw-py-4",style:{flexBasis:"15rem"}},l.node),u.createElement(b.Slot,{key:s.key,className:"bw-flex bw-max-w-full bw-flex-grow bw-flex-col",style:{flexBasis:"32rem",..."desktop"===o?{maxWidth:"37rem"}:{}}},s.node),r&&u.createElement(b.Slot,{key:i.key,className:"bw-flex bw-flex-none bw-flex-col bw-overflow-auto bw-border-0 bw-border-s bw-border-solid",style:{flexBasis:"18rem"}},i.node))}const G=(e,t)=>u.createElement("span",{className:b.cx("bw-relative bw-flex bw-h-full bw-w-full bw-rounded-full bw-bg-gray-50",("process"===t.status||"finish"===t.status)&&"bw-bg-primary")},"process"===t.status&&u.createElement("span",{className:"bw-absolute bw-inline-flex bw-h-full bw-w-full bw-animate-ping bw-rounded-full bw-bg-primary/60"})),U=b.styled.span("bw-text-base bw-font-heading"),W=b.styled.span("bw-text-primary bw-font-heading bw-font-bold bw-text-base"),X=b.styled.span("bw-text-sm"),Z=b.styled.span("bw-invisible bw-text-sm");function Q({className:t,...n}){const r=e.useBookingState((e=>e.process.current.stepIndex)),l=e.useBookingState((e=>e.customize.content.help)),s=function(){const t=e.useBookingConfig(),{process:n}=t,{datetime:r}=e.useBookingLogic(),l=e.useBookingState((e=>e.customize.content.steps)),s=e.useBookingState((e=>e.process.current.stepIndex)),c=e.useBookingState((e=>e.select)),m=e.useBookingState((e=>e.datetime.picker)),b=e.useBookingState((e=>e.booked));return i.useMemo((()=>{const{service:e,agent:i,bookDate:p,bookTime:f,contact:k}=c,g=n.steps.map(((t,o)=>{var n,c;const g=l[t.name],E=(null==g?void 0:g.title)??t.title,y=(null==g?void 0:g.description)??t.description,v={title:u.createElement(U,null,d.__(E,"bookster")),description:u.createElement(Z,null,"_")};switch(s===o&&(v.title=u.createElement(W,null,d.__(E,"bookster")),y&&(v.description=u.createElement(X,null,d.__(y,"bookster")))),t.name){case"service":e&&(v.description=u.createElement(X,null,e.name));break;case"agent":i&&(v.description=u.createElement(X,null,`${i.first_name} ${i.last_name}`));break;case"datetime":p&&f?v.description=u.createElement(X,null,p.format(a.DATE_TEMPLATE),u.createElement("br",null),L(f,null==(n=r.computed.bookingDuration)?void 0:n.duration)):m.bookDate&&m.bookTime?v.description=u.createElement(X,null,m.bookDate.format(a.DATE_TEMPLATE),u.createElement("br",null),L(m.bookTime,null==(c=r.computed.bookingDuration)?void 0:c.duration)):m.bookDate&&!m.bookTime&&(v.description=u.createElement(X,null,m.bookDate.format(a.DATE_TEMPLATE)));break;case"contact":(null==k?void 0:k.values)&&(v.description=u.createElement(X,null,k.values.first_name," ",k.values.last_name));break;case"checkout":"success"===b.state&&b.appointment&&(v.description=u.createElement(X,null,w.Decimal.fromString(b.appointment.booking.total_amount).isZero()?d.__("Free","bookster"):a.formatPrice(b.appointment.booking.total_amount)))}return v}));return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.stepItems,g,t)}),[t,l,s,c,m,b])}();return u.createElement("div",{className:b.cx(t),...n},u.createElement(p.Steps,{progressDot:G,direction:"vertical",current:r,items:s}),u.createElement("div",{className:"bw-mt-auto"},u.createElement(b.Separator,{className:"bw-my-6"}),u.createElement("div",{className:"bw-whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:d.__(l,"bookster")}})))}function J({className:t,...o}){const{bookingDetailsValue:n}=e.useBookingLogic().input;return u.createElement("div",{className:b.cx("bw-flex bw-min-h-[15rem] bw-flex-col bw-border-0 bw-border-t bw-border-solid bw-p-4",t),...o},u.createElement("p",{className:"bw-mb-1 bw-text-sm bw-leading-none bw-text-gray-500"},d.__("Booking Details","bookster")),u.createElement("div",{className:"bw-flex-grow bw-py-2"},null==n?void 0:n.booking.items.map((e=>u.createElement("p",{key:e.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",null,e.title," ",e.quantity>1&&"(x"+e.quantity+")"),a.formatPrice(e.amount)))),null==n?void 0:n.adjustment.items.map((e=>u.createElement("p",{key:e.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",null,e.title),a.formatPrice(e.amount)))),null==n?void 0:n.tax.items.map((e=>u.createElement("p",{key:e.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",null,e.title),a.formatPrice(e.amount))))),u.createElement("p",{className:"bw-mb-0 bw-flex bw-w-full bw-items-center bw-justify-between bw-border-0 bw-border-t bw-border-solid bw-pt-3 bw-text-lg bw-font-bold"},u.createElement("span",{className:"bw-font-medium"},d.__("Total","bookster")),n&&a.formatPrice(n.tax.total)))}function ee({className:t,...a}){const{summarySelect:o,summaryCost:n}=e.useBookingParts();return u.createElement("div",{className:b.cx(t),...a},u.createElement("div",null,u.createElement("div",{className:"bw-flex bw-h-14 bw-items-center bw-pl-4 bw-pr-2"},u.createElement("p",{className:"bw-mb-0 bw-flex-grow bw-font-heading bw-text-lg bw-font-semibold bw-uppercase bw-text-primary"},d.__("Summary","bookster")),u.createElement(e.CloseDialogButton,null)),u.createElement(b.Separator,null),u.createElement(b.Slot,{className:"bw-px-4 bw-py-3",key:o.key},o.node)),u.createElement(b.Slot,{className:"bw-mt-auto",key:n.key},n.node))}function te({className:t,...n}){var r;const l=e.useBookingState((e=>e.select)),s=e.useBookingState((e=>e.customize.labels)),{datetime:i}=e.useBookingLogic(),{service:c,agent:m,bookDate:w,bookTime:p,payOption:f,contact:k}=l;return u.createElement("div",{className:b.cx(t),...n},u.createElement("div",{className:"bw-mb-4"},c&&u.createElement("h4",{className:"bw-m-0 bw-mb-1 bw-text-lg"},c.name),w&&p&&u.createElement("p",{className:"bw-text-sm bw-text-primary"},w.format(a.DATE_TEMPLATE)," |"," ",L(p,null==(r=i.computed.bookingDuration)?void 0:r.duration))),o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.SummarySelectAfterService,[]),(null==k?void 0:k.values)&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},s.customer),k.values.first_name," ",k.values.last_name),m&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},s.agent),m.first_name," ",m.last_name),f&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},d.__("Payment","bookster"),":"),"later"===f&&"Will Pay Locally","full"===f&&"Pay in Full"))}function ae(t){const n=a.usePublicActiveAgents(),r=e.useBookingStore(),l=e.useBookingState((e=>e.select.service)),s=e.useBookingLogic().process,i=e.useBookingConfig();let c=n.filter((e=>{if(l){const t=e.available_agent_services.find((e=>e.service_id===l.service_id));if(t&&!1===t.available)return!1}return!0}));return c=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.agentsList,c,r,i),u.createElement("div",{...t},u.createElement(e.MainHeader,null),u.createElement(b.ScrollArea,{className:"btr-main-scrollarea"},u.createElement(b.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(9rem,1fr))] bw-gap-4 bw-p-4",xyz:"fade down-4 stagger-0.5"},c.map((e=>u.createElement("div",{key:e.agent_id,className:"bw-cursor-pointer bw-rounded-lg bw-border bw-border-solid bw-bg-white bw-p-3 bw-shadow-sm bw-duration-300 bw-ease-in-out hover:bw-shadow-md",onClick:()=>function(e){r.setState((t=>{t.select.agent=e})),s.mutate.nextAct()}(e)},u.createElement("div",{className:"bw-flex bw-flex-col bw-items-center"},u.createElement(b.Avatar,{className:"bw-h-28 bw-w-28 bw-shadow"},u.createElement(b.AvatarImage,{src:e.transient_avatar_url}),u.createElement(b.AvatarFallback,{className:"bw-text-lg"},u.createElement(f.User,{className:"bw-h-8 bw-w-8"}))),u.createElement("div",{className:"bw-mt-3 bw-text-center bw-font-semibold bw-leading-4"},e.first_name," ",e.last_name))))))),u.createElement(e.MainFooter,null))}function oe(){return u.createElement("svg",{width:43,height:50,viewBox:"0 0 43 50",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u.createElement("g",{clipPath:"url(#clip0_225_1307)"},u.createElement("path",{d:"M33.2 45.4L29.8 43L25.6 46L21.4 43L17 46L12.8 43L8.60001 46L4.40001 43L0.900005 45.4C0.600005 45.6 0.100006 45.4 0.100006 45V1C0.100006 0.6 0.600005 0.4 0.900005 0.6L4.40001 3L8.60001 0L12.8 3L17 0L21.2 3L25.4 0L29.6 3L33.1 0.6C33.5 0.3 34 0.6 34 1V45C34 45.4 33.5 45.7 33.2 45.4Z",fill:"#56AAFF"}),u.createElement("path",{d:"M42.1 30.5L37.7 22.1C37.4 21.4 36.7 21 35.9 21H33.9V32.1C33.9 32.9 33.2 33.6 32.4 33.6C31.6 33.6 31 32.9 31 32.1V23.6C31 21.9 29.7 20.6 28 20.6C26.3 20.6 25 21.9 25 23.6V40.1C25 41.8 25.4 43.4 26.2 44.9L29 50H41L42.8 33.9C42.9 32.7 42.7 31.5 42.1 30.5Z",fill:"#D9DCE1"}),u.createElement("path",{d:"M23 12H27",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),u.createElement("path",{d:"M27 17H23",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),u.createElement("path",{d:"M7 12H17",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),u.createElement("path",{d:"M20 17H7",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),u.createElement("path",{d:"M17 22H7",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),u.createElement("path",{d:"M17.8 36.8V38.4H16.3V36.8C15.3 36.6 14.3 36.2 13.5 35.4L14.6 34C15.4 34.7 16.3 35.1 17.1 35.1C17.8 35.1 18.3 34.8 18.3 34.2C18.3 33.6 17.9 33.3 16.7 33C15.1 32.5 13.7 32 13.7 30.2C13.7 28.8 14.6 27.7 16.3 27.5V25.8H17.8V27.5C18.7 27.7 19.6 28.1 20.2 28.6L19.1 30C18.3 29.5 17.6 29.2 16.9 29.2C16.2 29.2 15.8 29.5 15.8 30C15.8 30.5 16.3 30.8 17.3 31.1C19.2 31.7 20.4 32.2 20.4 34C20.4 35.5 19.4 36.6 17.8 36.8Z",fill:"#0478ED"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_225_1307"},u.createElement("rect",{width:43,height:50,fill:"white"}))))}function ne(){const t=e.useBookingStore(),o=e.useBookingState((e=>e.select.contact)),n=e.useBookingState((e=>e.booked.state)),{process:r,input:l}=e.useBookingLogic(),{apptInput:s,bookingMetaInput:c}=l,[m,w]=i.useState(null);return u.createElement("div",{className:"bw-relative bw-flex-grow"},u.createElement(b.XyzTransitionGroup,{appear:!0,className:"bw-mx-auto bw-flex bw-h-full bw-max-h-[24rem] bw-items-center bw-justify-around bw-gap-5 bw-p-4",xyz:"fade down-4 stagger-0.5"},u.createElement("div",{className:"bw-min-w-40"},u.createElement(re,{onClick:async function(){if(!s||!o||!c)throw new Error("Error trying to create booking!");if("idle"===n)try{t.setState((e=>{e.booked.state="processing"}));const{appointment:e,transaction:n,customer:l}=await a.requestBooking({apptInput:s,bookingMetaInput:c,transactionInput:{payment_gateway:"payment-free"},contactInput:o});t.setState((t=>{t.booked={state:"success",appointment:e,transaction:n,customer:l}})),r.mutate.nextStep()}catch(e){w(await a.getErrorMsg(e)),t.setState((e=>{e.booked.state="idle",e.select.payOption=null}))}}},u.createElement(le,null,u.createElement(oe,null)),u.createElement(se,null,d.__("Confirm free booking","bookster"))))),m&&u.createElement(_,{className:"bw-mx-auto bw-mt-4 bw-max-w-[30rem]"},m))}const re=b.styled.div("bw-cursor-pointer bw-rounded-xl bw-border bw-border-solid bw-border-black/10 bw-px-4 bw-py-3 bw-text-center bw-duration-300 hover:bw-border-primary  hover:bw-shadow-[0_7px_35px_rgba(0,0,0,0.1)]"),le=b.styled.span("bw-mx-auto bw-my-0 bw-block bw-h-14 bw-w-14"),se=b.styled.p("bw-mb-0 bw-mt-3 bw-text-base bw-text-nowrap bw-font-semibold"),ie=window.booksterPublicData.paymentGateway;window.booksterPublicData.paymentGateway.now;const ce=null!==ie.later,me=null!==ie.now;function ue(){return u.createElement("svg",{width:63,height:51,viewBox:"0 0 63 51",fill:"none",xmlns:"http://www.w3.org/2000/svg"},u.createElement("g",{clipPath:"url(#clip0_225_1317)"},u.createElement("path",{d:"M43.8438 32.9062H3.10938C1.75156 32.9062 0.640625 31.7953 0.640625 30.4375V3.28125C0.640625 1.92344 1.75156 0.8125 3.10938 0.8125H43.8438C45.2016 0.8125 46.3125 1.92344 46.3125 3.28125V30.4375C46.3125 31.7953 45.2016 32.9062 43.8438 32.9062Z",fill:"#D9DCE1"}),u.createElement("path",{d:"M59.8906 50.1875H19.1562C17.7984 50.1875 16.6875 49.0766 16.6875 47.7188V20.5625C16.6875 19.2047 17.7984 18.0938 19.1562 18.0938H59.8906C61.2484 18.0938 62.3594 19.2047 62.3594 20.5625V47.7188C62.3594 49.0766 61.2484 50.1875 59.8906 50.1875Z",fill:"#56AAFF"}),u.createElement("path",{d:"M62.3594 25.5H16.6875V32.9062H62.3594V25.5Z",fill:"#0478ED"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_225_1317"},u.createElement("rect",{width:"63",height:"51",fill:"white"}))))}function be(){const t=e.useBookingStore(),o=e.useBookingState((e=>e.select.contact)),n=e.useBookingState((e=>e.booked.state)),{process:r,input:l}=e.useBookingLogic(),{apptInput:s,transactionInput:c,bookingMetaInput:m}=l,[w,p]=i.useState(null);return i.useEffect((()=>{!async function(){if(s&&c&&o&&m&&"payment-later"===c.payment_gateway&&"idle"===n)try{t.setState((e=>{e.booked.state="processing"}));const{appointment:e,transaction:n,customer:l}=await a.requestBooking({apptInput:s,bookingMetaInput:m,transactionInput:{payment_gateway:"payment-later"},contactInput:o});t.setState((t=>{t.booked={state:"success",appointment:e,transaction:n,customer:l}})),r.mutate.nextStep()}catch(e){p(await a.getErrorMsg(e)),t.setState((e=>{e.booked.state="idle",e.select.payOption=null}))}}()}),[s,c,o,m]),u.createElement("div",{className:"bw-relative bw-flex-grow"},u.createElement(b.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-h-full bw-max-h-[24rem] bw-auto-cols-auto bw-grid-flow-col-dense bw-place-content-center bw-gap-5 bw-p-4",xyz:"fade down-4 stagger-0.5"},ce&&u.createElement("div",{className:"bw-min-w-28"},u.createElement(de,{onClick:function(){t.setState((e=>{e.select.payOption="later"}))}},u.createElement(we,null,u.createElement(oe,null)),u.createElement(pe,null,d.__("Pay Later","bookster")))),me&&u.createElement("div",{className:"bw-min-w-28"},u.createElement(de,{onClick:function(){t.setState((e=>{e.select.payOption="full"})),r.mutate.nextAct()}},u.createElement(we,null,u.createElement(ue,null)),u.createElement(pe,null,d.__("Pay Now","bookster"))))),w&&u.createElement(_,{className:"bw-mx-auto bw-mt-4 bw-max-w-[30rem]"},w))}const de=b.styled.div("bw-cursor-pointer bw-rounded-xl bw-border bw-border-solid bw-border-black/10 bw-px-4 bw-py-3 bw-text-center bw-duration-300 hover:bw-border-primary  hover:bw-shadow-[0_7px_35px_rgba(0,0,0,0.1)]"),we=b.styled.span("bw-mx-auto bw-my-0 bw-block bw-h-14 bw-w-14"),pe=b.styled.p("bw-mb-0 bw-mt-3 bw-text-base bw-text-nowrap bw-font-semibold");function fe(t){const a=e.useBookingState((e=>e.booked.state)),{input:o}=e.useBookingLogic();if(!o.bookingDetailsValue)throw new Error("Bookster could not retrieve bookingDetailsValue");return u.createElement("div",{...t},u.createElement(e.MainHeader,null),o.bookingDetailsValue.tax.total.isPositive()&&u.createElement(be,null),o.bookingDetailsValue.tax.total.isZero()&&u.createElement(ne,null),u.createElement(e.MainFooter,null),u.createElement(b.LoadingOverlay,{className:"bw-inset-4 bw-text-lg bw-font-medium bw-text-gray-500",loading:"processing"===a},u.createElement(f.Loader2,{className:"bw-mr-4 bw-h-6 bw-w-6 bw-animate-spin"}),d.__("Booking your Appointment!","bookster")))}function ke(t){var n;const r=e.useBookingState((e=>e.select)),{appointment:l}=e.useBookingState((e=>e.booked)),s=e.useBookingState((e=>e.customize.labels)),{service:i,agent:c,bookDate:m,bookTime:w,payOption:p,contact:g}=r,{input:E,process:y,datetime:v}=e.useBookingLogic(),{bookingDetailsValue:_}=E,h=e.useBookingLayout().formLayout,{context:x}=e.useBookingConfig(),S="dialog"===x.parent.is;return u.createElement("div",{...t},u.createElement(b.ScrollArea,{className:"bw-grow"},S&&u.createElement(b.DialogCloseIcon,null),u.createElement(b.XyzTransition,{appear:!0,className:"bw-p-4",xyz:"fade down-4"},u.createElement("div",{className:"md:bw-px-4"},u.createElement("div",{className:"bw-py-6 bw-text-center md:bw-py-10"},u.createElement(f.CheckCircle,{className:"bw-mb-3 bw-h-16 bw-w-16 bw-text-success/80"}),u.createElement("h3",{className:"bw-m-0 bw-text-lg bw-font-medium bw-uppercase"},d.__("Booking Complete","bookster"),"Â ",u.createElement(k,{href:`${window.booksterMeta.pages.customerDashboardUrl}#/?apptId=${null==l?void 0:l.appointment_id}`,target:"_blank"},"#",null==l?void 0:l.appointment_id))),u.createElement("div",{className:b.cx("desktop"===h&&"bw-min-w-[16.875rem] bw-grow-0 bw-basis-3/5","bw-border-solid/60 bw-mx-auto bw-mt-4 bw-flex bw-max-w-[36rem] bw-flex-col bw-border-0 bw-pt-3")},u.createElement("div",null,u.createElement("h4",{className:"bw-mb-1 bw-text-lg"},null==i?void 0:i.name),m&&w&&u.createElement("p",{className:"bw-text-sm bw-text-primary"},m.format(a.DATE_TEMPLATE)," |"," ",L(w,null==(n=v.computed.bookingDuration)?void 0:n.duration)),u.createElement(b.Separator,{className:"bw-my-4"}),o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.ConfirmationBeforeCustomer,[]),(null==g?void 0:g.values)&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},s.customer),g.values.first_name," ",g.values.last_name),c&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},s.agent),c.first_name," ",c.last_name)),p&&u.createElement("p",{className:"bw-my-4 bw-flex bw-w-full bw-items-center bw-justify-between bw-rounded bw-bg-gray-100 bw-px-3 bw-py-1 bw-font-semibold"},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},d.__("Payment:","bookster")),"later"===p&&d.__("Will Pay Locally","bookster"),"full"===p&&d.__("Pay in Full","bookster")),_&&u.createElement(u.Fragment,null,_.booking.items.map((e=>u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:e.id},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},e.title," ( ",a.formatPrice(e.unitPrice)," x",e.quantity,")"),u.createElement("span",null,a.formatPrice(e.amount))))),_.adjustment.items.map((e=>u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:e.id},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},e.title),u.createElement("span",null,a.formatPrice(e.amount))))),_.tax.items.length>0&&u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between bw-font-semibold",key:"adjustment-subtotal"},u.createElement("span",{className:"bw-text-xs bw-uppercase"},d.__("Subtotal","bookster")),u.createElement("span",null,a.formatPrice(_.adjustment.subtotal))),_.tax.items.map((e=>u.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:e.id},u.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-gray-500"},e.title),u.createElement("span",null,a.formatPrice(e.amount)))))),u.createElement(b.Separator,{className:"bw-my-4"}),u.createElement("p",{className:"bw-mb-0 bw-flex bw-w-full bw-items-center bw-justify-between bw-text-lg bw-font-bold"},u.createElement("span",{className:"bw-font-medium"},d.__("Total","bookster")),_&&a.formatPrice(_.tax.total)))))),!0===(null==g?void 0:g.isNewCustomer)&&u.createElement("div",{className:"bw-mx-4 bw-my-4 bw-flex bw-justify-center"},u.createElement("div",{className:"bw-overflow-x-auto bw-text-wrap bw-rounded-lg bw-border bw-border-success/40 bw-px-4 bw-py-2 bw-text-success"},d.__("New Account Created. Please check your email to verify account.","bookster"))),!1===(null==g?void 0:g.isNewCustomer)&&u.createElement(b.Button,{color:"primary",variant:"outline",className:"bw-mx-auto bw-my-4 bw-text-wrap",onClick:function(){y.mutate.reset()}},d.__("Book Another Appointment","bookster")))}function ge(){const{customerRecord:t,wpUserInfo:a}=g(),n=e.useBookingStore(),r=e.useBookingState((e=>e.select.contact)),l=e.useBookingLogic().process,[s]=p.Form.useForm();let i={customer_id:(null==r?void 0:r.values.customer_id)||(null==t?void 0:t.customer_id),first_name:(null==r?void 0:r.values.first_name)||(null==t?void 0:t.first_name)||(null==a?void 0:a.firstName),last_name:(null==r?void 0:r.values.last_name)||(null==t?void 0:t.last_name)||(null==a?void 0:a.lastName),email:(null==r?void 0:r.values.email)||(null==t?void 0:t.email)||(null==a?void 0:a.email),phone:(null==r?void 0:r.values.phone)||(null==t?void 0:t.phone),customer_note:(null==r?void 0:r.values.customer_note)??""};return i=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingFormContact.contactInitValues,i,null==r?void 0:r.values,t,a),u.createElement(u.Fragment,null,u.createElement(b.ScrollArea,{className:"btr-main-scrollarea"},u.createElement(b.XyzTransition,{appear:!0,className:"bw-p-4",xyz:"fade down-4"},u.createElement("div",null,u.createElement(p.Form,{form:s,layout:"vertical",initialValues:i,onFinish:function(e){n.setState((t=>{t.select.contact={values:e,isNewCustomer:!1}})),l.mutate.nextAct()},name:"btr-booking-contact"},u.createElement(p.Form.Item,{name:"customer_id",hidden:!0},u.createElement(b.Input,null)),u.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},u.createElement(p.Form.Item,{label:d.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},u.createElement(b.Input,{placeholder:d.__("Please enter first name","bookster")})),u.createElement(p.Form.Item,{label:d.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},u.createElement(b.Input,{placeholder:d.__("Please enter last name","bookster")})),u.createElement(p.Form.Item,{label:d.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},u.createElement(b.Input,{placeholder:d.__("Please enter email","bookster"),disabled:!0})),u.createElement(p.Form.Item,{label:d.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:h,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},u.createElement(b.PhoneInput,null)),o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingFormContact.ContactAfterPhone,[]),u.createElement(p.Form.Item,{className:"bw-col-span-full",label:d.__("Comments","bookster"),name:"customer_note"},u.createElement(b.Textarea,{rows:3,placeholder:d.__("Add comments","bookster")}))))))),u.createElement(e.MainFooter,{submitButton:u.createElement(b.Button,{key:"contact-submit",type:"submit",form:"btr-booking-contact"},d.__("Submit","bookster"))}))}const Ee=()=>{const{isLoading:e,login:t}=g(),[o,n]=i.useState(),[r]=p.Form.useForm();return u.createElement("div",{className:"bw-relative"},u.createElement(b.LoadingOverlay,{loading:e}),u.createElement(p.Form,{name:"btr-booking-login",layout:"vertical",className:"login-form",initialValues:{remember:!0},form:r,onFinish:async function(e){try{await t(e)}catch(o){const e=await a.getErrorJson(o),t=await a.getErrorMsg(o);n("incorrect_password"===e.code?u.createElement("p",{dangerouslySetInnerHTML:{__html:t}}):t)}}},o&&u.createElement("div",{className:"bw-mb-5 bw-border-0 bw-border-l-4 bw-border-solid bw-border-error bw-bg-gray-50 bw-py-2 bw-pl-6"},o),u.createElement(p.Form.Item,{label:d.__("Email Address","bookster"),name:"username",rules:[{type:"email",required:!0,message:d.__("Please input your email address!","bookster")}]},u.createElement(b.Input,{type:"email",placeholder:d.__("Your Email Address","bookster")})),u.createElement(p.Form.Item,{label:d.__("Password","bookster"),name:"password",rules:[{required:!0,message:d.__("Please input your password!","bookster")}]},u.createElement(b.PasswordInput,{placeholder:d.__("Password","bookster")})),u.createElement(p.Form.Item,null,u.createElement("div",{className:"bw-flex bw-justify-between"},u.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},u.createElement(p.Form.Item,{name:"remember",valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},u.createElement(b.Checkbox,{id:"remember"})),u.createElement(b.Label,{htmlFor:"remember",className:"bw-cursor-pointer"},d.__("Remember me","bookster"))),u.createElement("a",{className:"login-form-forgot",href:window.booksterMeta.wpPath.lossPasswordUrl},d.__("Forgot password","bookster"))))))},ye=()=>{const[t]=p.Form.useForm(),a=e.useBookingStore(),n=e.useBookingLogic().process,r=i.useRef("");return u.createElement(p.Form,{name:"btr-booking-new-customer",layout:"vertical",initialValues:{remember:!0},form:t,onFinish:e=>{a.setState((t=>{t.select.contact={values:e,isNewCustomer:!0}})),n.mutate.nextAct()},autoComplete:"off"},u.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},u.createElement(p.Form.Item,{label:d.__("First Name","bookster"),name:"first_name",rules:[{required:!0,message:d.__("First Name is required","bookster")}]},u.createElement(b.Input,{placeholder:d.__("Your Last Name","bookster")})),u.createElement(p.Form.Item,{label:d.__("Last Name","bookster"),name:"last_name",rules:[{required:!0,message:d.__("Last Name is required","bookster")}]},u.createElement(b.Input,{placeholder:d.__("Your First Name","bookster")})),u.createElement(p.Form.Item,{label:d.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:h,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},u.createElement(b.PhoneInput,null)),u.createElement(p.Form.Item,{label:d.__("Email","bookster"),name:"email",rules:[{required:!0,validateTrigger:["onBlur","onChange"],message:d.__("Email Address is required","bookster")},{type:"email",validateTrigger:["onBlur","onChange"],message:d.__("Please enter valid email!","bookster")},{validateTrigger:"onBlur",validator:async(e,t)=>{t&&t===r.current||(await E(t),r.current=t)}}],validateTrigger:["onBlur","onChange"],validateFirst:!0,hasFeedback:!0},u.createElement(b.Input,{placeholder:d.__("Your Email Address","bookster")})),o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingFormContact.ContactAfterPhone,[]),u.createElement(p.Form.Item,{className:"bw-col-span-full",label:d.__("Comments","bookster"),name:"customer_note"},u.createElement(b.Textarea,{maxLength:100,placeholder:d.__("Add Comments","bookster"),rows:4}))))};function ve(){const[t,a]=i.useState("newCustomer"),{isLoading:o}=g(),n="newCustomer"===t?"btr-booking-new-customer":"btr-booking-login";return u.createElement(u.Fragment,null,u.createElement("div",{className:"bw-w-full bw-flex-1 bw-overflow-y-scroll bw-px-4"},u.createElement(b.XyzTransition,{appear:!0,xyz:"fade down-4"},u.createElement(b.Tabs,{value:t,onValueChange:a},u.createElement(b.TabsList,{className:"bw-gap-3 bw-overflow-x-hidden bw-pt-4 bw-text-xs sm:bw-gap-6","aria-label":"tabs settings"},u.createElement(b.LineTabsTrigger,{className:"bw-text-sm sm:bw-text-base",value:"newCustomer"},d.sprintf(d.__("New %(customer)s","bookster"),y)),u.createElement(b.LineTabsTrigger,{className:"bw-text-sm sm:bw-text-base",value:"login"},d.__("Already have an account?","bookster"))),u.createElement(b.TabsContent,{className:"bw-w-full",value:"newCustomer",forceMount:!1},u.createElement(ye,null)),u.createElement(b.TabsContent,{value:"login",forceMount:!1},u.createElement(Ee,null))))),u.createElement(e.MainFooter,{submitButton:u.createElement(b.LoadingButton,{key:"contact-submit",type:"submit",disabled:o,loading:o,form:n},"btr-booking-login"===n?d.__("Login","bookster"):d.__("Submit","bookster"))}))}function _e(t){const{wpUserInfo:a}=g();return u.createElement("div",{...t},u.createElement(e.MainHeader,null),a.isLoggedIn&&u.createElement(ge,null),!a.isLoggedIn&&u.createElement(ve,null))}function he({date:t}){const a=e.useBookingStore(),o=e.useBookingState((e=>e.datetime.timestamps.earliest)),n=e.useBookingState((e=>e.datetime.timestamps.latest)),r=i.useMemo((()=>t.isAfter(o,"month")),[t,o]),l=i.useMemo((()=>null===n||t.isBefore(n,"month")),[t,n]);function s(e){a.setState((t=>{t.datetime.picker.bookMonth=e,t.datetime.picker.bookDate=null,t.datetime.picker.bookTime=null}))}return u.createElement("div",{className:"bw-flex bw-h-14 bw-items-center bw-justify-between bw-px-4"},u.createElement("h4",{className:"bw-text-lg bw-font-semibold"},t.format("MMMM")),u.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 -bw-space-x-px rtl:bw-flex-row-reverse"},u.createElement(b.Button,{variant:"trivial",disabled:!r,size:"icon",onClick:()=>{s(t.subtract(1,"month"))}},u.createElement(f.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),u.createElement(b.Button,{variant:"trivial",disabled:!l,size:"icon",onClick:()=>{s(t.add(1,"month"))}},u.createElement(f.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))))}const xe=i.forwardRef(((e,t)=>{const{children:a,available:o,fullyBooked:n,today:r,restricted:l,dayOff:s,outOfMonth:i,selected:c,className:m,...d}=e;return u.createElement("div",{ref:t,className:b.cx("btr-book-date-cell-wrapper bw-relative bw-m-auto bw-flex bw-h-10 bw-w-10 bw-items-center bw-justify-center bw-rounded-md bw-bg-white bw-p-0.5 bw-font-medium",o&&"btr-book-date-cell-wrapper__available bw-cursor-pointer",s&&"bw-bg-warning/30",c&&"btr-book-date-cell-wrapper__selected bw-bg-primary/80",m),...d},u.createElement("div",{className:b.cx("btr-book-date-cell-inner bw-rounded-full bw-text-base bw-font-semibold bw-transition-all bw-duration-100 bw-ease-out",o&&"bw-text-info",n&&"bw-text-warning",r&&"bw-text-success",l&&"bw-text-gray-500/60",s&&"bw-text-gray-500/60",i&&"bw-text-gray-500/60",c&&"btr-book-date-cell-inner__selected -bw-mt-1 bw-text-lg bw-text-white")},a))}));function Se({children:e,content:t}){return u.createElement(b.TooltipRoot,null,u.createElement(b.TooltipTrigger,{asChild:!0},e),u.createElement(b.TooltipPortal,null,u.createElement(b.TooltipContent,{className:"bw-z-[100001] bw-py-0.5"},t)))}const Ne=b.stylex.div("bw-bg-black/10 bw-absolute bw-bottom-1 bw-left-1 bw-right-1 bw-m-0 bw-h-1 bw-overflow-hidden bw-rounded-sm"),Ae=b.styled.div("bw-absolute bw-left-0 bw-bottom-0 bw-top-0 bw-z-10 bw-bg-secondary");function Me({percentage:e}){return u.createElement(Ne,null,u.createElement(Ae,{style:{width:`${e}%`}}))}function Ce(){return u.createElement(Ne,{className:"bw-bg-warning"})}function Be({date:t}){const a=e.useBookingStore(),{picker:o,timestamps:r}=e.useBookingState((e=>e.datetime)),{bookMonth:l,bookDate:s}=o,{datetime:c}=e.useBookingLogic(),{agentSchedule:m,monthTimeSlots:b,monthAvailableTimeSlots:w}=c.computed;if(null===m||null===b)throw new Error(d.sprintf(d.__("The Form is not working correctly. %(agent)s and %(service)s need to be selected first!","bookster"),y));const p=i.useMemo((()=>t.format("DD")),[t]),f=i.useMemo((()=>!t.isSame(l,"month")),[t,l]),k=i.useMemo((()=>t.isSame(r.now,"day")),[t,r.now]),g=i.useMemo((()=>t.isSame(s,"day")),[t,s]),E=i.useMemo((()=>t.format(n.DAY_KEY_FORMAT)),[t]),v=b[E],_=null===w||f?null:w[E],h=null!==_&&0===_.timeSlotCountAvailable,x=(null==_?void 0:_.isRestricted)||(null==v?void 0:v.isRestricted)||!1,S=(null==_?void 0:_.isDayOff)||(null==v?void 0:v.isDayOff)||!1,N=(null==_?void 0:_.dayOffLabel)||(null==v?void 0:v.dayOffLabel)||"",A=f||x||S,M=i.useCallback((e=>{var o;e.preventDefault(),e.stopPropagation(),A||g||h||(o=t,a.setState((e=>{e.datetime.picker.bookDate=o,e.datetime.picker.bookTime=null})))}),[A,t]),C={available:!h,fullyBooked:h,today:k,restricted:x,dayOff:S,outOfMonth:f,selected:g};return f||x?u.createElement(xe,{...C},p):u.createElement(Se,{content:Te(_,S,N)},u.createElement(xe,{onClick:M,...C},p,!A&&h&&u.createElement(Ce,null),!A&&!h&&_&&u.createElement(Me,{percentage:_.timeSlotCountAvailable/_.timeSlotCountTotal*100})))}function Te(e,t,a){return t?a??d.__("Day Off","bookster"):null===e?"Loading...":0===e.timeSlotCountAvailable?d.__("Fully Booked","bookster"):`${e.timeSlotCountAvailable} `+d.__("Available Time Slots","bookster")}function Fe(t){const a=e.useBookingState((e=>e.datetime.picker.bookMonth));return u.createElement("div",{id:"bookster-calendar",className:"bw-m-auto bw-mb-2 bw-max-w-lg",...t},u.createElement(p.Calendar,{className:"btr-date-picker",fullscreen:!1,mode:"month",validRange:[a.startOf("month"),a.endOf("month")],value:a,headerRender:({value:e})=>u.createElement(he,{date:e}),fullCellRender:e=>u.createElement(Be,{date:e})}))}function Oe({timeSlot:t,mode:a="range"}){const o=e.useBookingStore(),n=e.useBookingState((e=>e.datetime.picker.bookTime)),r=null!==n&&n.absMinute===t.start.absMinute,l=i.useCallback((e=>{e.preventDefault(),e.stopPropagation(),!0===t.isAvailable&&o.setState((e=>{e.datetime.picker.bookTime=t.start}))}),[o,t]);return u.createElement(b.Button,{type:"submit",variant:r?"outline":"trivial",className:b.clsx("bw-relative bw-w-full hover:bw-bg-inherit",!r&&"bw-border-dashed"),disabled:!t.isAvailable,onClick:l},"single"===a&&t.startLabel,"range"===a&&`${t.startLabel} - ${t.endLabel}`,u.createElement(b.Chip,{show:!!r},r&&u.createElement("div",{className:"bw-flex bw-h-4 bw-w-4 bw-items-center bw-justify-center bw-rounded-full bw-bg-primary"},u.createElement(f.Check,{className:"bw-h-3 bw-w-3 bw-text-white"}))))}function De(t){const a=e.useBookingState((e=>e.datetime.picker.bookDate)),{datetime:o}=e.useBookingLogic(),{monthTimeSlots:r,monthAvailableTimeSlots:l}=o.computed;if(null===r)throw new Error(d.sprintf(d.__("The Form is not working correctly. %(agent)s and %(service)s need to be selected first!","bookster"),y));const s=i.useMemo((()=>null===a?null:a.format(n.DAY_KEY_FORMAT)),[a]),c=null===s?null:r[s],m=null===s||null===l?null:l[s],w=((null==c?void 0:c.periods.reduce(((e,t)=>e+t.timeSlots.length),0))??0)>10?"single":"range";return u.createElement(b.XyzTransitionGroup,{appear:!0,className:b.cx("bw-m-4 bw-grid bw-justify-items-stretch bw-gap-4","12h"===Pe&&"range"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(11rem,1fr))]","24h"===Pe&&"range"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(8rem,1fr))]","12h"===Pe&&"single"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(6rem,1fr))]","24h"===Pe&&"single"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(4rem,1fr))]"),xyz:"fade up delay-0.5 out-duration-0 out-delay-0",...t},null===m&&null!==c&&c.periods.map(((e,t)=>e.timeSlots.map((e=>u.createElement("div",{key:`slot-${s}-${t}-${e.start.absMinute}`},u.createElement(Oe,{timeSlot:e,mode:w})))))),null!==m&&m.periods.map(((e,t)=>e.timeSlots.map((e=>u.createElement("div",{key:`slot-${s}-${t}-${e.start.absMinute}`},u.createElement(Oe,{timeSlot:e,mode:w})))))))}const Pe=window.booksterPublicData.generalSettings.time_system;function Le(t){const a=e.useBookingStore(),o=e.useBookingLogic().process,n=e.useBookingState((e=>e.datetime.picker.bookTime));return u.createElement("div",{...t},u.createElement(e.MainHeader,null),u.createElement(b.ScrollArea,{className:"btr-main-scrollarea"},u.createElement(b.XyzTransition,{appear:!0,xyz:"fade down-4"},u.createElement("div",null,u.createElement(Fe,null))),u.createElement(b.SectionSeparator.Title,{align:"center",className:"bw-m-0"},d.__("Pick Appointment Time","bookster")),u.createElement(De,null)),u.createElement(e.MainFooter,{submitButton:u.createElement(b.Button,{key:"datetime-submit",disabled:null===n,onClick:function(){a.setState((e=>{e.select.bookDate=e.datetime.picker.bookDate,e.select.bookTime=e.datetime.picker.bookTime})),o.mutate.nextAct()}},d.__("Confirm","bookster"))}))}function Ie({text:e,color:t}){return u.createElement("div",{className:"bw-absolute -bw-end-2 bw-top-2 bw-m-0 bw-list-none bw-whitespace-nowrap bw-rounded bw-rounded-ee-none bw-px-2 bw-py-0 bw-leading-6",style:{backgroundColor:t}},u.createElement("span",{className:"bw-text-base bw-text-white"},e),u.createElement("div",{className:"bw-absolute bw-end-0 bw-top-full bw-h-2 bw-w-2 bw-origin-top bw-scale-y-75 bw-border-4 bw-border-solid bw-border-white",style:{borderInlineStartColor:t,borderBlockStartColor:t}}))}function He(t){const n=a.usePublicActiveServices(),r=e.useBookingStore(),l=e.useBookingState((e=>e.select.agent)),s=e.useBookingLogic().process,i=e.useBookingConfig();let c=n.map((e=>({...e,services:e.services.filter((e=>{if(l){const t=e.available_agent_services.find((e=>e.agent_id===l.agent_id));if(t&&!1===t.available)return!1}return!0}))})));return c=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.servicesList,c,r,i),u.createElement("div",{...t},u.createElement(e.MainHeader,null),u.createElement(b.ScrollArea,{className:"btr-main-scrollarea"},u.createElement(b.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(14rem,1fr))] bw-gap-4 bw-p-4",xyz:"fade down-4 stagger-0.5"},c.map((e=>e.services.map((t=>u.createElement(x,{key:t.service_id,service:t,onClick:()=>function(e){r.setState((t=>{t.select.service=e})),s.mutate.nextAct()}(t),cateRibbon:u.createElement(Ie,{text:e.name,color:t.theme_color})}))))))),u.createElement(e.MainFooter,null))}function je(t){switch(t.process.computed.act){case e.ACT_NAME.selectService:return{key:"select-service",node:u.createElement(He,null)};case e.ACT_NAME.selectAgent:return{key:"select-agent",node:u.createElement(ae,null)};case e.ACT_NAME.selectDateTime:return{key:"select-date-time",node:u.createElement(Le,null)};case e.ACT_NAME.formContact:return{key:"form-contact",node:u.createElement(_e,null)};case e.ACT_NAME.selectPayOption:return{key:"select-pay-option",node:u.createElement(fe,null)};case e.ACT_NAME.showAppointment:return{key:"show-appointment",node:u.createElement(ke,null)};default:return{key:"ui-not-found",node:u.createElement("div",null,"UI Not Found")}}}function qe({children:t}){const a=e.useBookingConfig(),n=e.useBookingState((e=>e)),r=e.useBookingLogic(),l=function(e){return{layout:{key:"default-layout",node:u.createElement($,null)},sidebar:{key:"default-sidebar",node:u.createElement(Q,null)},summary:{key:"default-summary",node:u.createElement(ee,null)},summarySelect:{key:"default-summary-select",node:u.createElement(te,null)},summaryCost:{key:"default-summary-cost",node:u.createElement(J,null)},main:je(e)}}(r),s=o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.bookingParts,l,a,n,r);return u.createElement(e.BookingPartsContext.Provider,{value:s},t)}function ze(e){const t={process:{current:{stepIndex:0,actIndex:0}},select:{service:null,agent:null,bookDate:null,bookTime:null,contact:null,payOption:null},datetime:{timestamps:D,picker:{bookMonth:Re(),bookDate:null,bookTime:null}},booked:{state:"idle",transaction:null,appointment:null,customer:null},customize:{...window.booksterManagerData?window.booksterManagerData.customizeSettings:window.booksterPublicData.customizeSettings,labels:window.booksterMeta.recordLabels}};return o.booksterHooks.applyFilters(o.HOOK_NAMES.bookingForm.bookingInitState,t,e)}let Ke;function Re(){var e;if(Ke)return Ke;const t=D.earliest;if(t.date()<20)return Ke=t.startOf("month"),Ke;const o=v(),n=t.month();let r=t.clone();do{if(!(null==(e=a.calculateIsDayOff(r,o))?void 0:e.isDayOff))return Ke=r.startOf("month"),Ke;r=r.add(1,"day")}while(r.month()===n);return Ke=r.startOf("month"),Ke}let Ve=!1;function Ye({config:t,children:a}){const o=i.useRef();return o.current||(o.current=(t=>{const a=ze(t);return e.createBookingStore(a)})(t)),u.createElement(e.BookingConfigContext.Provider,{value:t},u.createElement(e.BookingStoreContext.Provider,{value:o.current},u.createElement(Y,null,u.createElement(qe,null,a))))}Ve||(Ve=!0,o.booksterHooks.addFilter(o.HOOK_NAMES.bookingForm.mutateNextAct,"bookster/onBookingSuccess",(function(e,t,n,{oldPhase:r,newPhase:l},s){var i;return"complete"===l&&r!==l&&"success"===t.booked.state&&(a.queryClient.invalidateQueries(["bookedApptsByAgent"]),a.queryClient.invalidateQueries(["bookedApptsByUser"]),a.queryClient.invalidateQueries(["appointments"]),!1===(null==(i=t.select.contact)?void 0:i.isNewCustomer)&&s.booked.customer&&o.booksterHooks.doAction(o.HOOK_NAMES.auth.doUpdateCustomerRecord,s.booked.customer)),e})),o.booksterHooks.addFilter(o.HOOK_NAMES.bookingForm.mutatePrevAct,"bookster/deselectOnCancel",(function(t,a,o,{oldActName:n,newActName:r,newPhase:l,oldPhase:s}){switch(r){case e.ACT_NAME.selectService:a.select.service=null;break;case e.ACT_NAME.selectAgent:a.select.agent=null;break;case e.ACT_NAME.selectDateTime:a.select.bookDate=null,a.select.bookTime=null;break;case e.ACT_NAME.selectPayOption:a.select.payOption=null}return n===e.ACT_NAME.selectDateTime&&(a.datetime.picker.bookDate=null,a.datetime.picker.bookTime=null),l!==s&&"complete"===s&&(a.booked={state:"idle",appointment:null,transaction:null,customer:null}),t}),5));export{Ye as B,A as a,M as b,B as c,N as d,ze as e,T as f,C as g,D as s};
