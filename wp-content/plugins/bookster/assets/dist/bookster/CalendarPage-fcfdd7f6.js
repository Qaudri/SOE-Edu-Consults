import{c as e,R as t,_ as a,a as r,b as n,f as s,r as l}from"./prefetch.helper-04349684.js";import{u as o,a as i,b as c,C as m,m as d,r as b,c as u,d as p}from"./CalendarContent-e50ff6c3.js";import{P as w,a as g}from"./UIComponents-7ff4460b.js";import{A as f}from"./AppointmentFormDrawer-884f27d3.js";import{m as h,a as v}from"./main-70b6d0e7.js";import{m as E}from"./main-6566bc29.js";import{u as y,f as k}from"./store-bdc614dc.js";import{i as x,S as _,j as C}from"./appointment.helper-07645f99.js";import{u as A,a as j}from"./useAgentResources-6fea2cc0.js";import{S as N,P as S}from"./queue.helper-cc60359e.js";import{c as F,u as M}from"./BEConfigProvider-705eafe2.js";import{A as D}from"./ApptsFilterAgent-3decfdb7.js";import{A as P,a as R,b as T}from"./ApptsFilterService-c1f460fc.js";import{N as G,a as I,b as W}from"./CalendarNav.styled-cb1aebbc.js";import{T as H}from"./ReloadButton-117ef334.js";import"./react-dom-3e43fe1d.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./useCacheCustomers-102bfcf8.js";function V({className:n,...s}){const l=e.useActiveAgents(),[o,i]=e.useSearchParams(),c=o.get("agent"),m=(c?c.split(","):[]).map((e=>parseInt(e,10)));return t.createElement("div",{className:a.cx("btr-scrollbar-xs bw-w-full bw-overflow-x-auto bw-pb-2",n),...s},t.createElement("div",{className:"bw-flex"},l.map((e=>t.createElement("div",{className:a.cx("bw-group bw-mr-2.5 bw-inline-flex bw-w-[60px] bw-flex-col bw-items-center bw-gap-2 last:bw-mr-0",m.length<2&&"bw-cursor-pointer"),onClick:()=>{return m.length<2?(t=e.agent_id,void(m.includes(t)||i((e=>(e.delete("agent"),e.set("agent",[t].join(",")),e))))):null;var t}},t.createElement("div",{className:a.cx("bw-rounded-full bw-border-2 bw-border-solid bw-border-transparent bw-duration-300 ",m.length<2&&"group-hover:bw-border-gray-900",m.includes(e.agent_id)&&"!bw-border-primary")},t.createElement(a.Avatar,{className:a.cx("bw-h-12 bw-w-12 bw-border bw-border-solid bw-border-[#727D904D] bw-duration-300",m.length<2&&"group-hover:bw-border-white",m.includes(e.agent_id)&&"!bw-border-white")},t.createElement(a.AvatarImage,{src:e.transient_avatar_url}),t.createElement(a.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"})))),t.createElement("span",{className:a.cx("bw-line-clamp-1 bw-whitespace-normal bw-text-[10px] bw-leading-3 bw-text-gray-500",m.length<2&&"group-hover:bw-text-gray-900")},`${e.first_name} ${e.last_name}`))))))}function B({isFetching:l,isSaving:i}){const{getCalendarApi:c}=o(),{title:m,type:d}=y((e=>e.calendar.view)),b=y((e=>e.calendarToday)),u=y((e=>e.calendarPrev)),p=y((e=>e.calendarNext)),g=y((e=>e.calendarChangeView)),f=e.useQueryClient();return e.useSearchParams(),e.usePublicActiveAgents(),t.createElement(t.Fragment,null,t.createElement(w.Standalone,null,"resourceTimelineDay"===d&&n.__("Day Schedule","bookster"),"timeGridWeek"===d&&n.__("Week Schedule","bookster"),"dayGridMonth"===d&&n.__("Month Schedule","bookster")),t.createElement(a.Collapsible,null,t.createElement("div",{className:"bw-mb-4 bw-flex bw-flex-wrap bw-items-center bw-gap-2"},t.createElement(a.CollapsibleTrigger,{asChild:!0},t.createElement(G,null,t.createElement(r.Filter,null)," ",n.__("Filters","bookster"))),t.createElement(G,{onClick:()=>b(c())},n.__("Today","bookster")),t.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(I,{onClick:()=>u(c())},t.createElement(r.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(I,{onClick:()=>p(c())},t.createElement(r.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(W,null,m," ",t.createElement(N,{isSaving:i})),t.createElement(a.SegmentGroup,{size:"medium",value:d,onValueChange:e=>{F({calendarViewManager:e}),function(e){g(c(),e)}(e)}},t.createElement(a.SegmentGroupItem,{value:"resourceTimelineDay"},n.__("Day","bookster")),t.createElement(a.SegmentGroupItem,{value:"timeGridWeek"},n.__("Week","bookster")),t.createElement(a.SegmentGroupItem,{value:"dayGridMonth"},n.__("Month","bookster"))),t.createElement(H,{className:"bw-bg-white",onClick:()=>f.invalidateQueries({queryKey:["appointments","events"]}),isFetching:l})),t.createElement(a.CollapsibleContent,{forceMountWithAnimation:!0},t.createElement("div",{className:"bw-mb-3 bw-flex bw-flex-wrap bw-items-center bw-gap-x-4 bw-gap-y-3 bw-rounded bw-border bw-border-solid bw-border-gray-100 bw-bg-white bw-px-4 bw-py-3.5"},t.createElement("span",{className:"bw-text-sm"},n.__("Select","booster")),t.createElement(D,null),t.createElement(P,null),t.createElement(R,null),s.booksterHooks.applyFilters(s.HOOK_NAMES.adminCalendar.BeforeApptsFilterClear,[]),t.createElement(T,null)))))}const L=new S;function Q(){const{activeStart:r,activeEnd:n,type:s}=y((e=>e.calendar.view)),p=y((e=>e.initAppointmentForm)),[w,g]=l.useState(null),f=y((e=>e.calendarRefresh)),{toast:N}=a.useToast(),{resources:S,slotMinAbs:F,slotMaxAbs:D}=A(),[P]=e.useSearchParams(),R=P.get("agent"),{invalidateLazy:T,invalidateNow:G,updateModel:I}=i(),W=c(r,n),{data:H,isFetching:Q,isRefetching:$}=j(W),{getCalendarApi:O,calendarRef:U}=o();l.useEffect((()=>{if(void 0!==H&&U.current){const e=O();e.batchRendering((()=>{e.removeAllEvents(),H.forEach((t=>e.addEvent(t)))}))}}),[H,U.current]),l.useEffect((()=>{if(void 0!==S&&U.current){const e=O();let t=S;if(R){const e=R.split(",");t=t.filter((t=>e.includes(t.id)))}e.batchRendering((()=>{e.getResources().forEach((e=>e.remove())),t.forEach((t=>e.addResource(t)))}))}}),[S,R,U.current]),l.useEffect((()=>{f(O())}),[]);const q=e.useQueryClient(),z=M();return t.createElement(t.Fragment,null,t.createElement(B,{key:"calendar-nav",isSaving:w,isFetching:Q||$}),"resourceTimelineDay"!==s&&t.createElement(V,{key:"agent-picker",className:"bw-mb-4"}),t.createElement("div",{key:"calendar-container",className:a.cx("bw-rounded-lg bw-bg-white bw-p-2.5 bw-pl-0 bw-shadow-sm","timeGridWeek"===s&&"bw-pl-0","dayGridMonth"===s&&"bw-p-0")},t.createElement(m,{key:"manager-calendar",plugins:[h,v,E,d],initialView:s,allDaySlot:!1,slotMinTime:60*F*1e3,slotMaxTime:60*D*1e3,eventContent:b,dateClick:function(t){if("fc-non-business"===t.jsEvent.target.className)return;const a=x(t.date);var r;r={book_date:a,start_time:"dayGridMonth"===s?e.bookHelper.booktime.createFromAbsMinute(_.slotMinAbs):e.bookHelper.booktime.createFromDayjs(a),agent_ids:t.resource?[parseInt(t.resource.id)]:[]},p(r),z("new")},eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,q.setQueryData(["appointment",t.appointment_id],t),z(`${t.appointment_id}`)},eventDrop:async function(t){const a=t.event;if(!a.start||!a.end)return;const r=C(a.extendedProps.model,a.start,a.end),n=t.newResource;n&&(r.agent_ids=[parseInt(n.id)]),L.add((async()=>{g(!0);try{const e=await k(parseInt(t.event.id),r);t.event.setExtendedProp("model",e),I(e),T()}catch(a){throw g(null),N.error(await e.getErrorMsg(a)),G(),t.revert(),a}}),(()=>{g(!1)}))},editable:!0,resourceAreaHeaderContent:t.createElement(t.Fragment,null),resourceAreaWidth:58,resourceLabelContent:u})))}function $(){return t.createElement(g,null,t.createElement(p,null,t.createElement(Q,null)),t.createElement(f,{parentPath:"/calendar"},t.createElement(e.Outlet,null)))}export{$ as default};
