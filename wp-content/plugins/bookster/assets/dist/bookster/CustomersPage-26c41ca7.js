import{c as e,R as t,_ as a,a as n,b as r,r as l,L as o}from"./prefetch.helper-04349684.js";import{a as s,P as i}from"./UIComponents-7ff4460b.js";import{u as c}from"./BEConfigProvider-705eafe2.js";import{s as m,a as u}from"./apptDataTable-a0a4fccd.js";import{i as w}from"./store-bdc614dc.js";import{w as d}from"./useCacheCustomers-102bfcf8.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./appointment.helper-07645f99.js";function b({children:n}){const r=e.useMatch("/customers"),l=c(),o=null===r,s=e.useIsMutating({mutationKey:["customers"]});return t.createElement(a.Drawer,{open:o,onOpenChange:e=>{e||s||l(".")}},t.createElement(a.DrawerPortalContent,null,n))}function p({className:l,...o}){const[s,i]=e.useSearchParams(),c=s.get("keywords");return t.createElement("div",{className:a.clsx("bw-relative",l)},t.createElement(a.InputPrefix,null,t.createElement(n.Search,null)),t.createElement(a.Input,{size:"medium",className:"bw-ps-10",withStatus:!1,value:c??"",onChange:e=>{const t=e.target.value??"";var a;a=t,i((e=>(e.set("keywords",a),e)))},placeholder:r.__("Search","bookster"),...o}))}const g=e.createColumnHelper(),E=[m,g.accessor((e=>e.first_name+" "+e.last_name),{id:"name",header:r.__("Name","bookster"),cell:({row:e})=>t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(a.Avatar,{className:"bw-h-[30px] bw-w-[30px]"},t.createElement(a.AvatarImage,{src:e.original.transient_avatar_url}),t.createElement(a.AvatarFallback,{className:"bw-text-xs"},t.createElement(n.User,{className:"bw-h-3 bw-w-3"}))),e.original.first_name," ",e.original.last_name)}),g.accessor("email",{id:"email",header:r.__("Email","bookster")}),g.accessor("phone",{id:"phone",header:r.__("Phone","bookster")}),g.accessor("wp_user_id",{id:"wp_user_id",header:r.__("WP User","bookster"),cell:({row:e})=>t.createElement(t.Fragment,null,e.original.wp_user_id&&e.original.wp_user_display_name?t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(n.Link,{className:"bw-text-info"}),t.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${e.original.wp_user_id}`,target:"_blank",onClick:e=>e.stopPropagation(),className:"bw-text-info bw-no-underline hover:bw-text-info"},e.original.wp_user_display_name)):t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(n.Unlink,null),t.createElement("span",null,r.__("Not Linked","bookster"))))}),u];function _({ids:o}){const{toast:s}=a.useToast(),i=e.useQueryClient(),[c,m]=l.useState(!1),u=e.useQuery({queryKey:["appointments","by-customers",o],queryFn:()=>w({in_args:{customer_id:{values:o,placeholder:"%d",alias:"booking"}}}),enabled:c}),b=e.useIsMutating({mutationKey:["customers"]}),p=e.useMutation({mutationKey:["customers",o,"delete"],mutationFn:d,onSuccess:()=>{i.invalidateQueries({queryKey:["customer"]}),i.invalidateQueries({queryKey:["customers"]})}});return t.createElement(a.Popover,{open:c,onOpenChange:m},t.createElement(a.PopoverTrigger,{asChild:!0},t.createElement(a.Button,{color:"error",variant:"link"},p.isLoading?t.createElement(n.Loader2,{className:"bw-h-4 bw-w-4 bw-animate-spin"}):t.createElement(n.Trash,{className:"bw-h-4 bw-w-4"}),r.__("Delete Data","bookster"))),t.createElement(a.ConfirmPopoverContent,null,t.createElement(n.AlertFilled,{className:"bw-text-error"}),t.createElement(a.ConfirmPopoverTitle,null,r.__("Delete Multiple Customers","bookster")),t.createElement(a.ConfirmPopoverDescription,null,r.sprintf(r.__("This action cannot be undone. This will permanently delete %s customers and their %s appointments.","bookster"),o.length,u.data??"...")),t.createElement(a.ConfirmPopoverActions,null,t.createElement(a.PopoverClose,{asChild:!0},t.createElement(a.Button,{variant:"soft"},r.__("Cancel","bookster"))),t.createElement(a.Button,{variant:"fill",onClick:async function(){if(o&&0!==o.length&&!b)try{await p.mutateAsync(o),m(!1),s.success("Customer Rows has been Deleted Successfully!")}catch(t){s.error(await e.getErrorMsg(t))}}},r.__("Confirm Delete","bookster")))))}function h(){const[n]=e.useSearchParams(),o=n.get("keywords"),s=a.useDebounce(o,{wait:500}),i=l.useMemo((()=>[]),[]),[m,u]=l.useState({}),{pagination:w,setPagination:d,pagingPayload:b}=e.usePagination(),p={...b,...s?{keywords:s}:{}},g=e.useQueryClient(),h=c(),{data:f,isLoading:y}=e.useQuery({queryKey:["customers",p],queryFn:()=>e.queryCustomers(p),keepPreviousData:!0}),v=e.useReactTable({data:(null==f?void 0:f.data)||i,columns:E,getRowId:e=>e.customer_id.toString(),getCoreRowModel:e.getCoreRowModel(),state:{pagination:w,rowSelection:m},onPaginationChange:d,onRowSelectionChange:u,manualPagination:!0,rowCount:null==f?void 0:f.total,autoResetPageIndex:!1});return a.useRemoveSelectOnChange(v,(e=>e.customer_id.toString()),f),a.useResetPageOnOverflow(v,f),t.createElement(t.Fragment,null,t.createElement(a.Table,null,t.createElement(a.TableHeader,null,t.createElement(a.TableHeadRow,null,v.getLeafHeaders().map((n=>t.createElement(a.TableHead,{key:n.id,style:{width:`${n.column.getSize()}px`}},e.flexRender(n.column.columnDef.header,n.getContext())))))),t.createElement(a.TableBody,null,v.getRowModel().rows.map((n=>t.createElement(a.TableRow,{key:n.original.customer_id,isSelected:n.getIsSelected(),onClick:()=>{var e;const t=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString();var a;(null==t?void 0:t.length)||(a=n.original,h(`${a.customer_id}`),g.setQueryData(["customer",a.customer_id],a))}},n.getAllCells().map((n=>t.createElement(a.TableCell,{key:n.id,style:{width:`${n.column.getSize()}px`}},e.flexRender(n.column.columnDef.cell,n.getContext()))))))),(y||0===(null==f?void 0:f.data.length))&&t.createElement(a.TableRow,{className:"bw-pointer-events-none"},t.createElement(a.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},t.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-gray-500"},y?`${r.__("Loading","bookster")}...`:r.__("No Data Found","bookster")))))),t.createElement(a.Pagination,{table:v}),t.createElement(a.TableToaster,null,t.createElement(a.TableToast,{open:Object.keys(m).length>0,onOpenChange:e=>{e||v.resetRowSelection()}},t.createElement(a.TableToastClose,null),t.createElement(a.TableToastTitle,null,Object.keys(m).length," ",r.__("Selected","bookster")),t.createElement(a.Separator,{orientation:"vertical"}),t.createElement(_,{ids:Object.keys(m).map(Number)}))))}function f(){const l=c();return t.createElement(s,null,t.createElement("div",{className:"bw-mb-2.5 bw-flex bw-flex-nowrap bw-items-center bw-gap-4"},t.createElement(i.Title,null,o.customers),t.createElement(p,{className:"bw-w-72 bw-min-w-44 bw-flex-shrink"}),t.createElement(a.Button,{variant:"outline",size:"medium",onClick:()=>{l("new")},className:"bw-border-gray-300 bw-bg-white bw-font-medium bw-text-gray-900"},t.createElement(n.Plus,{strokeWidth:"2",className:"bw-h-2.5 bw-w-2.5"}),r.__("New Customer","bookster"))),t.createElement(h,null),t.createElement(b,null,t.createElement(e.Outlet,null)))}export{f as default};
