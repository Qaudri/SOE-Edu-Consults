import{b as e,L as t,g as a,c as o,_ as s,R as r,d as n,u as i,f as l,a as c,r as m,z as b}from"./prefetch.helper-04349684.js";import{_ as u}from"./createBookTimeInput.helper-ed47ae63.js";import{d as p,e as d,B as w}from"./BookingFormRoot-a7a3ac97.js";import{u as g}from"./store-bdc614dc.js";import{r as _}from"./react-dom-3e43fe1d.js";import{H as f,B as v}from"./useCacheCustomers-102bfcf8.js";import{B as h}from"./BookingFormBlock-d69c0483.js";import"./agentSchedule.helper-648c495b.js";import"./ErrorAlert-4c797dab.js";import"./phoneInput.helper-806287af.js";import"./ServiceCard-1f94e7ea.js";import"./BEConfigProvider-705eafe2.js";import"./appointment.helper-07645f99.js";const E={agent_id:1,wp_user_id:null,avatar_id:null,first_name:"Jeremy",last_name:"Johnson",email:"jeremyjohnson@gmail.com",phone:"+146527879832",activated:!0,visibility:"public",priority:10,weekly_schedule_enabled:!1,weekly_schedule:null,dayoff_schedule_enabled:!1,dayoff_schedule:null,transient_avatar_url:"",transient_gallery_urls:[],wp_user_display_name:"",available_agent_services:[],created_at:"",updated_at:""},k={service_id:1,service_category_id:1,name:e.sprintf(e.__("Booking %(service)s title","bookster"),t),description:e.sprintf(e.__("Booking %(service)s description","bookster"),t),activated:!0,visibility:"public",price:"100",duration:60,buffer_before:0,buffer_after:0,theme_color:"#66CC8A",position:10,cover_id:1,transient_cover_url:"",transient_gallery_urls:[],available_agent_services:[],created_at:"",updated_at:""},y={customer_id:1,first_name:"John",last_name:"Doe",phone:"+0123456789",email:"john@doe.com",wp_user_id:1,avatar_id:null,admin_note:"",transient_avatar_url:"",wp_user_display_name:"",created_at:"",updated_at:""},O=a.dayjs(),S=o.bookHelper.booktime.createFromDayjs(O),N=O.add(k.duration,"minute"),x=O.format("YYYY-MM-DD HH:mm:ss"),C=N.format("YYYY-MM-DD HH:mm:ss"),z={state:"success",transaction:{transaction_id:1,transaction_secret_id:"secret-1234",appointment_id:1234,customer_id:1,payment_gateway:"payment-stripe",amount:"99.99",transaction_status:"succeeded",transaction_message:"Powered by Bookster Stripe",transaction_link:"",transaction_meta:{},created_at:"",updated_at:""},appointment:{service:k,booking:{customer:y,booking_id:1,appointment_id:1234,customer_id:1,payment_status:"complete",total_amount:"99.99",paid_amount:"99.99",customer_note:"",booking_details:{booking:{items:[],subtotal:0},adjustment:{items:[],subtotal:0},tax:{items:[],total:0}}},booking_count:1,agents:[E],appointment_id:1234,service_id:k.service_id,agent_ids:[E.agent_id],location_id:null,book_status:"approved",datetime_start:x,abs_min_start:S.absMinute,utc_datetime_start:x,datetime_end:C,abs_min_end:S.absMinute+k.duration,busy_datetime_start:x,busy_abs_min_start:S.absMinute,busy_datetime_end:C,busy_abs_min_end:S.absMinute+k.duration,buffer_before:0,buffer_after:0,staff_note:"",created_at:"",updated_at:""},customer:y};function A({stepIsOpen:t,stepOnOpenChange:a}){const o=u.useBookingStore(),{run:i}=s.useDebounceFn((e=>{o.setState((t=>{t.customize.content.help=e}))}),{wait:100,maxWait:200});return r.createElement(s.Collapsible,{className:s.cx("bw-overflow-hidden bw-rounded bw-border bw-border-solid bw-border-gray-100 bw-duration-300 hover:bw-border-gray-500",t&&"!bw-border-[#B5B7C7] "),onOpenChange:()=>a(t?void 0:"help"),open:t},r.createElement(s.CollapsibleTrigger,{asChild:!0},r.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-justify-between bw-px-5 bw-py-[11px] bw-text-sm bw-capitalize"},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},r.createElement("span",{className:" bw-font-medium bw-text-gray-900"},"Bottom text"),r.createElement("span",{className:"bw-h-[3px] bw-w-[3px] bw-rounded-full bw-bg-gray-500/20"}),r.createElement("span",null,e.__("Help","bookster"))))),r.createElement(s.CollapsibleContent,{forceMountWithAnimation:!0},r.createElement("div",{className:"bw-border-t bw-border-solid bw-border-gray-100 bw-p-5"},r.createElement(f,{className:"bw-mb-3 bw-uppercase"},r.createElement(v,null)," ",e.__("Styler","bookster")),r.createElement(n.Form.Item,{label:e.__("Desciption","bookster"),name:["customize","content","help"],rules:[{required:!0}]},r.createElement(s.Textarea,{rows:2,maxLength:200,className:"bw-h-36",onChange:e=>i(e.target.value)})))))}function H(){const e=u.useBookingStore(),t=u.useBookingConfig(),a=t.process.steps,{customerRecord:s,wpUserInfo:r}=i(),n=o.usePublicActiveServices(),c=o.usePublicActiveAgents(),m=n.find((e=>e.services.length>0));function b(e){let t=k;m&&m.services.length>0&&(t=m.services[0]),e.select.service=t}function p(e){let t=E;c.length>0&&(t=c[0]),e.select.agent=t}function w(e){e.datetime.picker.bookDate=O,e.datetime.picker.bookTime=S,e.select.bookTime=S,e.select.bookDate=O}function g(e){const t={values:{first_name:(null==s?void 0:s.first_name)||(null==r?void 0:r.firstName)||"Customer",last_name:(null==s?void 0:s.last_name)||(null==r?void 0:r.lastName)||"Demo",email:(null==s?void 0:s.email)||(null==r?void 0:r.email)||"customer_demo@gmail.com",phone:(null==s?void 0:s.phone)||"+123456789",customer_id:(null==s?void 0:s.customer_id)||1,customer_note:""},isNewCustomer:!1};e.select.contact=t}function _(e){e.select.payOption=window.booksterPublicData.paymentGateway.now?"full":"later",e.booked=z}return{jumpToStep:function(o){e.setState((e=>{!function(e){const a=d(t);delete a.customize,Object.assign(e,a)}(e);for(let t=0;t<a.length;t++){const s=a[t];if("datetime"===s.name&&w(e),s.name===o)return e.process.current.stepIndex=t,void(e.process.current.actIndex=0);switch(s.name){case"service":b(e);break;case"agent":p(e);break;case"datetime":break;case"contact":g(e);break;case"checkout":_(e)}l.booksterHooks.doAction(l.HOOK_NAMES.customize.setDemoStepValue,s,e)}}))}}}function B({stepName:t,stepIsOpen:a,stepOrder:o,triggerAction:i,stepOnOpenChange:c,...m}){const b=u.useBookingStore(),{jumpToStep:p}=H(),d=n.Form.useFormInstance(),w=n.Form.useWatch(["customize","content","steps",t,"title"],d),{run:g}=s.useDebounceFn((e=>{b.setState((a=>{a.customize.content.steps[t].title=e}))}),{wait:100,maxWait:200}),{run:_}=s.useDebounceFn((e=>{b.setState((a=>{a.customize.content.steps[t].description=e}))}),{wait:100,maxWait:200});return r.createElement(s.Collapsible,{className:s.cx("bw-group bw-overflow-hidden bw-rounded bw-border bw-border-solid bw-border-gray-100 bw-bg-white bw-duration-300 hover:bw-border-gray-500",a&&"!bw-border-[#B5B7C7] "),onOpenChange:()=>c(a?void 0:t),onClick:()=>p(t),open:a,...m},r.createElement(s.CollapsibleTrigger,{asChild:!0},r.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-justify-between bw-px-5 bw-py-[11px] bw-text-sm bw-capitalize"},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},r.createElement("span",{className:" bw-font-medium bw-text-gray-900"},"Step ",o),r.createElement("span",{className:"bw-h-[3px] bw-w-[3px] bw-rounded-full bw-bg-gray-500/20"}),r.createElement("span",null,`${w}`)),r.createElement("div",{className:"bw-flex bw-items-center bw-gap-3"},l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.StepBookingTrigger_+t,[]),i))),r.createElement(s.CollapsibleContent,{forceMountWithAnimation:!0},r.createElement("div",{className:"bw-border-t bw-border-solid bw-border-gray-100 bw-p-5"},r.createElement("div",null,r.createElement(f,{className:"bw-mb-3 bw-uppercase"},r.createElement(v,null)," ",e.__("Styler","bookster")),r.createElement(n.Form.Item,{label:r.createElement("span",{className:"bw-capitalize"},t," ",e.__("Title","bookster")),className:"!bw-mb-3",name:["customize","content","steps",t,"title"],rules:[{required:!0,message:e.__("Please enter Title!","bookster")}]},r.createElement(s.Input,{placeholder:"The Step Title",maxLength:18,onChange:e=>g(e.target.value)})),r.createElement(n.Form.Item,{label:r.createElement("span",{className:"bw-capitalize"},t," ",e.__("Description","bookster")),name:["customize","content","steps",t,"description"]},r.createElement(s.Textarea,{rows:2,maxLength:50,onChange:e=>_(e.target.value)}))),l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.StepBooking_+t,[]))))}function M({stepName:e,stepOpen:t,stepOrder:a,setStepOpen:s}){const n=l.booksterHooks.hasAction(l.ADDON_PROCESS_HOOKS_NAME.customize.onChangeStepOrder),{setNodeRef:i,attributes:m,listeners:b,transition:u,transform:p,isDragging:d}=o.useSortable({id:e}),w={transition:u,transform:o.dndCSS.Transform.toString(p)};return d?r.createElement("div",{ref:i,style:w,className:"bw-h-[42px] bw-rounded bw-bg-gray-100"}):r.createElement("div",{ref:i,style:w},r.createElement(B,{stepName:e,stepOrder:a,stepIsOpen:t===e,stepOnOpenChange:s,triggerAction:n&&r.createElement(c.GripVertical,{className:"bw-text-[#808890] bw-duration-300 group-hover:bw-text-gray-900",...m,...b})}))}function T(){const e=l.booksterHooks.hasAction(l.ADDON_PROCESS_HOOKS_NAME.customize.onChangeStepOrder),[t,a]=m.useState(void 0),s=u.useBookingConfig(),[n,i]=m.useState((()=>{const e=(null==(a=null==(t=window.booksterManagerData)?void 0:t.addonProcess)?void 0:a.stepsOrder)??["service","agent"];var t,a;const o=s.process.steps.map((e=>e.name));return(null==e?void 0:e.filter((e=>o.includes(e))))??[]})),[c,b]=m.useState(void 0),p=o.useSensors(o.useSensor(o.PointerSensor,{activationConstraint:{distance:5}}));return r.createElement("div",{className:"bw-flex bw-flex-col bw-gap-2.5 bw-pb-5"},r.createElement(o.DndContext,{sensors:p,onDragStart:({active:e})=>e&&b(e.id),onDragEnd:function({active:e,over:t}){if(!t||e.id===t.id)return;const a=n.indexOf(e.id),o=n.indexOf(t.id),s=function(e,t,a){const o=[...e],[s]=o.splice(t,1);return o.splice(a,0,s),o}(n,a,o);l.booksterHooks.doAction(l.ADDON_PROCESS_HOOKS_NAME.customize.onChangeStepOrder,s),i(s),b(void 0)}},r.createElement(o.SortableContext,{items:n,disabled:!e,strategy:o.verticalListSortingStrategy},n.map(((e,o)=>r.createElement(M,{stepOpen:t,setStepOpen:a,key:e,stepName:e,stepOrder:o+1})))),_.createPortal(r.createElement(o.DragOverlay,{className:"bookster-root"},c&&r.createElement(M,{stepOpen:t,setStepOpen:a,stepName:c,stepOrder:n.indexOf(c)+1})),document.body)),r.createElement(B,{stepIsOpen:"datetime"===t,stepOnOpenChange:a,key:"datetime",stepOrder:n.length+1,stepName:"datetime"}),r.createElement(B,{stepIsOpen:"contact"===t,stepOnOpenChange:a,key:"contact",stepOrder:n.length+2,stepName:"contact"}),r.createElement(B,{stepIsOpen:"checkout"===t,stepOnOpenChange:a,key:"checkout",stepOrder:n.length+3,stepName:"checkout"}),r.createElement(B,{stepIsOpen:"confirmation"===t,stepOnOpenChange:a,key:"confirmation",stepOrder:n.length+4,stepName:"confirmation"}),r.createElement(A,{stepIsOpen:"help"===t,stepOnOpenChange:a}),l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.EndStepBooking,[]))}function D(){const t=o.useNavigate(),{tabId:a="step-booking"}=o.useParams();return r.createElement("div",{className:"btr-scrollbar-hidden bw-relative bw-flex-auto bw-overflow-auto bw-px-5 bw-pb-5 bw-pt-2"},r.createElement(s.Tabs,{className:"bw-h-full",value:a},r.createElement(s.TabsList,{"aria-label":"tabs setting"},r.createElement(s.LineTabsTrigger,{value:"step-booking",onClick:()=>t("/customize/step-booking")},e.__("Step booking","bookster")),l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.TabsTrigger,[],t)),r.createElement(s.TabsContent,{value:"step-booking"},r.createElement(T,null)),l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.TabsContent,[])))}function F({layoutToggle:t}){return r.createElement("h2",{className:"bw-flex bw-items-center bw-justify-between bw-gap-4 bw-border-0 bw-border-b bw-border-solid bw-px-5 bw-py-3 bw-text-sm bw-font-medium bw-uppercase"},e.__("Customize","bookster"),t)}function j({layoutToggle:t,className:a,...o}){const n=g((e=>e.settings.isLoading)),i=u.useBookingStore(),l=u.useBookingConfig(),{process:m}=u.useBookingLogic(),{jumpToStep:b}=H();return r.createElement("div",{className:s.cx("bw-flex bw-flex-col",a),...o},r.createElement(F,{layoutToggle:t}),r.createElement(D,null),r.createElement("div",{className:"bw-flex bw-justify-between bw-border-0 bw-border-t bw-border-solid bw-px-5 bw-py-3"},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-0.5 bw-rounded-md bw-border bw-border-solid bw-border-gray-100 bw-p-[1px]"},r.createElement(s.Tooltip,{content:e.__("Previous step","bookster")},r.createElement(s.Button,{variant:"ghost",size:"icon",color:"base",className:"bw-text-gray-500 hover:bw-bg-gray-20 hover:bw-text-gray-900",onClick:()=>function(){if(!m.can.prevAct&&"browse"===m.computed.phase)return;const e=i.getState().process.current.stepIndex,t=l.process.steps;e>0&&b(t[e-1].name)}()},r.createElement(c.ChevronLeft,{strokeWidth:"2.5",className:"bw-h-2 bw-w-2"}))),r.createElement(s.Separator,{orientation:"vertical"}),r.createElement(s.Tooltip,{content:e.__("Next step","bookster")},r.createElement(s.Button,{variant:"ghost",size:"icon",className:"bw-text-gray-500 hover:bw-bg-gray-20 hover:bw-text-gray-900",color:"base",onClick:()=>function(){const e=i.getState().process.current.stepIndex,t=l.process.steps;e<t.length-1&&b(t[e+1].name)}()},r.createElement(c.ChevronRight,{strokeWidth:"2.5",className:"bw-h-2 bw-w-2"})))),r.createElement(s.LoadingButton,{disabled:n,loading:n,className:"bw-px-6",type:"submit"},e.__("Save","bookster"))))}function I({className:e,...t}){const a=n.Form.useFormInstance(),o=n.Form.useWatch([],a),i=u.useBookingState((e=>e.customize)),c=l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.initialValues,{customize:i}),p=o||c,d=m.useMemo((()=>l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.previewCssVariables,{},p)),[p]),w=s.useDebounce(d,{wait:150,maxWait:500}),g=m.useMemo((()=>l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.previewAntdConfig,b,p)),[p]),_=s.useDebounce(g,{wait:150,maxWait:500});return r.createElement(P,{antdConfig:_,className:e,style:w,...t})}const P=r.memo((function({antdConfig:e,...t}){return r.createElement(n.ConfigProvider,{...e},r.createElement("div",{...t},r.createElement(h,null)))}));function K(){const[e,t]=m.useState("desktop"),a=g((e=>e.settings.isLoading)),i=u.useBookingState((e=>e.customize)),b=g((e=>e.settingsUpdateCustomize)),[p]=n.Form.useForm(),{toast:d}=s.useToast(),w=l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.initialValues,{customize:i});return r.createElement(n.Form,{form:p,layout:"vertical",disabled:a,initialValues:w,onFinish:async function(e){try{await b(e),d.success("Update customize setting success!")}catch(t){d.error(await o.getErrorMsg(t))}},className:"bw-h-full"},r.createElement("div",{className:"bw-mx-auto bw-flex bw-h-full bw-w-full bw-max-w-[1558px] bw-gap-5 bw-border-0 bw-bg-gray-50 bw-p-6"},r.createElement(s.ReactScrollArea.Root,{type:"always",className:"bw-relative bw-h-full bw-w-full bw-flex-grow bw-overflow-hidden max-lg:bw-hidden"},r.createElement(s.ReactScrollArea.Viewport,{className:"bw-h-full bw-w-full bw-rounded-[inherit]"},r.createElement("div",{className:"bw-relative bw-h-full bw-w-full"},r.createElement("div",{className:"bw-absolute bw-inset-0 bw-z-10"})," ",r.createElement("div",{className:"bw-absolute bw-inset-0 bw-z-0"},r.createElement(I,{className:s.cx("bookster-root bw-h-[42rem]","mobile"===e&&"bw-m-auto bw-w-[34rem]","desktop"===e&&"bw-m-auto bw-w-[65rem]")})))),r.createElement(s.Scrollbar,{orientation:"vertical",className:"bw-z-20"}),r.createElement(s.Scrollbar,{orientation:"horizontal",className:"bw-z-20"}),r.createElement(s.ReactScrollArea.Corner,null)),r.createElement(j,{className:"bw-z-10 bw-h-full bw-w-[450px] bw-flex-none bw-rounded-theme bw-border-solid bw-bg-white max-lg:bw-flex-grow",layoutToggle:r.createElement(s.SegmentGroup,{value:e,size:"large",onValueChange:e=>t(e)},r.createElement(s.SegmentGroupItem,{value:"desktop"},r.createElement(c.Monitor,null)),r.createElement(s.SegmentGroupItem,{value:"mobile"},r.createElement(c.Mobile,null)))})))}function R(){const[e,t]=m.useState((()=>l.booksterHooks.applyFilters(l.HOOK_NAMES.customize.initialPreviewConfig,{context:{formId:o.genUniqueId(),parent:{is:"body",parentWidth:1040}},process:p()})));return r.createElement(u.PreviewConfigContext.Provider,{value:{setConfig:t}},r.createElement(w,{config:e},r.createElement(K,null)))}export{R as default};
