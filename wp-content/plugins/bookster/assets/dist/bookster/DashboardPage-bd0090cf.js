import{c as e,R as t,_ as a,b as r,a as n,r as l,L as s}from"./prefetch.helper-04349684.js";import{a as o}from"./UIComponents-7ff4460b.js";import{A as c}from"./AppointmentFormDrawer-884f27d3.js";import{u as i,a as m,b as u,C as d,m as b,r as w,c as p,d as E}from"./CalendarContent-e50ff6c3.js";import{m as v}from"./main-6566bc29.js";import{i as f,j as y}from"./appointment.helper-07645f99.js";import{u as g,a as h}from"./useAgentResources-6fea2cc0.js";import{u as C,f as N}from"./store-bdc614dc.js";import{S as k,P as x}from"./queue.helper-cc60359e.js";import{u as _,g as R}from"./BEConfigProvider-705eafe2.js";import{N as T,a as j,b as F}from"./CalendarNav.styled-cb1aebbc.js";import{G as D}from"./ReloadButton-117ef334.js";import{c as P,a as S,g as M,b as Q,i as B,d as A,P as L,C as q,e as I,f as z,h as H,S as W,j as Y,k as K,l as V,m as G,n as O}from"./StatsRate-10303d5b.js";import"./react-dom-3e43fe1d.js";import"./createBookTimeInput.helper-ed47ae63.js";function U({isFetching:l,isSaving:s}){const{getCalendarApi:o}=i(),{title:c}=C((e=>e.dashboard.dayPreview)),m=C((e=>e.dashboardDayPreviewToday)),u=C((e=>e.dashboardDayPreviewPrev)),d=C((e=>e.dashboardDayPreviewNext)),b=e.useQueryClient();return t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,r.__("Day Schedule","bookster")),t.createElement(D,{onClick:()=>b.invalidateQueries({queryKey:["appointments","events"]}),isFetching:l})),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(T,{onClick:()=>m(o())},"Today"),t.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(j,{onClick:()=>u(o())},t.createElement(n.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(j,{onClick:()=>d(o())},t.createElement(n.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(F,null,c,t.createElement(k,{isSaving:s}))))}const J=new x;function X(){const[r,n]=l.useState(null),{activeStart:s,activeEnd:o}=C((e=>e.dashboard.dayPreview)),c=C((e=>e.dashboardDayPreviewRefresh)),E=C((e=>e.initAppointmentForm)),{toast:k}=a.useToast(),{resources:x,slotMinAbs:R,slotMaxAbs:T}=g(),{invalidateLazy:j,invalidateNow:F,updateModel:D}=m(),P=u(s,o),{data:S,isFetching:M,isRefetching:Q}=h(P),{getCalendarApi:B,calendarRef:A}=i();l.useEffect((()=>{if(void 0!==S&&A.current){const e=B();e.batchRendering((()=>{e.removeAllEvents(),S.forEach((t=>e.addEvent(t)))}))}}),[S,A.current]),l.useEffect((()=>{if(void 0!==x&&A.current){const e=B();e.batchRendering((()=>{x.forEach((t=>e.addResource(t)))}))}}),[x,A.current]),l.useEffect((()=>{c(B())}),[]);const L=e.useQueryClient(),q=_();return t.createElement(a.Card,{className:"bw-mb-6"},t.createElement(U,{isSaving:r,isFetching:M||Q}),t.createElement(a.CardContent,{className:"bw-px-2.5"},t.createElement(d,{key:"day-preview-calendar",plugins:[v,b],initialView:"resourceTimelineDay",slotMinTime:60*R*1e3,slotMaxTime:60*T*1e3,eventContent:w,dateClick:function(t){if("fc-non-business"===t.jsEvent.target.className)return;const a=f(t.date);var r;r={book_date:a,start_time:e.bookHelper.booktime.createFromDayjs(a),agent_ids:t.resource?[parseInt(t.resource.id)]:[]},E(r),q("new")},eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,L.setQueryData(["appointment",t.appointment_id],t),q(`${t.appointment_id}`)},eventDrop:async function(t){const a=t.event;if(!a.start||!a.end)return;const r=y(a.extendedProps.model,a.start,a.end),l=t.newResource;l&&(r.agent_ids=[parseInt(l.id)]),J.add((async()=>{n(!0);try{const e=await N(parseInt(t.event.id),r);t.event.setExtendedProp("model",e),D(e),j()}catch(a){throw n(null),k.error(await e.getErrorMsg(a)),F(),t.revert(),a}}),(()=>{n(!1)}))},editable:!0,resourceAreaHeaderContent:t.createElement(t.Fragment,null),resourceAreaWidth:58,resourceLabelContent:p})))}function $(){return t.createElement(E,null,t.createElement(X,null))}const Z=R().dashboardIntervalRange,ee=P();function te(){return{preloadReportQuery:e.useQuery({queryKey:["analytics","overview",Z],queryFn:async()=>await async function(t){return await e.api.patch("analytics/overview",{json:t}).json()}({performance:S(Z),agentLeaderboard:{filter:ee},serviceLeaderboard:{filter:ee}}),refetchOnMount:!1,refetchOnWindowFocus:!1}),defaultIntervalRange:Z}}const ae=l.forwardRef((({className:e,...t},r)=>l.createElement("table",{ref:r,className:a.cx("bw-w-full bw-border-collapse bw-bg-white",e),...t})));ae.displayName="Table";const re=l.forwardRef((({...e},t)=>l.createElement("thead",{ref:t,...e})));re.displayName="TableHeader";const ne=l.forwardRef((({className:e,...t},r)=>l.createElement("tr",{ref:r,className:a.cx("bw-text-gray-500",e),...t})));ne.displayName="TableRow";const le=l.forwardRef((({className:e,...t},r)=>l.createElement("th",{ref:r,className:a.cx("bw-h-14 bw-border-b bw-border-solid bw-px-4 bw-text-left bw-align-middle bw-font-normal",e),...t})));le.displayName="TableHead";const se=l.forwardRef((({className:e,...t},r)=>l.createElement("tbody",{ref:r,className:a.cx("[&_tr:last-child]:bw-border-0",e),...t})));se.displayName="TableBody";const oe=l.forwardRef((({className:e,...t},r)=>l.createElement("tr",{ref:r,className:a.cx("bw-transition-colors",e),...t})));oe.displayName="TableRow";const ce=l.forwardRef((({className:e,...t},r)=>l.createElement("td",{ref:r,className:a.cx("bw-align-left bw-p-4",e),...t})));function ie({index:e}){let t="rgb(var(--btr-p))";return 1===e?t="#547CFF":2===e?t="#7497FF":3===e?t="#94B3FF":4===e&&(t="#B5CFFF"),l.createElement(ce,{className:"bw-text-center"},l.createElement("div",{className:"bw-flex bw-h-7 bw-w-7 bw-items-center bw-justify-center bw-rounded-full bw-border-2 bw-border-gray-70 bw-bg-primary bw-text-sm bw-text-white",style:{backgroundColor:t}},e+1))}function me({current:e,previous:t}){let a=0;return a=0===t?1e3:0===e?0:(e-t)/t*100,l.createElement(ce,{className:"bw-text-center"},a>=0?"+":"",a.toLocaleString("en-US",{maximumFractionDigits:2}),"%")}function ue(){var s;const[o,c]=l.useState(!1),[i,m]=l.useState(M(30)),u=l.useMemo((()=>Q(i)),[i]),d=l.useMemo((()=>B(i,30)),[i]),b=e.useQueryClient(),{preloadReportQuery:w}=te(),{data:p,isFetching:E}=e.useQuery({queryKey:["analytics","leaderboards","agents",u],queryFn:async()=>await async function(t){return await e.api.patch("analytics/leaderboards/agents",{json:t}).json()}(A(i)),enabled:!d||o,keepPreviousData:!0,placeholderData:null==(s=w.data)?void 0:s.agentLeaderboard,staleTime:6e5});function v(e){m(e),c(!0)}return t.createElement(a.Card,{className:"bw-min-h-[481px]"},t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,"Top Agents"),t.createElement(D,{onClick:()=>(b.invalidateQueries({queryKey:["analytics","leaderboards","agents"]}),void c(!0)),isFetching:E})),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(a.DateRangePicker,{className:"bw-w-64 [&_.bant-picker-input>input]:bw-text-gray-500",size:"medium",format:"MMM D, YYYY",value:i,onChange:e=>{v(e)}}),t.createElement("div",{className:"bw-ms-auto bw-inline-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(a.Button,{variant:"trivial",size:"icon",onClick:()=>function(){const e=i[1].diff(i[0],"days");v([i[0].subtract(e+1,"days"),i[1].subtract(e+1,"days")])}()},t.createElement(n.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(a.Button,{variant:"trivial",size:"icon",onClick:()=>function(){const e=i[1].diff(i[0],"days");v([i[0].add(e+1,"days"),i[1].add(e+1,"days")])}()},t.createElement(n.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(a.Button,{variant:"trivial",disabled:d,onClick:()=>{v(M(30))}},"Today"))),t.createElement(a.CardContent,{className:"bw-pt-2"},t.createElement(ae,null,t.createElement(re,null,t.createElement(ne,null,t.createElement(le,null,r.__("NO","bookster")),t.createElement(le,null,r.__("Agent name","bookster")),t.createElement(le,{className:"bw-text-center"},r.__("Customers","bookster")),t.createElement(le,{className:"bw-text-center"},r.__("% of Sales","bookster")),t.createElement(le,{className:"bw-text-right"},r.__("Total revenue","bookster")))),t.createElement(se,null,void 0!==p&&p.rows.slice(0,5).map(((a,r)=>t.createElement(oe,{key:a.id},t.createElement(ie,{index:r}),t.createElement(ce,null,a.name),t.createElement(ce,{className:"bw-text-center"},a.currentCustomerCount),t.createElement(me,{current:a.currentBookingCount,previous:a.previous.bookingCount}),t.createElement(ce,{className:"bw-text-right"},e.formatPrice(a.currentRevenue)))))))))}function de(){var s;const[o,c]=l.useState(!1),[i,m]=l.useState(M(30)),u=l.useMemo((()=>Q(i)),[i]),d=l.useMemo((()=>B(i,30)),[i]),b=e.useQueryClient(),{preloadReportQuery:w}=te(),{data:p,isFetching:E}=e.useQuery({queryKey:["analytics","leaderboards","services",u],queryFn:async()=>await async function(t){return await e.api.patch("analytics/leaderboards/services",{json:t}).json()}(A(i)),enabled:!d||o,keepPreviousData:!0,placeholderData:null==(s=w.data)?void 0:s.serviceLeaderboard,staleTime:6e5});function v(e){const t=i[1].diff(i[0],"days");m(t<0?[e[1],e[0]]:e),c(!0)}return t.createElement(a.Card,{className:"bw-min-h-[481px]"},t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,"Top Services"),t.createElement(D,{onClick:()=>(E||b.invalidateQueries({queryKey:["analytics","leaderboards","services"]}),void c(!0)),isFetching:E})),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(a.DateRangePicker,{className:"bw-w-64 [&_.bant-picker-input>input]:bw-text-gray-500",size:"medium",format:"MMM D, YYYY",value:i,onChange:e=>{v(e)}}),t.createElement("div",{className:"bw-ms-auto bw-inline-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},t.createElement(a.Button,{variant:"trivial",size:"icon",onClick:()=>function(){const e=i[1].diff(i[0],"days");v([i[0].subtract(e+1,"days"),i[1].subtract(e+1,"days")])}()},t.createElement(n.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement(a.Button,{variant:"trivial",size:"icon",onClick:()=>function(){const e=i[1].diff(i[0],"days");v([i[0].add(e+1,"days"),i[1].add(e+1,"days")])}()},t.createElement(n.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),t.createElement(a.Button,{variant:"trivial",disabled:d,onClick:()=>{v(M(30))}},"Today"))),t.createElement(a.CardContent,{className:"bw-pt-2"},t.createElement(ae,null,t.createElement(re,null,t.createElement(ne,null,t.createElement(le,null,r.__("NO","bookster")),t.createElement(le,null,r.__("Service name","bookster")),t.createElement(le,{className:"bw-text-center"},r.__("Customers","bookster")),t.createElement(le,{className:"bw-text-center"},r.__("% of Sales","bookster")),t.createElement(le,{className:"bw-text-right"},r.__("Total revenue","bookster")))),t.createElement(se,null,void 0!==p&&p.rows.slice(0,5).map(((a,r)=>t.createElement(oe,{key:a.id},t.createElement(ie,{index:r}),t.createElement(ce,null,a.name),t.createElement(ce,{className:"bw-text-center"},a.currentCustomerCount),t.createElement(me,{current:a.currentBookingCount,previous:a.previous.bookingCount}),t.createElement(ce,{className:"bw-text-right"},e.formatPrice(a.currentRevenue)))))))))}function be(){return t.createElement("div",{className:"bw-grid bw-gap-6 xl:bw-grid-cols-2"},t.createElement(de,null),t.createElement(ue,null))}function we(o){var c;const i=e.useQueryClient(),m=e.useNavigate(),u=C((e=>e.dashboard.intervalRange)),d=C((e=>e.dashboardSetIntervalRange)),[b,w]=l.useState(!1),{preloadReportQuery:p,defaultIntervalRange:E}=te(),{data:v,isFetching:f}=e.useQuery({queryKey:["analytics","performance",u],queryFn:async()=>await async function(t){return await e.api.patch("analytics/performance",{json:t}).json()}(S(u)),enabled:E!==u||b,keepPreviousData:!0,placeholderData:E===u?null==(c=p.data)?void 0:c.performance:void 0,staleTime:6e5});return t.createElement(L,{...o},t.createElement(q,null,t.createElement(a.CardHeader,null,t.createElement("div",{className:"bw-flex bw-flex-row bw-items-center bw-justify-between"},t.createElement(a.CardTitle,null,r.__("Performance","bookster")),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4"},t.createElement(a.SegmentGroup,{size:"medium",value:u,onValueChange:e=>(d(e),void w(!0))},t.createElement(a.SegmentGroupItem,{value:"day"},r.__("Day","bookster")),t.createElement(a.SegmentGroupItem,{value:"week"},r.__("Week","bookster")),t.createElement(a.SegmentGroupItem,{value:"month"},r.__("Month","bookster"))),t.createElement(D,{onClick:()=>(i.invalidateQueries({queryKey:["analytics","performance",u]}),void w(!0)),isFetching:f}))),t.createElement(I,null)),t.createElement(a.CardContent,{className:"bw-flex-grow bw-px-0"},!v&&t.createElement(z,null),v&&t.createElement(H,{intervals:v.intervals}))),t.createElement(W,null,t.createElement("div",null,t.createElement(Y,null,r.__("Revenue","bookster"),t.createElement(a.Tooltip,{content:"Total Revenue in the Last 30 Days"},t.createElement(n.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!v&&t.createElement(K,null),v&&t.createElement(V,null,t.createElement(G,null,e.formatPrice(v.totals.current.revenue)),t.createElement(O,{current:v.totals.current.revenue,previous:v.totals.previous.revenue})),t.createElement(a.Button,{onClick:()=>m("/appointments"),className:"bw-rounded-sm bw-border-gray-300 bw-text-gray-900",size:"small",variant:"trivial"},r.__("View Appointment","bookster"))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/revenue-page.svg"})),t.createElement(W,null,t.createElement("div",null,t.createElement(Y,null,r.__("Appointments","bookster"),t.createElement(a.Tooltip,{content:"Total Appointments in the Last 30 Days"},t.createElement(n.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!v&&t.createElement(K,null),v&&t.createElement(V,null,t.createElement(G,null,v.totals.current.apptCount),t.createElement(O,{current:v.totals.current.apptCount,previous:v.totals.previous.apptCount})),t.createElement(a.Button,{onClick:()=>m("/calendar"),className:"bw-rounded-sm bw-border-gray-300 bw-text-gray-900",size:"small",variant:"trivial"},r.__("View Calendar","bookster"))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/appt-page.svg"})),t.createElement(W,null,t.createElement("div",null,t.createElement(Y,null,r.__("New Customers","bookster"),t.createElement(a.Tooltip,{content:r.sprintf(r.__("Total New %(customers)s in the Last 30 Days","bookster"),s)},t.createElement(n.HelpCircle,{className:"bw-h-3 bw-w-3 bw-text-gray-500"}))),!v&&t.createElement(K,null),v&&t.createElement(V,null,t.createElement(G,null,v.totals.current.newCustomerCount),t.createElement(O,{current:v.totals.current.newCustomerCount,previous:v.totals.previous.newCustomerCount})),t.createElement(a.Button,{onClick:()=>m("/customers"),className:"bw-rounded-sm bw-border-gray-300 bw-text-gray-900",size:"small",variant:"trivial"},r.__("View Customers","bookster"))),t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/figures/customer-page.svg"})))}function pe(){return t.createElement(o,null,t.createElement(we,null),t.createElement($,null),t.createElement(be,null),t.createElement(c,{parentPath:"/dashboard"},t.createElement(e.Outlet,null)))}ce.displayName="TableCell",a.stylex.div("bw-rounded-md bw-border bw-border-gray-100 bw-shadow-md");export{pe as default};
