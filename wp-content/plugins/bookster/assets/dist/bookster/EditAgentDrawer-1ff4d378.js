import{r as e,c as t,R as a,_ as n,a as r,b as s,L as l,d as o,f as i,x as c,B as m}from"./prefetch.helper-04349684.js";import{u,d,v as b}from"./CoverPicker-52693ec5.js";import{u as g}from"./BEConfigProvider-705eafe2.js";import{a as E,p as f}from"./agent.helper-a271074e.js";import{u as p,b as y,A as _,a as v}from"./AgentGeneralTab-a55c53ee.js";import{A as h,a as C}from"./AgentScheduleTab-5fda5591.js";import{i as k}from"./store-bdc614dc.js";import"./phoneInput.helper-806287af.js";import"./WeeklyScheduleEditor-9e383627.js";import"./lodash-f550b173.js";import"./CalendarNav.styled-cb1aebbc.js";function w({agent_id:o,onDelete:i,disabled:c}){const[m,u]=e.useState(!1),{data:d}=t.useQuery({queryKey:["appointments","by-agent",o],queryFn:()=>{if(o)return k({in_args:{agent_id:{values:[o],placeholder:"%d",alias:"assignment"}}})},enabled:m});return a.createElement(a.Fragment,null,a.createElement(n.Popover,{open:m,onOpenChange:u},a.createElement(n.PopoverTrigger,{asChild:!0},a.createElement(n.Button,{key:"more",variant:"trivial",size:"icon",className:"bw-me-auto bw-h-9 bw-w-9",tabIndex:-1,disabled:c},a.createElement(r.Trash,null))),a.createElement(n.ConfirmPopoverContent,{className:"bw-z-[100]"},a.createElement(r.AlertFilled,{className:"bw-text-error"}),a.createElement(n.ConfirmPopoverTitle,null,s.__("Delete Agent","bookster")),a.createElement(n.ConfirmPopoverDescription,null,s.sprintf(s.__("This action cannot be undone. This will permanently delete this %s and %s appointments.","bookster"),l.agent,d??"...")),a.createElement(n.ConfirmPopoverActions,null,a.createElement(n.PopoverClose,{asChild:!0},a.createElement(n.Button,{variant:"soft"},s.__("Cancel","bookster"))),a.createElement(n.Button,{variant:"fill",onClick:i},s.__("Confirm Delete","bookster"))))))}function T(){const{toast:r}=n.useToast(),k=p(),{data:T,isLoading:F}=y(k),A=g();function D(){A("..")}const[S]=o.Form.useForm(),j=t.useQueryClient(),N=t.useMutation({mutationKey:["agents",k,"edit"],mutationFn:({id:e,values:t})=>u(e,t),onSuccess:e=>{j.setQueryData(["agent",k],e),j.invalidateQueries({queryKey:["agents"]})}}),L=t.useMutation({mutationKey:["agents",k,"delete"],mutationFn:d,onSuccess:()=>{j.invalidateQueries({queryKey:["agent",k]}),j.invalidateQueries({queryKey:["agents"]})}}),K=t.useActiveServices(),O=e.useMemo((()=>{if(T){const e=E(T,K);return i.booksterHooks.applyFilters(i.HOOK_NAMES.managerAgentForm.initFormValues,e,T)}}),[T,K]);n.useUpdateEffect((()=>{O&&(S.resetFields(),S.setFieldsValue(O))}),[O]);const P=F||!T&&!F||N.isLoading||L.isLoading;return a.createElement(a.Fragment,null,a.createElement(n.DrawerHeader,null,a.createElement(n.DrawerTitle,null,s.sprintf(s.__("Edit %(agent)s","bookster"),l)),a.createElement(n.DrawerCloseIcon,null)),a.createElement(n.DrawerBody,null,a.createElement(n.LoadingOverlay,{loading:P}),a.createElement(o.Form,{form:S,initialValues:O,disabled:P,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{e.weekly_schedule=e.weekly_schedule?c(e.weekly_schedule):e.weekly_schedule,e.dayoff_schedule=e.dayoff_schedule?m(e.dayoff_schedule):e.dayoff_schedule,async function(e){if(k&&T)try{const t=f(e);e.email&&e.email!==T.email&&await b(e.email),await N.mutateAsync({id:T.agent_id,values:t}),r.success("Agent has been Saved Successfully!"),D()}catch(a){r.error(await t.getErrorMsg(a))}}(e)}},a.createElement(n.Tabs,{defaultValue:"general"},a.createElement(n.TabsList,{"aria-label":"tabs settings",className:"-bw-mt-1"},a.createElement(n.CompactLineTabsTrigger,{value:"general"},s.__("General","bookster")),a.createElement(n.CompactLineTabsTrigger,{value:"available"},s.__("Available","bookster")),a.createElement(n.CompactLineTabsTrigger,{value:"schedule"},s.__("Schedule","bookster")),a.createElement(n.CompactLineTabsTrigger,{value:"daysoff"},s.__("Days Off","bookster")),i.booksterHooks.applyFilters(i.HOOK_NAMES.managerAgentForm.TabsTrigger,[])),a.createElement(n.TabsContent,{value:"general"},a.createElement(_,null)),a.createElement(n.TabsContent,{value:"available"},a.createElement(v,null)),a.createElement(n.TabsContent,{value:"schedule"},a.createElement(h,null)),a.createElement(n.TabsContent,{value:"daysoff"},a.createElement(C,null)),i.booksterHooks.applyFilters(i.HOOK_NAMES.managerAgentForm.TabsContent,[])),a.createElement("button",{type:"submit",className:"bw-hidden"}))),a.createElement(n.DrawerFooter,null,T?a.createElement(w,{disabled:P,agent_id:T.agent_id,onDelete:async function(){if(k&&T)try{await L.mutateAsync(T.agent_id),r.success("Agent has been Deleted Successfully!"),D()}catch(e){r.error(await t.getErrorMsg(e))}}}):null,a.createElement(n.DrawerClose,{asChild:!0},a.createElement(n.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},s.__("Cancel","bookster"))),a.createElement(n.Button,{key:"submit",disabled:P,size:"large",className:"bw-min-w-[7rem]",onClick:()=>S.submit()},s.__("Save","bookster"))))}export{T as default};
