import{r as e,c as t,R as r,_ as a,a as s,b as o,L as n,d as i}from"./prefetch.helper-04349684.js";import{d as l,t as m,v as c}from"./useCacheCustomers-102bfcf8.js";import{u}from"./BEConfigProvider-705eafe2.js";import{u as d,a as p,C as E}from"./page-manager.js";import{i as b}from"./store-bdc614dc.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./appointment.helper-07645f99.js";import"./BackendRouteErrorElement-6f34d3c9.js";import"./CoverPicker-52693ec5.js";import"./phoneInput.helper-806287af.js";function f({customer_id:i,onDelete:l,disabled:m}){const[c,u]=e.useState(!1),{data:d}=t.useQuery({queryKey:["appointments","by-customer",i],queryFn:()=>{if(i)return b({in_args:{customer_id:{values:[i],placeholder:"%d",alias:"booking"}}})},enabled:c});return r.createElement(a.Popover,{open:c,onOpenChange:u},r.createElement(a.PopoverTrigger,{asChild:!0},r.createElement(a.Button,{key:"more",variant:"trivial",size:"icon",className:"bw-me-auto bw-h-9 bw-w-9",tabIndex:-1,disabled:m},r.createElement(s.Trash,null))),r.createElement(a.ConfirmPopoverContent,{className:"bw-z-[100]"},r.createElement(s.AlertFilled,{className:"bw-text-error"}),r.createElement(a.ConfirmPopoverTitle,null,o.__("Delete Customer","bookster")),r.createElement(a.ConfirmPopoverDescription,null,o.sprintf(o.__("This action cannot be undone. This will permanently delete this %s and %s appointments.","bookster"),n.customer,d??"...")),r.createElement(a.ConfirmPopoverActions,null,r.createElement(a.PopoverClose,{asChild:!0},r.createElement(a.Button,{variant:"soft"},o.__("Cancel","bookster"))),r.createElement(a.Button,{variant:"fill",onClick:l},o.__("Confirm Delete","bookster")))))}function y(){const{toast:s}=a.useToast(),b=d(),{data:y,isLoading:v}=p(b),C=u();function _(){C("..")}const[h]=i.Form.useForm(),w=t.useQueryClient(),g=t.useMutation({mutationKey:["customers",b,"edit"],mutationFn:({id:e,values:t})=>l(e,t),onSuccess:e=>{w.setQueryData(["customer",b],e),w.invalidateQueries({queryKey:["customers"]})}}),k=t.useMutation({mutationKey:["customers",b,"delete"],mutationFn:m,onSuccess:()=>{w.removeQueries({queryKey:["customer",b]}),w.invalidateQueries({queryKey:["customers"]})}});e.useEffect((()=>{y&&(h.resetFields(),h.setFieldsValue(y))}),[y]);const D=v||!y&&!v||g.isLoading||k.isLoading;return r.createElement(r.Fragment,null,r.createElement(a.DrawerHeader,null,r.createElement(a.DrawerTitle,null,o.sprintf(o.__("Edit %(customer)s","bookster"),n)),r.createElement(a.DrawerCloseIcon,null)),r.createElement(a.DrawerBody,null,r.createElement(a.LoadingOverlay,{loading:D}),r.createElement(i.Form,{form:h,initialValues:y??void 0,disabled:D,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{!async function(e){if(b&&y)try{e.email&&e.email!==y.email&&await c(e.email),await g.mutateAsync({id:y.customer_id,values:e}),s.success("Customer has been Saved Successfully!"),_()}catch(r){s.error(await t.getErrorMsg(r))}}(e)}},r.createElement(E,null))),r.createElement(a.DrawerFooter,null,y?r.createElement(f,{disabled:D,customer_id:y.customer_id,onDelete:async function(){if(b&&y)try{await k.mutateAsync(y.customer_id),s.success(o.sprintf(o.__("%(customer)s has been Deleted Successfully!","bookster"),n)),_()}catch(e){s.error(await t.getErrorMsg(e))}}}):null,r.createElement(a.DrawerClose,{asChild:!0},r.createElement(a.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},o.__("Cancel","bookster"))),r.createElement(a.Button,{key:"submit",disabled:D,size:"large",className:"bw-min-w-[7rem]",onClick:()=>h.submit()},o.__("Save","bookster"))))}export{y as default};
