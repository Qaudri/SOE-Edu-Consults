import{r as e,c as t,R as r,_ as a,a as s,b as n,L as i,f as l,d as o}from"./prefetch.helper-04349684.js";import{i as c,u as m}from"./store-bdc614dc.js";import{h as u,i as d}from"./CoverPicker-52693ec5.js";import{u as v}from"./BEConfigProvider-705eafe2.js";import{u as b}from"./useServiceFormContext-43091331.js";import{u as E,b as f,c as p,S as y,a as _,p as g}from"./ServiceGeneralTab-007b1fbe.js";import"./color.helper-9b8c6bb8.js";function C({service_id:l,onDelete:o,disabled:m}){const[u,d]=e.useState(!1),{data:v}=t.useQuery({queryKey:["appointments","by-service",l],queryFn:()=>{if(l)return c({in_args:{service_id:{values:[l],placeholder:"%d"}}})}});return r.createElement(a.Popover,{open:u,onOpenChange:d},r.createElement(a.PopoverTrigger,{asChild:!0},r.createElement(a.Button,{key:"more",variant:"trivial",size:"icon",className:"bw-me-auto bw-h-9 bw-w-9",tabIndex:-1,disabled:m},r.createElement(s.Trash,null))),r.createElement(a.ConfirmPopoverContent,{className:"bw-z-[100]"},r.createElement(s.AlertFilled,{className:"bw-text-error"}),r.createElement(a.ConfirmPopoverTitle,null,n.__("Delete Service","bookster")),r.createElement(a.ConfirmPopoverDescription,null,n.sprintf(n.__("This action cannot be undone. This will permanently delete this %s and %s appointments.","bookster"),i.service,v??"...")),r.createElement(a.ConfirmPopoverActions,null,r.createElement(a.PopoverClose,{asChild:!0},r.createElement(a.Button,{variant:"soft"},n.__("Cancel","bookster"))),r.createElement(a.Button,{variant:"fill",onClick:o},n.__("Confirm Delete","bookster")))))}function w(){const s=m((e=>e.resetServiceForm)),{toast:c}=a.useToast(),w=E(),{data:h,isLoading:k}=f(w),T=v();function F(){T(".."),s()}const{form:S}=b(),D=t.useQueryClient(),P=t.useMutation({mutationKey:["services",w,"edit"],mutationFn:({id:e,values:t})=>u(e,t),onSuccess:e=>{D.setQueryData(["service",w],e),D.invalidateQueries({queryKey:["services"]})}}),A=t.useMutation({mutationKey:["services",w,"delete"],mutationFn:d,onSuccess:()=>{D.removeQueries({queryKey:["service",w]}),D.invalidateQueries({queryKey:["services"]})}}),L=t.useActiveAgents(),N=e.useMemo((()=>{if(h){const e=p(h,L);return l.booksterHooks.applyFilters(l.HOOK_NAMES.adminServiceForm.initFormValues,e,h)}}),[h,L]);e.useEffect((()=>{N&&(S.resetFields(),S.setFieldsValue(N))}),[N]);const j=k||!h&&!k||P.isLoading||A.isLoading;return r.createElement(r.Fragment,null,r.createElement(a.DrawerHeader,null,r.createElement(a.DrawerTitle,null,n.sprintf(n.__("Edit %(service)s","bookster"),i)),r.createElement(a.DrawerCloseIcon,null)),r.createElement(a.DrawerBody,null,r.createElement(a.LoadingOverlay,{loading:j}),r.createElement(o.Form,{form:S,initialValues:N,disabled:j,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{!async function(e){if(w&&h)try{const t=g(e);await P.mutateAsync({id:h.service_id,values:t}),c.success(n.sprintf(n.__("%(service)s has been Saved Successfully!","bookster"),i)),F()}catch(r){c.error(await t.getErrorMsg(r))}}(e)}},r.createElement(a.Tabs,{defaultValue:"general"},r.createElement(a.TabsList,{"aria-label":"tabs settings",className:"-bw-mt-1"},r.createElement(a.CompactLineTabsTrigger,{value:"general"},n.__("General","bookster")),r.createElement(a.CompactLineTabsTrigger,{value:"available"},n.__("Available","bookster"))),r.createElement(a.TabsContent,{value:"general"},r.createElement(y,null)),r.createElement(a.TabsContent,{value:"available"},r.createElement(_,null))),r.createElement("button",{type:"submit",className:"bw-hidden"}))),r.createElement(a.DrawerFooter,null,h?r.createElement(C,{disabled:j,service_id:h.service_id,onDelete:async function(){if(w&&h)try{await A.mutateAsync(h.service_id),c.success(n.sprintf(n.__("%(service)s has been Deleted Successfully!","bookster"),i)),F()}catch(e){c.error(await t.getErrorMsg(e))}}}):null,r.createElement(a.DrawerClose,{asChild:!0},r.createElement(a.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},n.__("Cancel","bookster"))),r.createElement(a.Button,{key:"submit",disabled:j,size:"large",className:"bw-min-w-[7rem]",onClick:()=>S.submit()},n.__("Save","bookster"))))}export{w as default};
