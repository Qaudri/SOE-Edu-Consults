import{r as e,c as t,R as a,_ as n,a as o,b as l,v as r,g as s,f as i,h as c}from"./prefetch.helper-04349684.js";import{j as m,k as u,u as b,q as d}from"./store-bdc614dc.js";import{u as p}from"./BEConfigProvider-705eafe2.js";import{g as w}from"./apptDataTable-a0a4fccd.js";import{T as g}from"./ReloadButton-117ef334.js";function E({className:s,...i}){const[c,m]=e.useState(!1),[u,b]=t.useSearchParams(),d=u.get("payment"),p=d?d.split(","):[],w=e=>{if(p.includes(e)){const t=p.filter((t=>t!==e));t.length>0?b((e=>(e.set("payment",t.join(",")),e))):b((e=>(e.delete("payment"),e)))}else b((t=>(t.set("payment",[...p,e].join(",")),t)))};return a.createElement(n.Combobox,{open:c,onOpenChange:m},a.createElement(n.ComboboxTrigger,{size:"medium",withStatus:!1,className:n.clsx("bw-w-auto bw-gap-1 bw-rounded bw-border-dashed bw-border-gray-500/30 bw-bg-gray-50 bw-pe-2 bw-ps-2 bw-text-sm",s),...i},a.createElement(o.Wallet,{className:"h-2 w-2 bw-text-gray-500"}),a.createElement("span",{className:"bw-text-gray-500"},l.__("Payment","bookster")),p.length>0&&a.createElement(n.Separator,{orientation:"vertical",className:"bw-mx-1.5 bw-h-[14px] bw-bg-gray-500/15"}),"incomplete"===p[0]&&a.createElement(n.Badge,{variant:"outline",color:"warning"},r("incomplete"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),w("incomplete")}})),"complete"===p[0]&&a.createElement(n.Badge,{variant:"outline",color:"success"},r("complete"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),w("complete")}})),"refunded"===p[0]&&a.createElement(n.Badge,{variant:"outline",color:"dark"},r("refunded"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),w("refunded")}})),"unpaid"===p[0]&&a.createElement(n.Badge,{variant:"outline",color:"base"},r("unpaid"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),w("unpaid")}})),p.length>1&&a.createElement("span",{className:"bw-inline-flex bw-h-[26px] bw-w-[26px] bw-items-center bw-justify-center bw-rounded-[8px] bw-bg-gray-500 bw-text-xs bw-font-medium bw-text-white"},"+",p.length-1)),a.createElement(n.ComboboxPortalContent,{className:"bw-w-[10rem] bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(n.Command,{loop:!0},a.createElement(n.CommandList,null,a.createElement(n.CommandEmpty,null,l.__("No results found.","bookster")),a.createElement(n.CommandGroup,{className:"[&_[cmdk-item]]:bw-pl-5"},a.createElement(n.ComboboxItem,{value:"incomplete",isActive:p.includes("incomplete"),onSelect:()=>w("incomplete")},r("incomplete"),a.createElement(n.ComboboxItemIcon,null)),a.createElement(n.ComboboxItem,{value:"complete",isActive:p.includes("complete"),onSelect:()=>w("complete")},r("complete"),a.createElement(n.ComboboxItemIcon,null)),a.createElement(n.ComboboxItem,{value:"refunded",isActive:p.includes("refunded"),onSelect:()=>w("refunded")},r("refunded"),a.createElement(n.ComboboxItemIcon,null)))))))}function h({className:r,...s}){const[i,c]=e.useState(!1),[m,u]=t.useSearchParams(),b=m.get("status"),d=b?b.split(","):[],p=e=>{if(d.includes(e)){const t=d.filter((t=>t!==e));t.length>0?u((e=>(e.set("status",t.join(",")),e))):u((e=>(e.delete("status"),e)))}else u((t=>(t.set("status",[...d,e].join(",")),t)))};return a.createElement(n.Combobox,{open:i,onOpenChange:c},a.createElement(n.ComboboxTrigger,{size:"medium",withStatus:!1,className:n.clsx("bw-w-auto bw-gap-1 bw-rounded bw-border-dashed bw-border-gray-500/30 bw-bg-gray-50 bw-pe-2 bw-ps-2 bw-text-sm",r),...s},a.createElement(o.Circle,{className:"h-2 w-2 bw-text-gray-500"}),a.createElement("span",{className:"bw-text-gray-500"},l.__("Status","bookster")),d.length>0&&a.createElement(n.Separator,{orientation:"vertical",className:"bw-mx-1.5 bw-h-[14px] bw-bg-gray-500/15"}),"approved"===d[0]&&a.createElement(n.Badge,{variant:"outline",color:"success"},l.__("Approved","bookster"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),p("approved")}})),"pending"===d[0]&&a.createElement(n.Badge,{variant:"outline",color:"warning"},l.__("Pending","bookster"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),p("pending")}})),"canceled"===d[0]&&a.createElement(n.Badge,{variant:"outline",color:"error"},l.__("Canceled","bookster"),a.createElement(o.X,{className:"bw-ml-2 bw-h-2 bw-w-2 bw-text-gray-500/80 hover:bw-text-error",strokeWidth:"3",onClick:e=>{e.stopPropagation(),p("canceled")}})),d.length>1&&a.createElement("span",{className:"bw-inline-flex bw-h-[26px] bw-w-[26px] bw-items-center bw-justify-center bw-rounded-[8px] bw-bg-gray-500 bw-text-xs bw-font-medium bw-text-white"},"+",d.length-1)),a.createElement(n.ComboboxPortalContent,{className:"bw-w-[10rem] bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(n.Command,{loop:!0},a.createElement(n.CommandList,null,a.createElement(n.CommandEmpty,null,l.__("No results found.","bookster")),a.createElement(n.CommandGroup,{className:"[&_[cmdk-item]]:bw-pl-5"},a.createElement(n.ComboboxItem,{value:"approved",isActive:d.includes("approved"),onSelect:()=>p("approved")},l.__("Approved","bookster"),a.createElement(n.ComboboxItemIcon,null)),a.createElement(n.ComboboxItem,{value:"pending",isActive:d.includes("pending"),onSelect:()=>p("pending")},l.__("Pending","bookster"),a.createElement(n.ComboboxItemIcon,null)),a.createElement(n.ComboboxItem,{value:"canceled",isActive:d.includes("canceled"),onSelect:()=>p("canceled")},l.__("Canceled","bookster"),a.createElement(n.ComboboxItemIcon,null)))))))}function y(){const[e]=t.useSearchParams(),a={in_args:{}},o=e.get("code"),l=n.useDebounce(o,{wait:500}),r=parseInt((null==l?void 0:l.replace("#",""))??"",10);if(!isNaN(r))return a["appt.appointment_id"]=r,a;const c=e.get("date-from"),m=e.get("date-to");c&&m&&(a.datetime_start={operator:"BETWEEN",min:s.dayjs(c,s.DAY_KEY_FORMAT).startOf("day").format(s.DB_TIMESTAMP_FORMAT),max:s.dayjs(m,s.DAY_KEY_FORMAT).endOf("day").format(s.DB_TIMESTAMP_FORMAT)});const u=e.get("status"),b=u?u.split(","):null;b&&b.length>0&&(a.in_args.book_status={values:b,placeholder:"%s"});const d=e.get("payment"),p=d?d.split(","):null;p&&p.length>0&&(a.in_args.payment_status={values:p,placeholder:"%s",alias:"booking"});const w=e.get("agent"),g=w?w.split(","):null;g&&g.length>0&&(a.in_args.agent_id={values:g.map((e=>parseInt(e,10))),placeholder:"%d",alias:"assignment"});const E=e.get("service"),h=E?E.split(","):null;h&&h.length>0&&(a.in_args.service_id={values:h.map((e=>parseInt(e,10))),placeholder:"%d"});const y=e.get("customer"),v=y?y.split(","):null;return v&&v.length>0&&(a.in_args.customer_id={values:v.map((e=>parseInt(e,10))),placeholder:"%d",alias:"booking"}),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptList.apptsFilterPayload,a,e)}function v({appts:l}){const{toast:r}=n.useToast(),s=t.useQueryClient(),i=e.useMemo((()=>l.map((e=>e.appointment_id))),[l]),u=function(e){if(0===e.length)return"undefined";const t=e[0].book_status;return e.some((e=>e.book_status!==t))?"undefined":t}(l),b=t.useIsMutating({mutationKey:["appointments"]}),d=t.useMutation({mutationKey:["appointments",i,"updateStatus"],mutationFn:({ids:e,bookStatus:t})=>m(e,{book_status:t}),onSuccess:()=>{s.invalidateQueries({queryKey:["appointment"]}),s.invalidateQueries({queryKey:["appointments"]})}});return a.createElement(n.Select,{value:u,onValueChange:async function(e){if(i&&0!==i.length&&!b)try{await d.mutateAsync({ids:i,bookStatus:e}),r.success("Appointment Rows has been Updated Successfully!")}catch(a){r.error(await t.getErrorMsg(a))}}},a.createElement(n.SelectTrigger,{size:"medium",className:"bw-w-[60px] bw-ps-2.5 hover:bw-border-gray-100 focus:bw-border-gray-100 [&>span]:bw-justify-start",withStatus:!1,onClick:e=>{e.stopPropagation()}},d.isLoading?a.createElement(o.Loader2,{className:"bw-h-3.5 bw-w-3.5 bw-animate-spin bw-text-gray-500"}):a.createElement(a.Fragment,null,"undefined"===u&&a.createElement(o.Circle,{className:"bw-h-3.5 bw-w-3.5 bw-text-gray-500"}),"pending"===u&&a.createElement(o.Pending,{className:"bw-h-3.5 bw-w-3.5 bw-text-warning"}),"approved"===u&&a.createElement(o.CheckCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-success"}),"canceled"===u&&a.createElement(o.XCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-error"}))),a.createElement(n.SelectContent,{align:"end",side:"top",sideOffset:10},a.createElement(n.SelectGroup,null,a.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"pending"},a.createElement(o.Pending,{className:"bw-text-warning"})," ",c("pending")),a.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"approved"},a.createElement(o.CheckCircle,{className:"bw-text-success"})," ",c("approved")),a.createElement(n.SelectItem,{className:"[&>span]:bw-justify-start",value:"canceled"},a.createElement(o.XCircle,{className:"bw-text-error"})," ",c("canceled")))))}function _({ids:r}){const{toast:s}=n.useToast(),i=t.useQueryClient(),[c,m]=e.useState(!1),b=t.useIsMutating({mutationKey:["appointments"]}),d=t.useMutation({mutationKey:["appointments",r,"delete"],mutationFn:u,onSuccess:()=>{i.invalidateQueries({queryKey:["appointment"]}),i.invalidateQueries({queryKey:["appointments"]})}});return a.createElement(n.Popover,{open:c,onOpenChange:m},a.createElement(n.PopoverTrigger,{asChild:!0},a.createElement(n.Button,{color:"error",variant:"link"},d.isLoading?a.createElement(o.Loader2,{className:"bw-h-4 bw-w-4 bw-animate-spin"}):a.createElement(o.Trash,{className:"bw-h-4 bw-w-4"}),l.__("Delete Data","bookster"))),a.createElement(n.ConfirmPopoverContent,null,a.createElement(o.AlertFilled,{className:"bw-text-error"}),a.createElement(n.ConfirmPopoverTitle,null,l.__("Delete Multiple Appointments","bookster")),a.createElement(n.ConfirmPopoverDescription,null,l.sprintf(l.__("This action cannot be undone. This will permanently delete %s appointments.","bookster"),r.length)),a.createElement(n.ConfirmPopoverActions,null,a.createElement(n.PopoverClose,{asChild:!0},a.createElement(n.Button,{variant:"soft"},l.__("Cancel","bookster"))),a.createElement(n.Button,{variant:"fill",onClick:async function(){if(r&&0!==r.length&&!b)try{await d.mutateAsync(r),m(!1),s.success("Appointment Rows has been Deleted Successfully!")}catch(e){s.error(await t.getErrorMsg(e))}}},l.__("Confirm Delete","bookster")))))}function f(){const o=b((e=>e.appointments.ui.order)),r=e.useMemo((()=>["select","appointment_id",...o,"actions"]),[o]),s=b((e=>e.appointments.ui.hidden)),i=e.useMemo((()=>s.reduce(((e,t)=>(e[t]=!1,e)),{})),[r,s]),c=e.useMemo((()=>[]),[]),[m,u]=e.useState({}),{pagination:g,setPagination:E,pagingPayload:h}=t.usePagination(),f={...h,...y()},x=t.useQueryClient(),k=p(),{data:S,isLoading:N}=t.useQuery({queryKey:["appointments",f],queryFn:()=>d(f),keepPreviousData:!0}),T=e.useMemo((()=>w()),[]),P=t.useReactTable({data:(null==S?void 0:S.data)||c,columns:T,getRowId:e=>e.appointment_id.toString(),getCoreRowModel:t.getCoreRowModel(),state:{pagination:g,rowSelection:m,columnOrder:r,columnVisibility:i},onPaginationChange:E,onRowSelectionChange:u,manualPagination:!0,rowCount:null==S?void 0:S.total,autoResetPageIndex:!1,meta:{queryClient:x}});return n.useRemoveSelectOnChange(P,(e=>e.appointment_id.toString()),S),n.useResetPageOnOverflow(P,S),a.createElement(a.Fragment,null,a.createElement(n.Table,null,a.createElement(n.TableHeader,null,a.createElement(n.TableHeadRow,null,P.getLeafHeaders().map((e=>a.createElement(n.TableHead,{key:e.id,style:{width:`${e.column.getSize()}px`}},t.flexRender(e.column.columnDef.header,e.getContext())))))),a.createElement(n.TableBody,null,P.getRowModel().rows.map((e=>a.createElement(n.TableRow,{key:e.original.appointment_id,isSelected:e.getIsSelected(),onClick:()=>{var t;const a=null==(t=null==window?void 0:window.getSelection())?void 0:t.toString();var n;(null==a?void 0:a.length)||C(x,e.original.appointment_id)||(n=e.original,x.setQueryData(["appointment",n.appointment_id],n),k(`${n.appointment_id}`))}},e.getVisibleCells().map((e=>a.createElement(n.TableCell,{key:e.id,style:{width:`${e.column.getSize()}px`}},t.flexRender(e.column.columnDef.cell,e.getContext()))))))),(N||0===(null==S?void 0:S.data.length))&&a.createElement(n.TableRow,{className:"bw-pointer-events-none"},a.createElement(n.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},a.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-gray-500"},N?`${l.__("Loading","bookster")}...`:l.__("No Data Found","bookster")))))),a.createElement(n.Pagination,{table:P}),a.createElement(n.TableToaster,null,a.createElement(n.TableToast,{open:Object.keys(m).length>0,onOpenChange:e=>{e||P.resetRowSelection()}},a.createElement(n.TableToastClose,null),a.createElement(n.TableToastTitle,null,Object.keys(m).length," ",l.__("Selected","bookster")),a.createElement(n.Separator,{orientation:"vertical"}),a.createElement(v,{appts:P.getSelectedRowModel().rows.map((e=>e.original))}),a.createElement(n.Separator,{orientation:"vertical"}),a.createElement(_,{ids:Object.keys(m).map(Number)}))))}function C(e,t){return e.isMutating({predicate:e=>{const a=e.options.mutationKey;return!(!a||a.length<2||"appointments"!==a[0])&&(a[1]===t||Array.isArray(a[1]))}})>0}function x({className:e,...r}){const[s,i]=t.useSearchParams(),c=s.get("code");return a.createElement("div",{className:"bw-relative"},a.createElement(n.InputPrefix,null,a.createElement(o.Search,null)),a.createElement(n.Input,{size:"medium",className:n.clsx("bw-ps-10",e),withStatus:!1,value:c??"",onChange:e=>{const t=e.target.value??"";var a;a=t,i((e=>(e.set("code",a),e)))},placeholder:l.__("Search by ID","bookster"),...r}))}function k(e){const[l,r]=t.useSearchParams(),i=l.get("date-from"),c=l.get("date-to"),m=i&&c?[s.dayjs(i,s.DAY_KEY_FORMAT),s.dayjs(c,s.DAY_KEY_FORMAT)]:[null,null];return a.createElement(n.DateRangePicker,{className:"bw-w-64 [&_.bant-picker-input>input]:bw-text-gray-500",size:"medium",format:"MMM D, YYYY",value:m,onChange:e=>{const t=e??[null,null];r((e=>(t[0]&&t[1]?(e.set("date-from",t[0].format(s.DAY_KEY_FORMAT)),e.set("date-to",t[1].format(s.DAY_KEY_FORMAT))):(e.delete("date-from"),e.delete("date-to")),e)))},allowClear:{clearIcon:a.createElement(o.MinusCircle,{className:"bw-h-3.5 bw-w-3.5"})},presets:N,...e})}const S=s.dayjs(),N=[{label:a.createElement("a",null,l.__("Today","bookster")),value:[S,S]},{label:a.createElement("a",null,l.__("This week","bookster")),value:[S.startOf("week"),S.endOf("week")]},{label:a.createElement("a",null,l.__("This month","bookster")),value:[S.startOf("month"),S.endOf("month")]},{label:a.createElement("a",null,l.__("Next 7 days","bookster")),value:[S,S.add(7,"day")]},{label:a.createElement("a",null,l.__("Next 30 days","bookster")),value:[S,S.add(30,"day")]}];function T(){const e=t.useQueryClient(),n=t.useIsFetching({queryKey:["appointments"]});return a.createElement(g,{className:"bw-bg-white",onClick:()=>{e.invalidateQueries({queryKey:["appointments"]}),e.invalidateQueries({queryKey:["appointment"]})},isFetching:n>0})}export{h as A,T as R,E as a,k as b,x as c,f as d,C as i,y as u};
