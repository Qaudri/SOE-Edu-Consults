import{w as e,r as t,d as a,R as r,_ as n,a as l,c as o,b as s,L as i,f as c,s as m}from"./prefetch.helper-04349684.js";import{j as b,C as u}from"./CoverPicker-52693ec5.js";import{D as d}from"./color.helper-9b8c6bb8.js";import{u as w}from"./store-bdc614dc.js";function p(e,t,a){const r={};return t.forEach((t=>{if(!t.agent_id)return;const n=e.find((e=>e.agent_id===t.agent_id));r[t.agent_id.toString()]={agent_id:t.agent_id,service_id:a,available:!n||n.available}})),r}function v(e,t){const a=p(e.available_agent_services||[],t,e.service_id);return{...e,available_agent_services:a}}function g(e){const t=e.available_agent_services?Object.values(e.available_agent_services):[];return{...e,available_agent_services:t}}function f(t){const a=p([],t,void 0);return{name:"",activated:!0,visibility:"public",price:"100.00",duration:e(),buffer_before:0,buffer_after:0,description:"",theme_color:"#66cc8a",available_agent_services:a}}function _({formNamePrefix:e,agent:o}){if(!o.agent_id)return null;const s=t.useMemo((()=>[...e,o.agent_id.toString(),"agent_id"]),[e,o.agent_id]),i=t.useMemo((()=>[...e,o.agent_id.toString(),"available"]),[e,o.agent_id]),c=a.Form.useFormInstance(),m=a.Form.useWatch(i,c);return r.createElement(r.Fragment,null,r.createElement(a.Form.Item,{name:s,hidden:!0},r.createElement(n.InputNumber,null)),r.createElement(a.Form.Item,{name:i,trigger:"onCheckedChange",valuePropName:"checked",hidden:!0},r.createElement(n.Checkbox,null)),r.createElement("div",{className:n.cx("bw-flex bw-min-h-[48px] bw-w-full bw-cursor-pointer bw-select-none bw-items-center bw-gap-2 bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap bw-rounded-theme bw-border bw-px-2.5 bw-py-2 bw-text-sm bw-transition-colors bw-ease-in-out",m?"bw-bg-info/5 bw-text-info":"bw-border-gray-100 bw-text-gray-900 hover:bw-border-info hover:bw-text-info"),onClick:function(){const e=c.getFieldValue(i);c.setFieldValue(i,!e)}},r.createElement(n.Avatar,{className:"bw-h-8 bw-w-8 bw-flex-none"},r.createElement(n.AvatarImage,{src:o.transient_avatar_url}),r.createElement(n.AvatarFallback,null,r.createElement(l.User,null))),r.createElement("span",{className:"bw-flex-1 bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap"},o.first_name," ",o.last_name),r.createElement(l.Check,{className:n.cx("bw-flex-none",!m&&"bw-opacity-0")})))}function E({formNamePrefix:e}){const c=o.useActiveAgents(),[m,b]=t.useState(""),u=a.Form.useFormInstance(),d=a.Form.useWatch(e,u),{selected:w,total:p}=t.useMemo((()=>{const e=Object.values(d||{});return{selected:e.filter((({available:e})=>e)).length,total:e.length}}),[d]),v=e=>e.first_name.toLowerCase().includes(m.toLowerCase())||e.last_name.toLowerCase().includes(m.toLowerCase()),g=c.some((e=>v(e)));return r.createElement(r.Fragment,null,r.createElement("div",{className:"bw-relative"},r.createElement(n.InputPrefix,{className:"bw-opacity-100"},r.createElement(l.Search,{className:"bw-text-gray-500"})),r.createElement(n.Input,{size:"medium",className:"bw-h-9 bw-ps-10",withStatus:!1,onChange:e=>{b(e.target.value)},placeholder:s.__("Search","bookster")})),r.createElement("p",{className:"bw-my-4 bw-text-xs bw-italic bw-text-gray-500"},s.sprintf(s.__("Selected %(agents)s","bookster"),i),": ",w,"/",p),!g&&r.createElement("div",{className:"btr-scrollbar-sm bw-max-h-[500px] bw-flex-grow bw-divide-y bw-divide-gray-100 bw-overflow-y-auto bw-rounded bw-border bw-border-gray-100"},r.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-px-2.5 bw-text-sm"},s.sprintf(s.__("No %(agents)s found.","bookster"),i))),r.createElement("div",{className:"bw-grid bw-grid-cols-4 bw-gap-x-4 bw-gap-y-4"},c.map((t=>v(t)?r.createElement("div",{className:"bw-col-span-3 sm:bw-col-span-2",key:t.agent_id},r.createElement(_,{agent:t,formNamePrefix:e})):null))))}function h({formNamePrefix:e,allLabel:o}){const c=a.Form.useFormInstance(),m=a.Form.useWatch(e,c),b=t.useMemo((()=>{if(!m)return{checkAll:!1,indeterminate:!1};const e=Object.values(m);if(0===e.length)return{checkAll:!1,indeterminate:!1};const t=e.every((e=>e.available));return{checkAll:t,indeterminate:e.some((e=>e.available))&&!t}}),[m]);return r.createElement(r.Fragment,null,r.createElement(E,{formNamePrefix:e}),r.createElement("div",{className:"bw-absolute bw-bottom-[65px] bw-left-0 bw-flex bw-h-14 bw-w-full bw-items-center bw-gap-2 bw-bg-white bw-px-5 bw-shadow-[0px_-2px_10px_rgba(0,0,0,0.04)]"},r.createElement(n.Checkbox,{id:"check-all",onClick:()=>{const e={...m};Object.values(m).forEach((t=>{if(!t.agent_id)return;const a=t.agent_id.toString();e[a]={...e[a],available:!b.checkAll}})),c.setFieldsValue({available_agent_services:e})},checked:b.indeterminate?"indeterminate":b.checkAll}),r.createElement(n.Label,{className:"bw-cursor-pointer bw-text-sm",htmlFor:"check-all"},o),r.createElement(n.Tooltip,{content:s.sprintf(s.__("Available only apply to %(customer)s Booking Form. For Manager, there is no restriction.","bookster"),i)},r.createElement(l.HelpCircle,{size:8,className:"bw-text-gray-500"}))))}function x(){return r.createElement(h,{formNamePrefix:["available_agent_services"],allLabel:s.sprintf(s.__("This %(service)s is available for all %(agents)s","bookster"),i)})}function N({value:e,onChange:t,...a}){const l=e?parseFloat(e):0;return r.createElement(n.InputNumber,{max:1e8,min:0,step:5,formatter:(e,{userTyping:t,input:a})=>void 0===e?"":!0===t?a:o.formatPrice(e),parser:e=>{if(void 0===e)return 0;let t=null==e?void 0:e.replace(new RegExp(`[^\\d${o.DECIMAL_SEPARATOR}]`,"g"),"");return t=null==t?void 0:t.replace(o.DECIMAL_SEPARATOR,"."),parseFloat(t)},value:l,onChange:e=>{t&&t(null===e?null:e.toLocaleString("en-US",{maximumFractionDigits:o.NUMBER_OF_DECIMALS,minimumFractionDigits:o.NUMBER_OF_DECIMALS,useGrouping:!1}))},"data-negative":l<0,...a})}function C(){const{serviceId:e}=o.useParams();return isNaN(Number(e))?null:Number(e)}function k(e){return o.useQuery({queryKey:["service",e],queryFn:()=>e?b(e):null,staleTime:0})}function y({value:e,onChange:a,className:i,...c}){const[m,b]=t.useState(!1),[u,d]=t.useState(""),p=n.useDebounce(u,{wait:300}),v=w((e=>e.newServiceNestedCategory)),g=o.useQueryClient(),f=o.useAllServices(),_=t.useMemo((()=>p?f.filter((e=>e.name.toLowerCase().includes(p.toLowerCase()))):f),[f,p]),E=e||null,h=f.find((e=>e.service_category_id===E)),x=t.useMemo((()=>E?r.createElement("span",null,null==h?void 0:h.name):r.createElement("span",{role:"placeholder"},s.__("Select Category","bookster"))),[E,h]),N=0===_.length;return r.createElement(n.Combobox,{open:m,onOpenChange:b},r.createElement(n.ComboboxTrigger,{size:"large",className:i,...c},r.createElement("span",{className:"bw-overflow-hidden"},x),r.createElement(n.ComboboxIcon,null)),r.createElement(n.ComboboxPortalContent,{className:"bw-w-[var(--radix-popover-trigger-width)] bw-p-0 bw-shadow-md"},r.createElement(n.Command,{...E?{defaultValue:`${E}`}:{},loop:!0,shouldFilter:!1},r.createElement(n.CommandInput,{placeholder:s.__("Search categories...","bookster"),className:"bw-px-4 [&_[cmdk-input]]:bw-h-11 [&_[cmdk-input]]:bw-ps-8",value:u,onValueChange:d}),r.createElement(n.CommandList,null,r.createElement(n.CommandGroup,{className:"bw-pt-2"},r.createElement(n.ComboboxItem,{className:"bw-px-2 bw-py-2 bw-text-gray-500 aria-selected:bw-text-primary",value:"create-new",onSelect:()=>{v(),b(!1)}},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-2.5 bw-overflow-x-hidden"},r.createElement("div",{className:"bw-inline-flex bw-h-6 bw-w-6 bw-items-center bw-justify-center bw-rounded-full bw-border bw-border-dashed bw-border-current"},r.createElement(l.Plus,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),r.createElement("span",null,s.__("Create New","bookster")))),r.createElement(n.Separator,{className:"bw-mb-0 bw-mt-2"})),r.createElement(n.CommandGroup,null,N&&r.createElement("div",{className:"bw-py-6 bw-text-center bw-text-gray-500"},s.__("No Categories found.","bookster")),_.map((e=>r.createElement(n.ComboboxItem,{key:e.service_category_id,value:e.service_category_id.toString(),isActive:E===e.service_category_id,className:"bw-px-2 bw-py-2",onSelect:()=>{(e=>{g.setQueryData(["serviceCategories",e.service_category_id],e),a&&a(e.service_category_id),b(!1)})(e)}},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-2.5 bw-overflow-x-hidden"},r.createElement("span",{className:"bw-text-nowrap"},e.name)),r.createElement(n.ComboboxItemIcon,null)))))))))}function F(){const o=C(),{data:b}=k(o),w=a.Form.useFormInstance(),[p,v]=t.useState("");return t.useEffect((()=>{b&&v((null==b?void 0:b.transient_cover_url)?b.transient_cover_url:"")}),[b]),r.createElement(r.Fragment,null,r.createElement(u,{coverSrc:p,onSelectCover:e=>{w.setFieldValue("cover_id",+e.id),v(e.url)},onRemoveCover:e=>{w.setFieldValue("cover_id",null),v(e)}}),r.createElement(n.FormItem,{name:"cover_id",hidden:!0},r.createElement("input",null)),r.createElement(n.FormItem,{name:"name",label:s.sprintf(s.__("%(service)s Name","bookster"),i),rules:[{required:!0}],className:"bw-pt-3"},r.createElement(n.Input,{placeholder:s.sprintf(s.__("Please enter %(service)s Name","bookster"),i),autoFocus:!0})),r.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-5 sm:bw-grid-cols-4"},r.createElement("div",{className:"bw-col-span-2"},r.createElement(n.FormItem,{label:s.sprintf(s.__("%(service)s Category","bookster"),i),name:"service_category_id",rules:[{required:!0}],trigger:"onChange"},r.createElement(y,null)),r.createElement(n.FormItem,{name:"price",label:s.sprintf(s.__("%(service)s Price","bookster"),i),rules:[{required:!0},{validator:function(e,t){return t&&m.Decimal.fromString(t).isNegative()?Promise.reject(s.sprintf(s.__("%(service)s Price can not be negative","bookster"),i)):Promise.resolve()}}]},r.createElement(N,{className:"bw-w-full"})),r.createElement(n.FormItem,{name:"buffer_before",label:s.__("Buffer Before","bookster"),tooltip:s.__("Buffer time to prepare before the appointment start.","bookster")},r.createElement(n.InputNumber,{min:0,className:"bw-w-full",formatter:e=>`${e||0} mins`,parser:e=>null==e?void 0:e.replace(/\D/g,""),step:e()}))),r.createElement("div",{className:"bw-col-span-2"},r.createElement(n.FormItem,{name:"theme_color",label:s.__("Theme Color","bookster"),rules:[{required:!0}],getValueFromEvent:e=>e.toHexString()},r.createElement(n.ColorPicker,{presets:d,style:{width:"100%",justifyContent:"start"}})),r.createElement(n.FormItem,{name:"duration",label:s.sprintf(s.__("%(service)s Duration","bookster"),i),rules:[{required:!0},{validator:function(e,t){return null==t||t>0?Promise.resolve():Promise.reject(s.sprintf(s.__("%(service)s Duration must be greater than 0","bookster"),i))}}]},r.createElement(n.InputNumber,{min:0,className:"bw-w-full",formatter:e=>`${e||0} mins`,parser:e=>null==e?void 0:e.replace(/\D/g,""),step:e()})),r.createElement(n.FormItem,{name:"buffer_after",label:s.__("Buffer After","bookster"),tooltip:s.__("Buffer time to rest/clean after the appointment end.","bookster")},r.createElement(n.InputNumber,{min:0,className:"bw-w-full",formatter:e=>`${e||0} mins`,parser:e=>null==e?void 0:e.replace(/\D/g,""),step:e()})))),r.createElement(n.FormItem,{name:"description",label:s.sprintf(s.__("%(service)s Description","bookster"),i)},r.createElement(n.Textarea,{rows:2,placeholder:s.sprintf(s.__("Please enter %(service)s description","bookster"),i),maxLength:150})),r.createElement("div",{className:"bw-mb-3 bw-mt-5 bw-divide-y bw-divide-gray-100 bw-rounded bw-border bw-p-4"},r.createElement("div",{className:"bw-flex bw-items-center bw-gap-4 bw-leading-none"},r.createElement("div",{className:"bw-me-auto"},r.createElement(n.Label,{htmlFor:"activated",className:"bw-cursor-pointer bw-text-sm bw-leading-none bw-text-gray-900"},s.__("Active","bookster")),r.createElement(n.Tooltip,{content:s.__("Deactivate Service to avoid Deleting referencing Appointment, Analytics Data in the past.","bookster-custom-fields"),side:"right"},r.createElement(l.HelpCircle,{className:"bw-ms-1 bw-h-2.5 bw-w-2.5 bw-text-gray-500"})),r.createElement("p",{className:"bw-mt-2 bw-text-xs bw-leading-none bw-text-gray-500"},s.sprintf(s.__("The %(service)s is available for booking.","bookster"),i))),r.createElement(n.Separator,{orientation:"vertical"}),r.createElement(n.FormItem,{name:"activated",valuePropName:"checked",rules:[{required:!0}],trigger:"onCheckedChange",noStyle:!0},r.createElement(n.Switch,{id:"activated"})))),r.createElement(n.FormItem,{name:"visibility",trigger:"onValueChange",label:s.__("Visibility","bookster"),tooltip:s.sprintf(s.__("Private %(services)s are visible to Staff only.","bookster"),i)},r.createElement(n.RadioGroupCard,null,r.createElement(n.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},r.createElement(n.RadioGroupCardItem,{value:"public",align:"middle"}),r.createElement(n.RadioGroupCardTitle,null,s.__("Public","bookster"))),r.createElement(n.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},r.createElement(n.RadioGroupCardItem,{value:"private",align:"middle"}),r.createElement(n.RadioGroupCardTitle,null,s.__("Private","bookster"))))),c.booksterHooks.applyFilters(c.HOOK_NAMES.adminServiceForm.AfterGeneralTab,[]))}export{F as S,x as a,k as b,v as c,f as g,g as p,C as u};
