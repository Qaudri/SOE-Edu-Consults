import{r as e,R as t,a,_ as n,d as r,b as l,c as s,f as o,L as m}from"./prefetch.helper-04349684.js";import{P as i,a as c}from"./UIComponents-7ff4460b.js";import{u}from"./store-bdc614dc.js";import{H as b,B as d}from"./useCacheCustomers-102bfcf8.js";import{T as g,a as p,P as w,b as E,D as _,B as h,c as y,C as k,d as f}from"./settings.constants-7edf7550.js";import{S as C}from"./Settings.styled-aa4d422d.js";import{H as v,W as S}from"./WeeklyScheduleEditor-9e383627.js";import{l as F}from"./lodash-f550b173.js";import"./BEConfigProvider-705eafe2.js";import"./createBookTimeInput.helper-ed47ae63.js";import"./appointment.helper-07645f99.js";import"./CalendarNav.styled-cb1aebbc.js";const N=e.createContext(null);function x(){const t=e.useContext(N);if(!t)throw new Error("Missing SettingsFormsContext.Provider in the tree");return t}const P=t.createElement(t.Fragment,null,t.createElement("span",null,"You might need to Refresh the page to see the changes."),"Â "),T=t.createElement("a",{onClick:()=>window.location.reload()},"Refresh Now"),I={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"General Settings has been Saved Successfully!"),description:P,action:T},G={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Schedule Settings has been Saved Successfully!"),description:P,action:T},L={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Permissions Settings has been Saved Successfully!"),description:P,action:T},M={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Payment Settings has been Saved Successfully!"),description:P,action:T};function R(){const{generalSettingsForm:e}=x(),{generalSettings:a}=u((e=>e.settings)),o=u((e=>e.settingsUpdateGeneral)),{toast:m}=n.useToast(),i={general:a};return t.createElement(r.Form,{layout:"vertical",name:"general",form:e,onFinish:async function(t){try{await o(t),e.resetFields(),m.openToast(I)}catch(a){m.error(await s.getErrorMsg(a))}},initialValues:i},t.createElement("div",{className:"bw-mb-5 bw-rounded-md bw-bg-white bw-p-5 bw-shadow-sm"},t.createElement(b,null,t.createElement(d,null)," ",l.__("Booking Options","bookster")),t.createElement("div",{className:"bw-mb-5 bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(n.FormItem,{name:["general","time_slot_step"],label:l.__("Default Time Slot Step","bookster"),tooltip:l.__("Interval between time slots in booking form, time picker and calendar.","bookster"),trigger:"onValueChange"},t.createElement(g,null)),t.createElement(n.FormItem,{name:["general","default_appointment_status"],label:l.__("Default Appointment Status","bookster"),trigger:"onValueChange"},t.createElement(n.Select,null,t.createElement(n.SelectTrigger,null,t.createElement(n.SelectValue,null)),t.createElement(n.SelectContent,null,t.createElement(n.SelectGroup,null,t.createElement(n.SelectItem,{value:"pending"},l.__("Pending","bookster")),t.createElement(n.SelectItem,{value:"approved"},l.__("Approved","bookster")))))),t.createElement(n.FormItem,{name:["general","items_per_page"],label:l.__("Default Items Per Page","bookster"),tooltip:l.__("Apply to records pages.","bookster"),trigger:"onValueChange"},t.createElement(p,null)),t.createElement(n.FormItem,{name:["general","phone_country_code"],label:l.__("Default Phone Country","bookster")},t.createElement(w,null))),t.createElement(b,null,t.createElement(d,null)," ",l.__("Datetime Formats","bookster")),t.createElement("div",{className:"bw-mb-5 bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(n.FormItem,{name:["general","time_system"],label:l.__("Time Format","bookster"),tooltip:l.__("How to display time in Bookster, also apply to time picker.","bookster"),trigger:"onValueChange"},t.createElement(E,null)),t.createElement(n.FormItem,{name:["general","date_format"],label:l.__("Date Format","bookster"),tooltip:l.__("How to display date in Bookster.","bookster"),trigger:"onValueChange"},t.createElement(_,null))),t.createElement(b,null,t.createElement(d,null)," ",l.__("Restrictions","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(n.FormItem,{name:["general","book_restriction_earliest"],label:l.__("Earliest Possible Booking Time","bookster"),tooltip:l.__("Time Slots before this time will not be available for booking.","bookster")},t.createElement(n.Cascader,{options:h,placeholder:l.__("Please select","bookster")})),t.createElement(n.FormItem,{name:["general","book_restriction_latest"],label:l.__("Latest Possible Booking Time","bookster"),tooltip:l.__("Time Slots after this time will not be available for booking.","bookster")},t.createElement(n.Cascader,{options:y,placeholder:l.__("Please select","bookster")})))),t.createElement(C,null))}function A(){const e=u((e=>e.settings.holidaysSettings)),a=u((e=>e.settings.scheduleSettings)),r=u((e=>e.settingsUpdateHoliday)),{toast:l}=n.useToast();return t.createElement("div",{className:"bw-max-h-[calc(100vh-202px)] bw-overflow-y-auto bw-rounded-md bw-bg-white bw-p-5 bw-shadow-sm"},t.createElement(v,{mode:"holiday",weeklySchedule:a.weekly,holidaySchedule:e,onSubmit:e=>{!async function(e){try{await r(e),l.success("Holidays Settings has been Saved Successfully!")}catch(t){l.error(await s.getErrorMsg(t))}}(e)}}))}function U(e){const t=V(),a=!0===F.get(e,["payment","payment-later","enabled"]),n=t.reduce(((t,a)=>!0===F.get(e,a.enablePath)?t+1:t),0);if(!a&&0===n)throw new Error("At least one payment gateway must be enabled!")}function V(){return o.booksterHooks.applyFilters(o.HOOK_NAMES.settings.paymentMethods,[])}function H({initialValues:s}){const m=r.Form.useFormInstance(),i=e.useMemo((()=>V()),[]),c=e.useMemo((()=>function(e,t){if(0===e.length)return"";const a=e.reduce(((e,a)=>!0===F.get(t,a.enablePath)?a.slug:e),"");return""===a?e[e.length-1].slug:a}(i,s)),[s]),u=e.useMemo((()=>function(e,t){return e.some((e=>!0===F.get(t,e.enablePath)))}(i,s)),[s]),[b,d]=e.useState(c),[g,p]=e.useState(u);return t.createElement(t.Fragment,null,t.createElement(n.Tabs,{value:b,className:"bw-divide-y bw-divide-gray-100 bw-rounded bw-border bw-px-5 bw-text-sm"},t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4 bw-py-4"},t.createElement("span",{className:"bw-me-auto bw-text-base"},l.__("Payment Method","bookster")),i.length>0&&t.createElement(t.Fragment,null,t.createElement(n.SegmentGroup,{value:b,onValueChange:function(e){i.forEach((t=>{t.slug===e?m.setFieldValue(t.enablePath,g):m.setFieldValue(t.enablePath,!1)})),d(e)}},i.map((e=>t.createElement(n.SegmentGroupItem,{key:e.slug,value:e.slug},e.label)))),t.createElement(n.Switch,{checked:g,onCheckedChange:function(e){i.forEach((t=>{t.slug===b?m.setFieldValue(t.enablePath,e):m.setFieldValue(t.enablePath,!1)})),p(e)}})),0===i.length&&t.createElement("span",null,l.__("No payment method available","bookster"),t.createElement(n.Tooltip,{content:l.__("No payment method available","bookster")},t.createElement(a.HelpCircle,{className:"bw-ms-1 bw-h-2.5 bw-w-2.5 bw-text-gray-500"})))),o.booksterHooks.applyFilters(o.HOOK_NAMES.settings.PaymentMethodTabsContent,[])))}function j(){const{paymentSettingsForm:m}=x(),{paymentSettings:i}=u((e=>e.settings)),c=u((e=>e.settingsUpdatePayment)),{toast:g}=n.useToast(),p=e.useMemo((()=>o.booksterHooks.applyFilters(o.HOOK_NAMES.settings.initPaymentSettingsForm,{payment:i})),[i]);return t.createElement(r.Form,{layout:"vertical",name:"payment",form:m,onFinish:async function(e){try{U(e),await c(e),m.resetFields(),g.openToast(M)}catch(t){g.error(await s.getErrorMsg(t))}},initialValues:p},t.createElement("div",{className:"bw-mb-5 bw-rounded-md bw-bg-white bw-p-5 bw-shadow-sm"},t.createElement(b,null,t.createElement(d,null)," ",l.__("Currency Options","bookster")),t.createElement("div",{className:"bw-mb-5 bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{name:["payment","currency"],label:l.__("Currency","bookster"),rules:[{required:!0,message:l.__("Please select currency!","bookster")}]},t.createElement(k,{onChange:e=>{const t=s.CURRENCY_OPTIONS.find((t=>t[0]===e));m.setFieldValue(["payment","currency_symbol"],t?t[2]:"$")}})),t.createElement(r.Form.Item,{name:["payment","currency_symbol"],hidden:!0,noStyle:!0},t.createElement("input",null)),t.createElement(f,null)),t.createElement(b,{className:"bw-mb-4"},t.createElement(d,null)," ",l.__("Payment Gateways","bookster")),t.createElement("div",{className:"bw-mb-5 bw-flex bw-h-9 bw-items-center bw-justify-between bw-rounded bw-border bw-pe-5 bw-ps-3 bw-text-sm bw-leading-none"},t.createElement("span",null,l.__("Pay Later/Locally","bookster"),t.createElement(n.Tooltip,{content:l.__("Pay Later/Locally","bookster")},t.createElement(a.HelpCircle,{className:"bw-ms-1 bw-h-2.5 bw-w-2.5 bw-text-gray-500"}))),t.createElement(r.Form.Item,{name:["payment","payment-later","enabled"],trigger:"onCheckedChange",valuePropName:"checked",noStyle:!0},t.createElement(n.Switch,{id:"payment-later-enabled"}))),t.createElement(H,{initialValues:p})),t.createElement(C,null))}function D({value:a,onChange:r,className:l,...o}){const[m,i]=e.useState(!1),{data:c,isLoading:u}=s.useQuery({queryKey:["wpPages"],queryFn:async()=>{let e=[],t=1,a=!0;for(;a;){const n=await O(t);n.length<100&&(a=!1),e=[...e,...n||[]],t++}return e}}),b=e.useMemo((()=>{if(!a)return"Select a Page";if(!c)return`(ID: ${a})`;const e=c.find((e=>e.id===a));return e?`${e.title.rendered} (ID: ${e.id})`:"Select a Page"}),[a,c]);return t.createElement(n.Combobox,{open:m,onOpenChange:i},t.createElement(n.ComboboxTrigger,{className:l,...o},t.createElement("span",{className:"bw-overflow-hidden"},b),t.createElement(n.ComboboxIcon,null)),t.createElement(n.ComboboxPortalContent,{className:"bw-w-[22rem] bw-p-0 bw-shadow-md",side:"top"},t.createElement(n.Command,{loop:!0},t.createElement(n.CommandInput,{placeholder:"Search Wordpress Page..."}),t.createElement(n.CommandList,null,u&&t.createElement(n.CommandLoading,null,"Fetching pages..."),!u&&t.createElement(n.CommandEmpty,null,"No page found."),t.createElement(n.CommandGroup,{className:"[&_[cmdk-item]]:bw-pl-5"},(c||[]).map((e=>t.createElement(n.ComboboxItem,{key:e.id,value:`${e.id}`,isActive:a===e.id,keywords:[e.title.rendered,`${e.id}`],onSelect:()=>{return t=e.id,r&&r(t),void i(!1);var t}},`${e.title.rendered} (ID: ${e.id})`,t.createElement(n.ComboboxItemIcon,null)))))))))}async function O(e){return await s.wordpressApi.get("pages",{searchParams:{page:e,per_page:100}}).json()}function W(){const{permissionsSettingsForm:e}=x(),{permissionsSettings:a}=u((e=>e.settings)),o=u((e=>e.settingsUpdatePermissions)),{toast:i}=n.useToast(),c={permissions:a};return t.createElement(r.Form,{layout:"vertical",name:"permission",form:e,onFinish:async function(t){try{await o(t),e.resetFields(),i.openToast(L)}catch(a){i.error(await s.getErrorMsg(a))}},initialValues:c},t.createElement("div",{className:"bw-mb-5 bw-rounded-md bw-bg-white bw-p-5 bw-shadow-sm"},t.createElement(b,null,t.createElement(d,null)," ",l.sprintf(l.__("%(agent)s Permissions","bookster"),m)),t.createElement("div",{className:"bw-mb-5"},t.createElement(n.FormItem,{name:["permissions","agents_link_wp_users"],rules:[{required:!0}],trigger:"onValueChange",label:l.sprintf(l.__("Create and Link WP User to %(agent)s","bookster"),m),tooltip:l.sprintf(l.__("%(agent)s would not be able to login to Bookster if WP User not linked.","bookster"),m)},t.createElement(n.RadioGroupCard,null,t.createElement(n.RadioGroupCardLabel,null,t.createElement(n.RadioGroupCardItem,{value:"auto"}),t.createElement(n.RadioGroupCardTitle,null,l.__("Auto","bookster")),t.createElement(n.RadioGroupCardDescription,null,l.__("This means a WP User is created simultaneously with the Agent","bookster"))),t.createElement(n.RadioGroupCardLabel,null,t.createElement(n.RadioGroupCardItem,{value:"manual"}),t.createElement(n.RadioGroupCardTitle,null,l.__("Manual","bookster")),t.createElement(n.RadioGroupCardDescription,null,l.__("This means the WP User is created separately","bookster")))))),t.createElement("div",{className:"bw-mb-8 bw-divide-y bw-divide-gray-100 bw-rounded bw-border bw-p-4"},t.createElement("div",{className:"bw-mb-5 bw-flex bw-items-center bw-gap-4 bw-leading-none"},t.createElement("div",{className:"bw-me-auto"},t.createElement(n.Label,{htmlFor:"agents_allow_edit_appointment",className:"bw-cursor-pointer bw-text-sm bw-leading-none bw-text-gray-900"},l.__("Appointment Time & Status","bookster")),t.createElement("p",{className:"bw-mt-2 bw-text-xs bw-leading-none bw-text-gray-500"},l.sprintf(l.__("Allow %(agent)s to edit his/her appointment time and status","bookster"),m))),t.createElement(n.Separator,{orientation:"vertical"}),t.createElement(n.FormItem,{name:["permissions","agents_allow_edit_appointment"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{id:"agents_allow_edit_appointment"}))),t.createElement("div",{className:"bw-flex bw-items-center bw-gap-4 bw-pt-5 bw-leading-none"},t.createElement("div",{className:"bw-me-auto"},t.createElement(n.Label,{htmlFor:"agents_allow_edit_settings",className:"bw-cursor-pointer bw-text-sm bw-leading-none bw-text-gray-900"},l.__("Working Schedule","bookster")),t.createElement("p",{className:"bw-mt-2 bw-text-xs bw-leading-none bw-text-gray-500"},l.sprintf(l.__("Allow %(agent)s to edit his/her working schedule","bookster"),m))),t.createElement(n.Separator,{orientation:"vertical"}),t.createElement(n.FormItem,{name:["permissions","agents_allow_edit_settings"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{id:"agents_allow_edit_settings"})))),t.createElement(b,null,t.createElement(d,null)," ",l.sprintf(l.__("%(customer)s Permissions","bookster"),m)),t.createElement("div",{className:"bw-mb-5"},t.createElement(n.FormItem,{name:["permissions","customers_link_wp_users"],rules:[{required:!0}],trigger:"onValueChange",label:l.sprintf(l.__("Create and Link WP User to %(customer)s","bookster"),m),tooltip:l.sprintf(l.__("%(customer)s would not be able to login to Bookster if WP User not linked.","bookster"),m)},t.createElement(n.RadioGroupCard,null,t.createElement(n.RadioGroupCardLabel,null,t.createElement(n.RadioGroupCardItem,{value:"auto"}),t.createElement(n.RadioGroupCardTitle,null,l.__("Auto","bookster")),t.createElement(n.RadioGroupCardDescription,null,l.sprintf(l.__("This means WP User is created together with %(customer)s","bookster"),m))),t.createElement(n.RadioGroupCardLabel,null,t.createElement(n.RadioGroupCardItem,{value:"manual"}),t.createElement(n.RadioGroupCardTitle,null,l.__("Manual","bookster")),t.createElement(n.RadioGroupCardDescription,null,l.__("This means the WP User is created separately","bookster")))))),t.createElement("div",{className:"bw-mb-4 bw-divide-y bw-divide-gray-100 bw-rounded bw-border bw-p-4"},t.createElement("div",{className:"bw-mb-5 bw-flex bw-items-center bw-gap-4 bw-leading-none"},t.createElement("div",{className:"bw-me-auto"},t.createElement(n.Label,{htmlFor:"customers_allow_cancel_appointment",className:"bw-cursor-pointer bw-text-sm bw-text-gray-900"},l.__("Cancel Appointment","bookster")),t.createElement("p",{className:"bw-mt-2 bw-text-xs bw-leading-none bw-text-gray-500"},l.sprintf(l.__("Allow %(customer)s to cancel his/her appointment","bookster"),m))),t.createElement(n.Separator,{orientation:"vertical"}),t.createElement(n.FormItem,{name:["permissions","customers_allow_cancel_appointment"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{id:"customers_allow_cancel_appointment"}))),t.createElement("div",{className:"bw-flex bw-items-center bw-justify-between bw-pt-5 bw-leading-none"},t.createElement("div",null,t.createElement(n.Label,{htmlFor:"customer_dashboard_pages",className:"bw-text-sm bw-text-gray-900"},l.sprintf(l.__("%(customer)s Dashboard Page","bookster"),m)),t.createElement("p",{className:"bw-mt-2 bw-text-xs bw-leading-none bw-text-gray-500"},l.sprintf(l.__("%(customer)s dashboard page","bookster"),m))),t.createElement(n.FormItem,{name:["permissions","customer_dashboard_page_id"],rules:[{required:!0}],noStyle:!0},t.createElement(D,{className:"bw-w-[20rem]"}))))),t.createElement(C,null))}function B(){const{scheduleSettingsForm:e}=x(),{scheduleSettings:a}=u((e=>e.settings)),l=u((e=>e.settingsUpdateSchedule)),{toast:o}=n.useToast(),m={schedule:a};return t.createElement(r.Form,{layout:"vertical",name:"schedule",form:e,onFinish:async function(t){try{await l(t),e.resetFields(),o.openToast(G)}catch(a){o.error(await s.getErrorMsg(a))}},initialValues:m},t.createElement("div",{className:"bw-mb-5 bw-rounded-md bw-bg-white bw-px-5 bw-py-2 bw-shadow-sm"},t.createElement(S,{formNamePrefix:["schedule","weekly"],defaultActivePanelKeys:[]})),t.createElement(C,null))}function $(){const e=u((e=>e.settings.isLoading)),a=u((e=>e.settingsUpdateGeneral)),r=u((e=>e.settingsUpdateSchedule)),m=u((e=>e.settingsUpdatePermissions)),c=u((e=>e.settingsUpdatePayment)),b=x(),{toast:d}=n.useToast(),g=s.useNavigate(),{tabId:p="general"}=s.useParams(),w=async e=>{try{const t=function(e,t){switch(e){case"general":return t.generalSettingsForm;case"schedule":return t.scheduleSettingsForm;case"holiday":return null;case"permissions":return t.permissionsSettingsForm;case"payment":return t.paymentSettingsForm;default:return}}(p,b);(null==t?void 0:t.isFieldsTouched())&&(confirm("Do you want to save the form?")?await async function(e,t){const n=await e.validateFields();try{switch(t){case"general":a(n),d.openToast(I);break;case"schedule":r(n),d.openToast(G);break;case"permissions":m(n),d.openToast(L);break;case"payment":U(n),c(n),d.openToast(M);break;default:throw new Error(`Unknown tab id: ${t}`)}}catch(l){d.error(await s.getErrorMsg(l))}}(t,p):t.resetFields()),g(`/settings/${e}`)}catch(t){console.log("Error",t)}};return t.createElement(n.Tabs,{className:"bw-mx-auto bw-max-w-[1350px]",value:p},t.createElement(n.LoadingOverlay,{loading:e}),t.createElement(i.Standalone,{className:"bw-pb-2"},l.__("Settings","bookster")),t.createElement("div",{className:"bw-overflow-x-auto"},t.createElement(n.TabsList,{className:"bw-mb-5 bw-min-w-max"},t.createElement(n.LineTabsTrigger,{value:"general",onClick:()=>{w("general")}},l.__("General","bookster")),t.createElement(n.LineTabsTrigger,{value:"schedule",onClick:()=>{w("schedule")}},l.__("Schedule","bookster")),t.createElement(n.LineTabsTrigger,{value:"holiday",onClick:()=>{w("holiday")}},l.__("Holiday","bookster")),t.createElement(n.LineTabsTrigger,{value:"permissions",onClick:()=>{w("permissions")}},l.__("Permissions","bookster")),t.createElement(n.LineTabsTrigger,{value:"payment",onClick:()=>{w("payment")}},l.__("Payment","bookster")),o.booksterHooks.applyFilters(o.HOOK_NAMES.settings.TabsTrigger,[],w))),t.createElement(n.TabsContent,{value:"general",forceMount:!1},t.createElement(R,null)),t.createElement(n.TabsContent,{value:"schedule",forceMount:!1},t.createElement(B,null)),t.createElement(n.TabsContent,{value:"holiday",forceMount:!1},t.createElement(A,null)),t.createElement(n.TabsContent,{value:"permissions",forceMount:!1},t.createElement(W,null)),t.createElement(n.TabsContent,{value:"payment",forceMount:!1},t.createElement(j,null)),o.booksterHooks.applyFilters(o.HOOK_NAMES.settings.TabsContent,[]))}function K({children:e}){const[a]=r.Form.useForm(),[n]=r.Form.useForm(),[l]=r.Form.useForm(),[s]=r.Form.useForm();return t.createElement(N.Provider,{value:{generalSettingsForm:a,scheduleSettingsForm:n,permissionsSettingsForm:l,paymentSettingsForm:s}},e)}function q(){return t.createElement(c,null,t.createElement(K,null,t.createElement($,null)))}t.Fragment,a.CheckCircle;export{q as default};
