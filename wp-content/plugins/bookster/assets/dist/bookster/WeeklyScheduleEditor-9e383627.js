import{r as e,d as t,R as a,_ as r,b as n,g as o,a as l,W as s,c as i}from"./prefetch.helper-04349684.js";import{l as c}from"./lodash-f550b173.js";import{a as m}from"./CalendarNav.styled-cb1aebbc.js";const d=e.createContext(null);function b(){const t=e.useContext(d);if(!t)throw new Error("Missing HolidaysScheduleEditorContext.Provider in the tree");return t}function u(){const{mode:e}=b(),o=t.Form.useFormInstance(),l=t.Form.useWatch("isDayOff",o),s=t.Form.useWatch("year",o);return a.createElement(a.Fragment,null,a.createElement(t.Form.Item,{name:"year",hidden:!0},a.createElement(r.InputNumber,null)),a.createElement("div",{className:"bw-grid bw-grid-cols-1"},a.createElement(t.Form.Item,{label:n.__("Name Holiday","bookster"),name:"name"},a.createElement(r.Input,null)),a.createElement(t.Form.Item,{label:n.__("Day Off","bookster"),name:"dateOffRange",rules:[{required:!0}]},a.createElement(r.DateRangePicker,{format:"MMMM D, YYYY",disabledDate:e=>e.year()!==s,className:"bw-w-full",dropdownClassName:"[&_.bant-picker-header-super-prev-btn]:bw-hidden [&_.bant-picker-header-super-next-btn]:bw-hidden"})),a.createElement(t.Form.Item,{label:n.__("Enable","bookster")},a.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-justify-between bw-rounded bw-border bw-px-3 bw-text-sm"},a.createElement("span",null,n.__("Holiday status is active","bookster")),a.createElement(t.Form.Item,{name:"isDayOff",valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},a.createElement(r.Switch,null)))),"holiday"===e&&a.createElement(t.Form.Item,{name:"repeatOption",label:n.__("Repeat","bookster"),trigger:"onValueChange",help:n.sprintf(
// translators: %s: day off or working day.
n.__("Select “Repeat yearly” to apply the chosen %s to every year.","bookster"),l?n.__("day off","bookster"):n.__("working day","bookster"))},a.createElement(r.RadioGroupCard,{className:"bw-pb-2"},a.createElement(r.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},a.createElement(r.RadioGroupCardItem,{value:"once",align:"middle"}),a.createElement(r.RadioGroupCardTitle,null,l?n.__("Once off","bookster"):n.__("Working day","bookster"))),a.createElement(r.RadioGroupCardLabel,{className:"bw-h-9 bw-justify-center"},a.createElement(r.RadioGroupCardItem,{value:"repeat_yearly",align:"middle"}),a.createElement(r.RadioGroupCardTitle,null,n.__("Repeat yearly","bookster")))))))}function w(){const{mode:e}=b();return a.createElement("div",{className:"bw-flex bw-gap-6 bw-pb-5 bw-text-xs bw-text-gray-900"},a.createElement("div",{className:"bw-flex bw-items-center bw-gap-1"},a.createElement(f,{className:"bw-bg-orange"}),"holiday"===e?n.__("Once Off","bookster"):n.__("Agent Day Off","bookster")),a.createElement("div",{className:"bw-flex bw-items-center bw-gap-1"},a.createElement(f,{className:"bw-bg-error"}),"holiday"===e?n.__("Repeat Yearly","bookster"):n.__("Shop Day Off","bookster")))}const f=r.stylex.div("bw-w-[35px] bw-h-[15px] bw-rounded-[5px] bw-border-2 bw-border-solid bw-border-white/80");function y({date:t,isSelect:n,inSelect:l}){const{mode:s,year:i,weeklySchedule:c,holidaySchedule:m,dayOffSchedule:d,onClickCell:u,onMouseEnterCell:w}=b(),f=e.useMemo((()=>t.format("DD")),[t]),y=e.useMemo((()=>i.toString()),[t]),E=e.useMemo((()=>t.format(o.DATE_KEY_FORMAT)),[t]),v=e.useMemo((()=>{const e=t.day();return!1===c[e].working}),[t,c]),k=e.useMemo((()=>{var e;return p(null==(e=m.every_year)?void 0:e[E])}),[t,m]),x=e.useMemo((()=>{var e,t;return p(null==(t=null==(e=m.specific_year)?void 0:e[y])?void 0:t[E])}),[t,m]),_=e.useMemo((()=>{var e,t;return g(null==(t=null==(e=m.specific_year)?void 0:e[y])?void 0:t[E])}),[t,d]),C=e.useMemo((()=>{var e;return"dayoff"===s&&p(null==(e=null==d?void 0:d[i])?void 0:e[E])}),[t,d]),D=e.useMemo((()=>{var e;return"dayoff"===s&&g(null==(e=null==d?void 0:d[i])?void 0:e[E])}),[t,d]),S=e.useMemo((()=>n[0]===t.date()),[t,n]),N=e.useMemo((()=>n[1]===t.date()),[t,n]),F=e.useMemo((()=>l[0]&&l[1]&&l[0]<=t.date()&&t.date()<=l[1]),[t,l]),M=e.useMemo((()=>r.cx("bw-absolute bw-end-0 bw-start-0 bw-top-1/2 -bw-z-10 bw-block bw-h-8 -bw-translate-y-1/2 bw-bg-transparent",F&&"bw-bg-gray-50",S&&"bw-start-1/2",N&&"bw-end-1/2")),[F,S,N]),O=e.useMemo((()=>r.cx("bw-z-20 bw-inline-flex bw-h-8 bw-w-full bw-items-center bw-select-none bw-justify-center bw-rounded-sm group-hover:bw-bg-gray-50","holiday"===s&&x&&"bw-bg-orange/[.04] bw-text-orange","dayoff"===s&&C&&"bw-bg-orange/[.04] bw-text-orange",v&&"bw-bg-error/[.04] bw-text-error","dayoff"===s&&x&&"bw-bg-error/[.04] bw-text-error",k&&"bw-bg-error/[.04] bw-text-error",_&&!("dayoff"===s&&C)&&"bw-bg-inherit bw-text-inherit","dayoff"===s&&D&&"bw-bg-inherit bw-text-inherit",F&&"bw-bg-gray-50",(S||N)&&"bw-bg-primary bw-text-white group-hover:bw-bg-primary")),[v,k,s,x,_,C,D,F,S,N]),P=e.useMemo((()=>{var e,t,a,r,n;return"dayoff"===s&&D?void 0:!_||"dayoff"===s&&C?k?h(null==(e=m.every_year)?void 0:e[E],"Holiday"):"dayoff"===s&&x?h(null==(t=null==d?void 0:d[i])?void 0:t[E]):v?"Weekly Day Off":"dayoff"===s&&C?h(null==(a=null==d?void 0:d[i])?void 0:a[E]):"holiday"===s&&x?h(null==(n=null==(r=m.specific_year)?void 0:r[y])?void 0:n[E],"Holiday"):void 0:void 0}),[v,k,s,x,_,C,D]),I=a.createElement("div",{onMouseEnter:()=>w(t),onClick:()=>u(t),className:"bw-group bw-relative bw-z-10 bw-h-full bw-w-full bw-p-1 bw-text-sm"},a.createElement("div",{className:M}),a.createElement("div",{className:O},f));return P?a.createElement(r.Tooltip,{content:P},I):I}function p(e){return!0===e||!0===(null==e?void 0:e.isDayOff)}function g(e){return!1===e||!1===(null==e?void 0:e.isDayOff)}function h(e,t="Day Off"){return!0===e?t:!1===e||void 0===e?void 0:e.name&&""!==e.name?e.name:void 0}function E({month:r,isSelect:n,inSelect:l}){const{year:s}=b(),i=e.useMemo((()=>o.dayjs(`${s}-01-01`).month(r)),[s,r]);return a.createElement("div",{className:"bw-rounded bw-border bw-border-solid"},a.createElement(t.Calendar,{className:"btr-holiday-month-calendar",fullscreen:!1,headerRender:()=>a.createElement("p",{className:"bw-py-3 bw-text-center bw-text-base bw-font-medium"},v[r]),mode:"month",value:i,fullCellRender:e=>a.createElement(y,{date:e,isSelect:n,inSelect:l})}))}const v=o.dayjs().localeData().months();function k({decrement:e,increment:t}){const{year:r}=b();return a.createElement(a.Fragment,null,a.createElement("div",{className:"bw-flex bw-flex-row bw-gap-1 rtl:bw-flex-row-reverse"},a.createElement(m,{onClick:e},a.createElement(l.ChevronLeft,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),a.createElement(m,{onClick:t},a.createElement(l.ChevronRight,{strokeWidth:"2",className:"bw-h-3 bw-w-3"}))),a.createElement("span",{className:"bw-me-auto bw-ms-2 bw-text-sm bw-font-normal"},r))}function x(e,t,a){for(let r=t;!r.isAfter(a);r=r.add(1,"day")){const t=e[r.format("MM-DD")];if("object"==typeof t)return t}}const _=[1,31],C=[void 0,void 0],D={isSelecting:"DateFrom",selectedDateFrom:null,selectedDateTo:null,monthIsSelectCache:Array(12).fill(C),monthInSelectCache:Array(12).fill(C)};function S({mode:s,weeklySchedule:i,holidaySchedule:c,dayOffSchedule:m,onSubmit:b}){const[f]=t.Form.useForm(),[y,p]=e.useState(M),[g,h]=e.useState(!0),{selectedDateRange:v,selectDateFrom:S,selectDateTo:N,resetSelecting:I}=function(){const[e,t]=r.useSetState(D);return{selectedDateRange:e,selectDateFrom:function(e){t((()=>{const t=e.month(),a=e.date(),r=Array(12).fill(C),n=Array(12).fill(C);return r[t]=[a,a],n[t]=[a,a],{isSelecting:"DateTo",selectedDateFrom:e,selectedDateTo:e,monthInSelectCache:n,monthIsSelectCache:r}}))},selectDateTo:function(e){t((t=>{if(!t.selectedDateFrom)return null;const a=e.isAfter(t.selectedDateFrom),r=a?t.selectedDateFrom:e,n=a?e:t.selectedDateFrom,o=r.month(),l=n.month(),s=Array(12).fill(C);s[o]=[r.date(),void 0],s[l]=[s[l][0],n.date()];const i=Array(12).fill(C).map(((e,t)=>t===o&&t===l?[r.date(),n.date()]:t===o?[r.date(),31]:t===l?[1,n.date()]:t>o&&t<l?_:e));return{isSelecting:"DateTo",selectedDateTo:e,monthIsSelectCache:s,monthInSelectCache:i}}))},resetSelecting:function(){t(D)}}}(),[R,T]=e.useState(!1),[A,j]=e.useState("new");function W(e,t){if("holiday"===s){const a=function(e,t,a,r){var n,o;if(null==(n=r.specific_year)?void 0:n[e]){const n=x(null==(o=r.specific_year)?void 0:o[e],t,a);if(n)return{name:n.name,repeatOption:"once"}}if(r.every_year){const e=x(r.every_year,t,a);if(e)return{name:e.name,repeatOption:"repeat_yearly"}}}(y,e,t,c);H(e,t,y,a)}else if("dayoff"===s){const a=function(e,t,a,r){if(null==r?void 0:r[e]){const n=x(r[e],t,a);if(n)return{name:n.name}}}(y,e,t,m);H(e,t,y,a)}}function H(e,t,a,r){f.setFieldsValue({..."holiday"===s?O:P,year:a,dateOffRange:[e,t],...r}),j(r?"edit":"new"),T(!0),I()}return a.createElement(d.Provider,{value:{mode:s,year:y,weeklySchedule:i,holidaySchedule:c,dayOffSchedule:m,onClickCell:function(e){if("DateTo"===v.isSelecting&&v.selectedDateFrom){const t=e.isAfter(v.selectedDateFrom);W(t?v.selectedDateFrom:e,t?e:v.selectedDateFrom)}else"DateFrom"===v.isSelecting&&(!0===g?S(e):W(e,e))},onMouseEnterCell:function(e){"DateTo"===v.isSelecting&&N(e)}}},a.createElement("div",{className:"bw-mb-5 bw-flex bw-items-center bw-gap-2"},a.createElement(k,{decrement:()=>{p(y-1),I()},increment:()=>{p(y+1),I()}}),a.createElement(r.Checkbox,{className:"bw-h-3.5 bw-w-3.5",id:"selecting-range",checked:g,onCheckedChange:e=>h(!0===e)}),a.createElement(r.Label,{htmlFor:"selecting-range",className:"bw-cursor-pointer bw-text-sm bw-font-normal"},n.__("Day Range","bookster")),a.createElement(r.Button,{variant:"outline",className:"bw-ms-4 bw-border-gray-300 bw-font-medium bw-text-gray-800",onClick:()=>{y<M?H(o.dayjs(),o.dayjs(),M):H(o.dayjs().year(y),o.dayjs().year(y),y)}},a.createElement(l.Plus,{strokeWidth:"2",className:"bw-h-2.5 bw-w-2.5"}),"holiday"===s?n.__("New Holiday","bookster"):n.__("New Day Off","bookster"))),a.createElement(w,null),a.createElement("div",{className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] bw-gap-6"},F.map((e=>a.createElement(E,{key:e,month:e,isSelect:v.monthIsSelectCache[e],inSelect:v.monthInSelectCache[e]})))),a.createElement(r.Dialog,{open:R,onOpenChange:T},a.createElement(r.DialogPortalContent,{className:"bw-max-w-xl"},a.createElement(r.DialogCloseIcon,null),a.createElement(r.DialogHeader,null,a.createElement(r.DialogTitle,null,`${"new"===A?n.__("New","bookster"):n.__("Edit","bookster")} ${"dayoff"===s?n.__("Day Off","bookster"):n.__("Holiday","bookster")}`)),a.createElement(r.DialogBody,null,a.createElement(t.Form,{form:f,name:"holiday-form",layout:"vertical",initialValues:"holiday"===s?O:P,onFinish:e=>{b(e),T(!1)}},a.createElement(u,null))),a.createElement(r.DialogFooter,null,a.createElement(r.DialogClose,{asChild:!0},a.createElement(r.Button,{tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[6rem]"},n.__("Cancel","bookster"))),a.createElement(r.Button,{type:"submit",size:"large",form:"holiday-form",className:"bw-min-w-[6rem]"},n.__("Save","bookster"))))))}const N=o.dayjs(),F=c.range(12),M=N.year(),O={name:"Holiday",year:M,dateOffRange:[N,N],isDayOff:!0,repeatOption:"once"},P={name:"Day Off",year:M,dateOffRange:[N,N],isDayOff:!0},I=e.createContext(null);function R(){const t=e.useContext(I);if(!t)throw new Error("Missing WeeklyScheduleEditorContext.Provider in the tree");return t}function T({weekday:o}){const{formNamePrefix:i}=R(),c=t.Form.useFormInstance(),m=e.useCallback((()=>{const e=c.getFieldValue([...i]),t=e[o];s.forEach((a=>{if(a===o)return;const r=e[a];t.working===r.working&&c.setFieldValue([...i,a,"periods"],t.periods)}))}),[o,i,c]),d=e.useCallback((()=>{c.setFieldValue([...i,o,"working"],!1),c.setFieldValue([...i,o,"periods"],[])}),[o,i,c]);return a.createElement(r.DropdownMenu,null,a.createElement(r.DropdownMenuTrigger,{asChild:!0},a.createElement(r.Button,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation()},className:"bw-bg-gray-20 bw-text-gray-500 hover:bw-bg-gray-100 hover:bw-text-gray-900 focus:bw-bg-gray-100 focus:bw-text-gray-900 active:bw-bg-gray-100 active:bw-text-gray-900"},a.createElement(l.EllipsisVertical,{className:"bw-rotate-90 hover:bw-text-primary",onClick:e=>{e.stopPropagation()}}))),a.createElement(r.DropdownMenuContent,{align:"end"},a.createElement(r.DropdownMenuLabel,null,n.__("More Actions","bookster")),a.createElement(r.DropdownMenuSeparator,null),a.createElement(r.DropdownMenuGroup,{className:"bw-space-y-1.5 bw-p-1.5"},a.createElement(r.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),m()}},a.createElement(l.Calendar,null),a.createElement("span",{className:"bw-ml-2"},n.__("Apply to every day","bookster"))),a.createElement(r.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),d()}},a.createElement(l.Trash,null),a.createElement("span",{className:"bw-ml-2"},n.__("Delete all time period","bookster"))))))}function A({weekday:e}){const{formNamePrefix:r}=R(),n=t.Form.useFormInstance(),o=t.Form.useWatch([...r,e,"periods"],n),l=(null==o?void 0:o.filter((e=>e)))??[];return a.createElement(j,{periods:l})}function j({periods:e}){return a.createElement(a.Fragment,null,null==e?void 0:e.map((e=>{const t=`${e.start.hour.toString().padStart(2,"0")}:${e.start.minute.toString().padStart(2,"0")}`,r=`${e.end.hour.toString().padStart(2,"0")}:${e.end.minute.toString().padStart(2,"0")}`;return a.createElement(a.Fragment,{key:`${t}-${r}`},a.createElement("span",null,`${t}-${r}`),a.createElement("span",{className:"bw-px-2 bw-font-normal bw-text-gray-100 last:bw-hidden"},"//"))})))}function W({weekday:e,onChange:n}){const{formNamePrefix:o}=R();return a.createElement(t.Form.Item,{name:[...o,e,"working"],trigger:"onCheckedChange",valuePropName:"checked",noStyle:!0},a.createElement(r.Switch,{onCheckedChange:e=>{n(e)},onClick:e=>e.stopPropagation()}))}function H({weekday:o}){const{formNamePrefix:s,defaultActivePanelKeys:c}=R(),[m,d]=e.useState(!!c.includes(o)),b=t.Form.useFormInstance(),u=t.Form.useWatch([...s,o,"working"],b);return a.createElement(r.Collapsible,{onOpenChange:d,open:m},a.createElement(r.CollapsibleTrigger,{asChild:!0},a.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-gap-4 bw-py-5"},a.createElement(W,{weekday:o,onChange:e=>d(e)}),a.createElement("label",{className:r.cx("bw-me-auto bw-text-gray-900",!u&&"bw-text-gray-500")},$[o]),a.createElement("span",{className:"bw-text-xs bw-font-medium bw-uppercase bw-text-gray-500"},!u&&n.__("Day off","bookster"),u&&a.createElement(A,{weekday:o})),a.createElement(T,{weekday:o}))),a.createElement(r.CollapsibleContent,{forceMountWithAnimation:!0},a.createElement("div",{className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(15rem,1fr))] bw-gap-x-4 bw-pb-4"},a.createElement(t.Form.List,{name:[...s,o,"periods"],rules:[{validator:async(e,t)=>t?i.bookHelper.period.someOverlap(t.filter((e=>!!e)))?Promise.reject(new Error("Some Work Periods are overlapping")):void 0:Promise.resolve()}]},((e,{add:o,remove:s},{errors:c})=>a.createElement(a.Fragment,null,e.map((({key:e,name:n,...o})=>a.createElement("div",{key:e},a.createElement("div",{className:"bw-flex bw-items-start bw-gap-2"},a.createElement(t.Form.Item,{...o,name:n,className:"bw-flex-grow",rules:[{required:!0,message:"Please enter Work Period !"}]},a.createElement(r.BookTimeRangePicker,{className:"bw-w-full [&_.bant-picker-suffix]:bw-pointer-events-auto",size:"medium",placeholder:["Start Time","End Time"],suffixIcon:a.createElement(l.MinusCircle,{className:"bw-cursor-pointer bw-text-gray-500 hover:bw-text-error",onClick:()=>s(n)})})))))),a.createElement("div",null,a.createElement(t.Form.Item,null,a.createElement(r.Button,{variant:"ghost",className:"bw-rounded-sm bw-bg-gray-50 bw-text-xs bw-text-primary bw-transition-colors hover:bw-text-primary",onClick:()=>o({start:i.bookHelper.booktime.createFromHourMinute(9,0),end:i.bookHelper.booktime.createFromHourMinute(10,0)})},a.createElement(l.Plus,null),n.__("Add Work Period","bookster")),a.createElement(t.Form.ErrorList,{errors:c})))))))))}const $=o.dayjs().localeData().weekdays();function G({formNamePrefix:e,defaultActivePanelKeys:t}){return a.createElement(I.Provider,{value:{formNamePrefix:e,defaultActivePanelKeys:t}},a.createElement("div",{className:"bw-mx-auto bw-w-full bw-divide-y bw-divide-gray-100"},s.map((e=>a.createElement(H,{weekday:e,key:e})))))}export{S as H,G as W,d as a,k as b,E as c,j as d};
