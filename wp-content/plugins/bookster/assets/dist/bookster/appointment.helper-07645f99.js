import{_ as e,c as t,g as o,s as n,f as i}from"./prefetch.helper-04349684.js";import{c as s,_ as a}from"./createBookTimeInput.helper-ed47ae63.js";const r=e.styled.div("bw-mb-4 bw-ml-4 bw-py-2 bw-text-md bw-text-warning"),u=e=>{const n=t.bookHelper.booktime.createFromAbsMinute(e);return o.dayjs().hour(n.hour).minute(n.minute).format("HH:mm")},l=e=>{e||(e=window.booksterPublicData.scheduleSettings.weekly);const t=[];let o=null,n=null;return e.forEach(((e,i)=>{e.working&&e.periods.forEach((e=>{(null===o||e.start.absMinute<o)&&(o=e.start.absMinute),(null===n||e.end.absMinute>n)&&(n=e.end.absMinute),t.push({daysOfWeek:[i],startTime:u(e.start.absMinute),endTime:u(e.end.absMinute)})}))})),o=null===o?0:o,n=null===n?1440:n,{businessHours:t,slotMinAbs:o,slotMaxAbs:n}},_=l();function b(e){return e.utcOffset(o.USER_UTC_OFFSET,!0).toDate()}function d(e){return o._dayjs(e).utcOffset(o.WP_UTC_OFFSET,!0)}function c(e,t){let o;if(e.booking_details)o=a.parseDetails(e.booking_details);else{const n=a.makeBlueprintBookingVer1_0(t,e.total_amount);o=a.calculateDetails(n)}return{customer_id:e.customer_id,customer_note:e.customer_note,paid_amount:n.Decimal.fromString(e.paid_amount),payment_status:e.payment_status,booking_details:o}}function f(e){return{service_id:e.service_id,agent_ids:e.agent_ids,location_id:e.location_id,book_status:e.book_status,buffer_before:e.buffer_before,buffer_after:e.buffer_after,start_time:t.bookHelper.booktime.createFromAbsMinute(e.abs_min_start||0),end_time:t.bookHelper.booktime.createFromAbsMinute(e.abs_min_end||0),book_date:o.dayjs(e.datetime_start),bookings:e.bookings.map((t=>c(t,e.service)))}}function m(e){if(null===e.book_date||null===e.start_time||null===e.end_time)throw new Error("Invalid Appointment Values");const t=s(e.book_date,e.start_time,e.end_time,e.buffer_before||0,e.buffer_after||0);return{service_id:e.service_id,agent_ids:e.agent_ids,book_status:e.book_status,...t}}function k(e){return e.bookings.map((e=>{const t=function(e){if(null===e.booking||null===e.adjustment||null===e.tax)throw new Error("Invalid Details Values");return a.serializeDetails(e)}(e.booking_details),o=e.booking_details.tax.total||n.ZERO;return{customer_id:e.customer_id,customer_note:e.customer_note,booking_details:t,total_amount:o.toString(),paid_amount:e.paid_amount.toString(),payment_status:e.payment_status}}))}function g(e,n,i){const a=d(n),r=d(i),u=t.bookHelper.booktime.createFromDayjs(a),l=t.bookHelper.booktime.createFromDayjs(r),_=t.bookHelper.booktime.createFromAbsMinute(u.absMinute+e.buffer_before),b=t.bookHelper.booktime.createFromAbsMinute(l.absMinute-e.buffer_after),c=o.dayjs(a).startOf("day");return s(c,_,b,e.buffer_before,e.buffer_after)}const p={customer_id:null,booking_details:{booking:{items:[],subtotal:n.ZERO},adjustment:{items:[],subtotal:n.ZERO},tax:{items:[],total:n.ZERO}},paid_amount:n.ZERO,payment_status:"incomplete"},v={service_id:null,agent_ids:[],location_id:null,book_status:"pending",book_date:o.dayjs(),start_time:null,end_time:null,buffer_before:null,buffer_after:null,bookings:[p]};function h(e){return i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.initBookingValues,p,e)}function y(){return{...v,bookings:[h()]}}function M(e,t,o,n){const i={...e,...n};0===o.length?i.agent_ids=[]:1===o.length?i.agent_ids=[o[0].agent_id]:i.agent_ids&&-1===o.findIndex((e=>e.agent_id===i.agent_ids[0]))&&(i.agent_ids=[]);const s=t.flatMap((e=>e.services||[]));if(0===s.length?i.service_id=null:1===s.length?i.service_id=s[0].service_id:i.service_id&&-1===s.findIndex((e=>e.service_id===i.service_id))&&(i.service_id=null),i.service_id){const e=s.find((e=>e.service_id===i.service_id));if(e)for(const t of i.bookings)t.booking_details.booking.items=[a.makeBasicItem(e)]}return i}function w(e){const t={...e};for(const o of t.bookings)o.booking_details.booking.items.length>0&&(o.booking_details=a.calculateDetails(o.booking_details));return t}const E=(e,t)=>{for(const o of e)for(const e of o.services||[])if(e.service_id===t)return e;return null};export{r as R,_ as S,y as a,m as b,w as c,k as d,f as e,E as f,h as g,c as h,d as i,g as j,l as k,M as p,b as t};
