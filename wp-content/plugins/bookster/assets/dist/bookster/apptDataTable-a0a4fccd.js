import{R as e,_ as t,a,h as n,c as s,s as l,v as r,b as c,g as o,L as i,f as m}from"./prefetch.helper-04349684.js";import{l as p}from"./store-bdc614dc.js";function u({appt:n}){const s=n.agents;return e.createElement(e.Fragment,null,s.slice(0,1).map((n=>e.createElement("div",{key:n.agent_id,className:"bw-flex bw-items-center bw-gap-1.5"},e.createElement(t.Avatar,{className:"bw-h-[30px] bw-w-[30px]"},e.createElement(t.AvatarImage,{src:n.transient_avatar_url}),e.createElement(t.AvatarFallback,{className:"bw-text-xs"},e.createElement(a.User,{className:"bw-h-3 bw-w-3"}))),n.first_name," ",n.last_name))),s.length>1&&e.createElement("span",null,"+",s.length-1))}function d({appt:l,queryClient:r}){const c=l.book_status,o=n(c),{toast:i}=t.useToast(),m=s.useMutation({mutationKey:["appointments",l.appointment_id,"updateStatus"],mutationFn:({id:e,status:t})=>p(e,t),onSuccess:e=>{r.invalidateQueries({queryKey:["appointment",{id:e.appointment_id}]}),r.invalidateQueries({queryKey:["appointments"]})}});return e.createElement(t.Select,{value:c,onValueChange:async function(e){if(!m.isLoading)try{await m.mutateAsync({id:l.appointment_id,status:e}),i.success("Appointment has been Saved Successfully!")}catch(t){i.error(await s.getErrorMsg(t))}}},e.createElement(t.Tooltip,{content:o,side:"left"},e.createElement(t.SelectTrigger,{size:"medium",className:"bw-w-[60px] bw-ps-2.5 hover:bw-border-gray-100 focus:bw-border-gray-100 [&>span]:bw-justify-start",withStatus:!1,onClick:e=>{e.stopPropagation()}},m.isLoading?e.createElement(a.Loader2,{className:"bw-h-3.5 bw-w-3.5 bw-animate-spin bw-text-gray-500"}):e.createElement(e.Fragment,null,"pending"===c&&e.createElement(a.Pending,{className:"bw-h-3.5 bw-w-3.5 bw-text-warning"}),"approved"===c&&e.createElement(a.CheckCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-success"}),"canceled"===c&&e.createElement(a.XCircle,{className:"bw-h-3.5 bw-w-3.5 bw-text-error"})))),e.createElement(t.SelectContent,{align:"end"},e.createElement(t.SelectGroup,null,e.createElement(t.SelectItem,{className:"[&>span]:bw-justify-start",value:"pending"},e.createElement(a.Pending,{className:"bw-text-warning"})," ",n("pending")),e.createElement(t.SelectItem,{className:"[&>span]:bw-justify-start",value:"approved"},e.createElement(a.CheckCircle,{className:"bw-text-success"})," ",n("approved")),e.createElement(t.SelectItem,{className:"[&>span]:bw-justify-start",value:"canceled"},e.createElement(a.XCircle,{className:"bw-text-error"})," ",n("canceled")))))}function b({appt:n}){const s=n.bookings;return e.createElement(e.Fragment,null,s.slice(0,1).map((n=>{const s=n.customer;return e.createElement("div",{key:s.customer_id,className:"bw-flex bw-items-center bw-gap-1.5"},e.createElement(t.Avatar,{className:"bw-flex bw-h-[30px] bw-w-[30px] bw-items-center"},e.createElement(t.AvatarImage,{src:s.transient_avatar_url}),e.createElement(t.AvatarFallback,{className:"bw-text-xs"},e.createElement(a.User,{className:"bw-h-3 bw-w-3"}))),s.first_name," ",s.last_name)})),s.length>1&&e.createElement("span",null,"+",s.length-1))}function w(e){if(0===e.length)return{status:"unpaid",total:l.ZERO};let t=l.ZERO,a=l.ZERO,n=l.ZERO,s="refunded";for(const r of e)"refunded"!==r.payment_status?(t=t.add(l.Decimal.fromString(r.total_amount)),a=a.add(l.Decimal.fromString(r.paid_amount))):n=n.add(l.Decimal.fromString(r.total_amount)),"refunded"===s&&"refunded"!==r.payment_status?s=r.payment_status:("unpaid"!==s||"complete"!==r.payment_status&&"incomplete"!==r.payment_status)&&("complete"!==s||"unpaid"!==r.payment_status&&"incomplete"!==r.payment_status)||(s="incomplete");return"refunded"===s?{status:s,total:n}:"unpaid"===s||"complete"===s?{status:s,total:t}:{status:s,total:t,paid:a}}function g({appt:a}){const n=w(a.bookings),l=r(n.status),o=function(e){switch(e){case"unpaid":return"error";case"refunded":return"dark";case"complete":default:return"success";case"incomplete":return"warning"}}(n.status);return"incomplete"!==n.status?e.createElement(t.Badge,{variant:"outline",color:o,size:"large",className:"bw-w-[90px] bw-justify-center"},l):e.createElement(t.TooltipRoot,null,e.createElement(t.TooltipTrigger,{asChild:!0},e.createElement(t.Badge,{variant:"outline",color:o,size:"large",className:"bw-w-[90px] bw-justify-center"},l)),e.createElement(t.TooltipPortalContent,{side:"bottom",className:"bw-min-w-44 bw-px-4 bw-py-2.5 bw-text-sm bw-leading-none"},e.createElement(t.TooltipArrow,null),e.createElement("div",{className:"bw-space-y-2"},e.createElement("p",{className:"bw-flex bw-justify-between"},e.createElement("span",{className:"bw-text-gray-100/50"},c.__("Total","bookster"),":"),e.createElement("span",{className:""},s.formatPrice(n.total))),e.createElement("p",{className:"bw-flex bw-justify-between"},e.createElement("span",{className:"bw-text-gray-100/50"},c.__("Paid","bookster"),":"),e.createElement("span",null,s.formatPrice(n.paid)))),e.createElement(t.Separator,{className:"bw-my-3 bw-bg-gray-100/50"}),e.createElement("p",{className:"bw-flex bw-justify-between bw-text-sm"},e.createElement("span",null,c.__("Due","bookster"),":"),e.createElement("span",null,s.formatPrice(n.total.subtract(n.paid))))))}const E=s.createColumnHelper(),f=E.display({id:"select",size:56,header:({table:a})=>e.createElement(t.TableCheckboxWrapper,null,e.createElement(t.Checkbox,{checked:a.getIsAllRowsSelected(),onClick:a.getToggleAllPageRowsSelectedHandler()})),cell:({row:a})=>e.createElement(t.TableCheckboxWrapper,null,e.createElement(t.Checkbox,{checked:a.getIsSelected(),onClick:a.getToggleSelectedHandler()}))}),y=E.display({id:"actions",size:40,header:"",cell:()=>e.createElement(t.TableActionWrapper,null,e.createElement(t.TableActionLink,null))}),_=E.accessor("appointment_id",{id:"appointment_id",size:80,header:c.__("ID","bookster"),cell:({getValue:e})=>`#${e().toString().padStart(5,"0")}`}),h=E.accessor("datetime_start",{id:"book_time",size:180,header:c.__("Date / Time","bookster"),cell:({getValue:t})=>{const a=t();return e.createElement(e.Fragment,null,o.dayjs(a).format(s.DATE_TEMPLATE),e.createElement("span",{className:"bw-px-2 bw-text-gray-500/30"},"â€¢"),o.dayjs(a).format(s.TIME_TEMPLATE))}}),x=E.accessor("service.name",{id:"service",header:i.service}),k=E.display({id:"customer",header:i.customer,cell:({row:t})=>e.createElement(b,{appt:t.original})}),N=E.display({id:"agent",header:i.agent,cell:({row:t})=>e.createElement(u,{appt:t.original})}),v=E.accessor("book_status",{id:"status",size:60,header:c.__("Status","bookster"),cell:({getValue:t,row:a,table:n})=>{const s=n.options.meta;return(null==s?void 0:s.queryClient)?e.createElement(d,{appt:a.original,queryClient:s.queryClient}):t()}}),S=E.display({id:"payment",header:c.__("Payment","bookster"),cell:({row:t})=>e.createElement(g,{appt:t.original})}),C=E.display({id:"total",header:c.__("Total","bookster"),cell:({row:e})=>{const t=w(e.original.bookings);return s.formatPrice(t.total)}}),T=[f,_,h,x,k,N,v,S,C,y];function A(){return m.booksterHooks.applyFilters(m.HOOK_NAMES.managerApptList.apptColumnDefs,T)}export{y as a,h as b,x as c,k as d,A as g,_ as i,S as p,f as s,C as t};
