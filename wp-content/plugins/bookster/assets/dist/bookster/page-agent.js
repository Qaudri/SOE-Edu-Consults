import{u as e,b as t,L as a,c as n,r,_ as o,R as l,g as s,j as i,a as m,f as p,d as u,p as c,i as d}from"./prefetch.helper-04349684.js";import{u as b,c as E,g as _,i as g,d as f,e as h,b as w,f as y,a as A,C as v,B as k}from"./BEConfigProvider-705eafe2.js";import{g as S,S as D,a as F,A as N,s as C,h as P,C as M,i as I,j as O,k as R,m as j,n as T,P as x,o as L,p as G,f as H,N as B,q as $,_ as K,r as V}from"./useCacheCustomers-102bfcf8.js";import{B as Q}from"./BackendRouteErrorElement-6f34d3c9.js";import{l as q}from"./lodash-f550b173.js";import{_ as Y}from"./createBookTimeInput.helper-ed47ae63.js";import{a as z,e as U,b as J,d as W}from"./appointment.helper-07645f99.js";function X(){const n=e((e=>e.agentRecord));if(!n)throw new Error(t.sprintf(t.__("Sorry, Your %(agent)s Record is Not Existed.","bookster"),a));return n}async function Z(e,t){return await n.api.patch(`as-agent/${e}/appointments/query`,{json:t}).json()}async function ee(e){return await n.api.patch(`as-agent/${e}/appointments/counter`).json()}async function te(e,t,a){const r=re(a);return await n.api.patch(`as-agent/${e}/appointments/${t}`,{json:r}).json()}async function ae(e,t,a){return te(e,t,{book_status:a})}async function ne(e,t,a){return await n.api.patch(`as-agent/${e}/appointments/bulk-action`,{json:{ids:t,values:a}}).json()}function re(e){return q.pick(e,["book_status","staff_note","datetime_start","datetime_end","abs_min_start","abs_min_end","buffer_before","buffer_after","busy_abs_min_start","busy_abs_min_end","busy_datetime_start","busy_datetime_end"])}function oe(){const[e,t]=r.useState("#"),[a,s]=r.useState(!1),{agent_id:i}=X(),m=o.useDebounce(e,{wait:500}),p=S(m),u="appointment"===(null==p?void 0:p.type)?p.search:null,{data:c,isLoading:d}=n.useQuery({queryKey:["appointment",u],queryFn:async()=>{if(!u)return null;try{return await async function(e,t){return await n.api.get(`as-agent/${e}/appointments/${t}`).json()}(i,u)}catch(e){if(e instanceof n.HTTPError&&404===e.response.status)return null;throw e}}}),E=n.useQueryClient(),_=b(),g=d;return l.createElement(D.Provider,{value:{search:e,isOpenModal:a,isLoading:g,setSearch:t,setIsOpenModal:s,clickAppointment:async e=>{_(`/appointments/${e.appointment_id}`),E.setQueryData(["appointment",e.appointment_id],e),s(!1)}}},l.createElement(o.Dialog,{open:a,onOpenChange:s},l.createElement(o.DialogTrigger,{asChild:!0},l.createElement(F,null)),l.createElement(o.DialogPortalContent,{className:"bw-top-[20%] bw-flex bw-max-h-[60vh] bw-max-w-2xl bw-translate-y-0 bw-flex-col bw-overflow-auto bw-p-0"},l.createElement(o.CommandInDialog,{className:"bw-max-h-full [&_[cmdk-group-heading]]:bw-text-base [&_[cmdk-group-heading]]:bw-font-semibold [&_[cmdk-item]]:bw-px-5 [&_[cmdk-item]]:bw-py-1.5",loop:!0,shouldFilter:!1},l.createElement(o.CommandInput,{placeholder:"Enter Appointment ID, e.g. #1234",className:"bw-h-14 bw-rounded-none bw-px-4 [&>input]:bw-ps-9 [&>input]:bw-text-base",value:e,onValueChange:t,isFetching:g}),l.createElement(o.LoadingOverlay,{loading:g}),l.createElement(o.CommandList,{className:"bw-py-2"},u&&l.createElement(N,{appt:c}),(null===p||"record"===p.type)&&l.createElement(C,null))))))}const le=t=>({profile:{isLoading:!1},saveAgentProfile:async(a,r)=>{try{t((e=>{e.profile.isLoading=!0}));const o=await n.api.patch(`as-agent/${a}/profile`,{json:r}).json();e.getState().updateAgentRecord(o)}finally{t((e=>{e.profile.isLoading=!1}))}},saveAgentSetting:async(a,r)=>{try{t((e=>{e.profile.isLoading=!0}));const o=await n.api.patch(`as-agent/${a}/schedule`,{json:r}).json();e.getState().updateAgentRecord(o)}finally{t((e=>{e.profile.isLoading=!1}))}}});let se;function ie(e,t){return se||(se=n.createStore()(n.immer(n.devtools(((...e)=>{const t=s.dayjs(),a=t.add(1,"day"),n=t.utc(!0).startOf("day").toDate(),r=a.utc(!0).startOf("day").toDate(),o=_().calendarViewAgent,l=i(o),m=h(l),p=(u={intervalRange:_().dashboardIntervalRange,dayPreview:{title:t.format("MMMM D, YYYY"),activeStart:n,activeEnd:r}},(e,t)=>({agentDashboard:u,agentDashboardSetIntervalRange(t){e((e=>{e.agentDashboard.intervalRange=t})),E({dashboardIntervalRange:t})},agentDashboardDayPreviewRefresh(t){e((e=>{e.agentDashboard.dayPreview.title=t.view.title,e.agentDashboard.dayPreview.activeStart=t.view.activeStart,e.agentDashboard.dayPreview.activeEnd=t.view.activeEnd}))},agentDashboardDayPreviewNext(e){e.next(),t().agentDashboardDayPreviewRefresh(e)},agentDashboardDayPreviewPrev(e){e.prev(),t().agentDashboardDayPreviewRefresh(e)},agentDashboardDayPreviewToday(e){e.today(),t().agentDashboardDayPreviewRefresh(e)}}));var u;const c=g({hidden:_().columnsForAgent.hidden,order:f()});return{...p(...e),...m(...e),...c(...e),...le(...e)}}))))),n.useStore(se,e,t)}function me(){return ie((e=>e.initAppointmentForm)),b(),X(),null}function pe(){return l.createElement(n.Routes,null,l.createElement(n.Route,{path:"/dashboard/*",element:l.createElement(me,null)}),l.createElement(n.Route,{path:"/calendar/*",element:l.createElement(me,null)}),l.createElement(n.Route,{path:"/appointments/*",element:l.createElement(me,null)}),l.createElement(n.Route,{path:"*",element:null}))}function ue(){return l.createElement(l.Fragment,null,l.createElement(o.SidebarGroup,null,l.createElement(o.SidebarGroupLabel,{className:"bw-mt-4 group-data-[collapsible=icon]:bw-mt-0"},t.__("Management","bookster")),l.createElement(o.SidebarGroupContent,null,l.createElement(o.SidebarMenu,null,l.createElement(P,{to:"/dashboard",tooltip:t.__("Dashboard","bookster")},l.createElement(m.House,null),l.createElement("span",null,t.__("Dashboard","bookster"))),l.createElement(P,{to:"/calendar",tooltip:t.__("Calendar","bookster")},l.createElement(m.Calendar,null),l.createElement("span",null,t.__("Calendar","bookster")))))),l.createElement(o.SidebarSeparator,{className:"bw-mt-6 bw-bg-transparent group-data-[collapsible=icon]:bw-mt-3 group-data-[collapsible=icon]:bw-bg-sidebar-border"}),l.createElement(o.SidebarGroup,null,l.createElement(o.SidebarGroupLabel,null,t.__("Records","bookster")),l.createElement(o.SidebarGroupContent,null,l.createElement(o.SidebarMenu,null,l.createElement(P,{to:{pathname:"/appointments",search:`?date-from=${ce.format(s.DAY_KEY_FORMAT)}&date-to=${de.format(s.DAY_KEY_FORMAT)}`}},l.createElement(m.ListCheck,null),l.createElement("span",null,t.__("Appointments","bookster")))))),l.createElement(o.SidebarSeparator,{className:"bw-mt-6 bw-bg-transparent group-data-[collapsible=icon]:bw-mt-3 group-data-[collapsible=icon]:bw-bg-sidebar-border"}),l.createElement(o.SidebarGroup,null,l.createElement(o.SidebarGroupLabel,null,t.__("Administration","bookster")),l.createElement(o.SidebarGroupContent,null,l.createElement(o.SidebarMenu,null,w(M.MANAGE_AGENT_PROFILE_CAP)&&l.createElement(P,{to:"/profile",tooltip:t.__("Profile","bookster")},l.createElement(m.User,null),l.createElement("span",null,t.__("Profile","bookster"))),w(M.MANAGE_AGENT_SETTINGS_CAP)&&l.createElement(I,null,l.createElement(O,{to:"/settings"},l.createElement(m.Bolt,null),l.createElement("span",null,t.__("Settings","bookster"))),l.createElement(R,null,l.createElement(j,{to:"/settings/schedule"},t.__("Schedule","bookster")),l.createElement(j,{to:"/settings/daysoff"},t.__("Days Off","bookster")),p.booksterHooks.applyFilters(p.HOOK_NAMES.layout.AgentMenuSubItems_+"settings",[])))))))}const ce=s.dayjs(),de=ce.add(7,"day");function be(){const{transient_avatar_url:e}=X();return l.createElement(T,{userInfo:l.createElement(x,{avatarSrc:e}),sideMenu:l.createElement(ue,null),headerButtons:l.createElement(pe,null),searchGlobal:l.createElement(oe,null)},l.createElement(n.Outlet,null),l.createElement(o.Toaster,null))}function Ee(){const e=ie((e=>e.resetAppointmentForm)),{agent_id:a}=X(),s=L(),{selectedAppt:i}=function(e,t){const{data:a}=n.useQuery({queryKey:["appointment",t],enabled:!1}),o=n.useQuery({queryKey:["appointment",t,"details"],queryFn:()=>t?async function(e,t){return await n.api.get(`as-agent/${e}/appointments/${t}/details`).json()}(e,t):null,staleTime:0});return{selectedAppt:r.useMemo((()=>{var e;if(!t)return null;if(!(null==(e=o.data)?void 0:e.appointment))return a||null;const n=o.data.appointment;return n.appointment_id===(null==a?void 0:a.appointment_id)&&n.updated_at===(null==a?void 0:a.updated_at)?a:o.data.appointment}),[t,a,o.data]),detailsQuery:o}}(a,s),{toast:m}=o.useToast(),c=b(),d=n.useQueryClient(),E=n.useMutation({mutationKey:["appointments",s,"edit"],mutationFn:({agent_id:e,appt_id:t,values:a})=>async function(e,t,a){const r=re(a.apptInput);return await n.api.patch(`as-agent/${e}/appointments/${t}/bookings`,{json:{...a,apptInput:r}}).json()}(e,t,a),onSuccess:e=>{d.setQueryData(["appointment",s],e),d.removeQueries(["appointment",s,"details"]),d.invalidateQueries({queryKey:["appointments"]})}}),[_]=u.Form.useForm(),g=r.useMemo((()=>{let e=z();return i&&(e=U(i)),p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.initFormValues,e,i)}),[i]);o.useUpdateEffect((()=>{_.resetFields(),w(["close"]),k(["close"]),i&&_.setFieldsValue(g)}),[i]),G(i);const f=!i||E.isLoading,[h,w]=r.useState(["close"]),[v,k]=r.useState(["close"]);return l.createElement(Y.ApptFormContext.Provider,{value:{editMode:"edit",roleMode:y.writeAppt?"agent":"disabled",apptForm:_,initialValues:g,nestedCustomer:h,setNestedCustomer:w,nestedBooking:v,setNestedBooking:k}},l.createElement(o.DrawerHeader,null,l.createElement(o.DrawerTitle,null,t.__("Edit Appointment","bookster"),"Â ",l.createElement(o.Badge,{color:"base",variant:"fill",className:"bw-font-medium bw-tracking-wide"},`#${s}`)),l.createElement(o.DrawerCloseIcon,null)),l.createElement(A,{className:"bw-py-0"},l.createElement(o.LoadingOverlay,{loading:f}),l.createElement(u.Form,{className:"bw-flex bw-h-full bw-min-h-full bw-flex-col",name:"apptForm",form:_,initialValues:g,layout:"vertical",scrollToFirstError:!0,onFinish:async function(t){if(i)try{let n=J(t);n=p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.prepareApptInput,n,t);let r=W(t);r=p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.prepareBookingsInput,r,t),await E.mutateAsync({agent_id:a,appt_id:i.appointment_id,values:{apptInput:n,bookingsInput:r}}),m.success("Appointment has been Saved Successfully!"),c(".."),e()}catch(r){m.error(await n.getErrorMsg(r))}}},l.createElement(H,null))),l.createElement(o.DrawerFooter,null,l.createElement(o.DrawerClose,{asChild:!0},l.createElement(o.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},t.__("Cancel","bookster"))),l.createElement(o.Button,{key:"submit",type:"submit",form:"apptForm",disabled:!y.writeAppt||f,size:"large",className:"bw-min-w-[7rem]"},t.__("Save","bookster"))),l.createElement(B,null))}function _e(){const{presetValues:e}=ie((e=>e.appointments.form)),a=ie((e=>e.resetAppointmentForm)),{agent_id:s}=X(),{toast:i}=o.useToast(),m=b(),c=n.useQueryClient(),d=n.useMutation({mutationKey:["appointments","new"],mutationFn:({agent_id:e,values:t})=>async function(e,t){return await n.api.post(`as-agent/${e}/appointments`,{json:t}).json()}(e,t),onSuccess:e=>{c.setQueryData(["appointment",e.appointment_id],e),c.removeQueries(["appointment",e.appointment_id,"details"]),c.invalidateQueries({queryKey:["appointments"]})}}),[E]=u.Form.useForm(),_=r.useMemo((()=>{let t=z();return e&&(t={...t,...e}),t.agent_ids=[s],p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.initFormValues,t,null)}),[]),[g,f]=r.useState(["close"]),[h,w]=r.useState(["close"]);return l.createElement(Y.ApptFormContext.Provider,{value:{editMode:"new",roleMode:y.writeAppt?"agent":"manager",apptForm:E,initialValues:_,nestedCustomer:g,setNestedCustomer:f,nestedBooking:h,setNestedBooking:w}},l.createElement(o.DrawerHeader,null,l.createElement(o.DrawerTitle,null,t.__("New Appointment","bookster")),l.createElement(o.DrawerCloseIcon,null)),l.createElement(A,{className:"bw-py-0"},l.createElement(o.LoadingOverlay,{loading:d.isLoading}),l.createElement(u.Form,{className:"bw-flex bw-h-full bw-min-h-full bw-flex-col",name:"apptForm",form:E,initialValues:_,layout:"vertical",scrollToFirstError:!0,onFinish:async function(e){try{let t=J(e);t=p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.prepareApptInput,t,e);let n=W(e);n=p.booksterHooks.applyFilters(p.HOOK_NAMES.adminApptForm.prepareBookingsInput,n,e),await d.mutateAsync({agent_id:s,values:{apptInput:t,bookingsInput:n}}),i.success("Appointment has been Saved Successfully!"),m(".."),a()}catch(t){i.error(await n.getErrorMsg(t))}}},l.createElement(H,null))),l.createElement(o.DrawerFooter,null,l.createElement(o.DrawerClose,{asChild:!0},l.createElement(o.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},t.__("Cancel","bookster"))),l.createElement(o.Button,{key:"submit",type:"submit",form:"apptForm",disabled:!y.writeAppt||d.isLoading,size:"large",className:"bw-min-w-[7rem]"},t.__("Save","bookster"))),l.createElement(B,null))}const ge=$((()=>K((()=>import("./AgentDashboardPage-fba77946.js")),["AgentDashboardPage-fba77946.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","AgentAppointmentFormDrawer-da983b4b.js","BEConfigProvider-705eafe2.js","CalendarContent-e50ff6c3.js","react-dom-3e43fe1d.js","appointment.helper-07645f99.js","createBookTimeInput.helper-ed47ae63.js","main-6566bc29.js","useAgentAppointmentEvents-802c31ca.js","queue.helper-cc60359e.js","CalendarNav.styled-cb1aebbc.js","ReloadButton-117ef334.js","StatsRate-10303d5b.js","useCacheCustomers-102bfcf8.js","BackendRouteErrorElement-6f34d3c9.js","lodash-f550b173.js"]))),fe=$((()=>K((()=>import("./AgentCalendarPage-e89abc8f.js")),["AgentCalendarPage-e89abc8f.js","prefetch.helper-04349684.js","CalendarContent-e50ff6c3.js","react-dom-3e43fe1d.js","appointment.helper-07645f99.js","createBookTimeInput.helper-ed47ae63.js","UIComponents-7ff4460b.js","AgentAppointmentFormDrawer-da983b4b.js","BEConfigProvider-705eafe2.js","main-70b6d0e7.js","queue.helper-cc60359e.js","useAgentAppointmentEvents-802c31ca.js","ApptsFilterService-c1f460fc.js","useCacheCustomers-102bfcf8.js","CalendarNav.styled-cb1aebbc.js","ReloadButton-117ef334.js","BackendRouteErrorElement-6f34d3c9.js","lodash-f550b173.js"]))),he=$((()=>K((()=>import("./AgentAppointmentsPage-7e79f264.js")),["AgentAppointmentsPage-7e79f264.js","prefetch.helper-04349684.js","ApptsFilterService-c1f460fc.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","BEConfigProvider-705eafe2.js","appointment.helper-07645f99.js","ReloadButton-f13d4c5e.js","store-bdc614dc.js","apptDataTable-a0a4fccd.js","ReloadButton-117ef334.js","CalendarNav.styled-cb1aebbc.js","UIComponents-7ff4460b.js","AgentAppointmentFormDrawer-da983b4b.js","BackendRouteErrorElement-6f34d3c9.js","lodash-f550b173.js"]))),we=$((()=>K((()=>import("./AgentProfilePage-8bd8f17d.js")),["AgentProfilePage-8bd8f17d.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","BEConfigProvider-705eafe2.js","appointment.helper-07645f99.js","Settings.styled-aa4d422d.js","phoneInput.helper-806287af.js","lodash-f550b173.js","BackendRouteErrorElement-6f34d3c9.js"]))),ye=$((()=>K((()=>import("./AgentSettingsPage-065611db.js")),["AgentSettingsPage-065611db.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","BEConfigProvider-705eafe2.js","AgentScheduleTab-5fda5591.js","WeeklyScheduleEditor-9e383627.js","lodash-f550b173.js","CalendarNav.styled-cb1aebbc.js","Settings.styled-aa4d422d.js","agentSchedule.helper-648c495b.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","appointment.helper-07645f99.js","BackendRouteErrorElement-6f34d3c9.js"])));var Ae;c(),d.createRoot(document.getElementById("bookster-app-agent")).render(l.createElement(l.StrictMode,null,l.createElement(k,null,l.createElement(n.RouterProvider,{router:n.createHashRouter([{path:"*",element:l.createElement(be,null),errorElement:l.createElement(Q,null),children:(Ae=[{index:!0,loader:()=>{if(w(M.MANAGE_AGENT_RECORDS_CAP))return n.redirect("/dashboard");if(w(M.MANAGE_AGENT_PROFILE_CAP))return n.redirect("/profile");if(w(M.MANAGE_AGENT_SETTINGS_CAP))return n.redirect("/settings/general");throw new Error("Sorry You don't Have Permission to Access this Page.")}},{path:"dashboard",element:l.createElement(ge,null),children:[{index:!0,element:l.createElement(v,null)},{path:"new",element:l.createElement(_e,null)},{path:":apptId",element:l.createElement(Ee,null)}]},{path:"calendar",element:l.createElement(fe,null),children:[{index:!0,element:l.createElement(v,null)},{path:"new",element:l.createElement(_e,null)},{path:":apptId",element:l.createElement(Ee,null)}]},{path:"appointments",element:l.createElement(he,null),children:[{index:!0,element:l.createElement(v,null)},{path:"new",element:l.createElement(_e,null)},{path:":apptId",element:l.createElement(Ee,null)}]},{path:"profile",element:l.createElement(we,null)},{path:"settings",children:[{index:!0,loader:()=>n.redirect("/settings/schedule")},{path:":tabId/*",element:l.createElement(ye,null)}]},{path:"*",element:l.createElement(V,null)}],p.booksterHooks.applyFilters(p.HOOK_NAMES.router.agentRouter,Ae))}])}))));export{X as a,te as b,ae as c,ne as d,ee as e,Z as q,ie as u};
