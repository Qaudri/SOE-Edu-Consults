import{R as e,_ as t,L as a,a as n,b as r,c as l,r as s,d as o,e as m,f as i,g as c,h as u,p,i as d}from"./prefetch.helper-04349684.js";import{u as E,H as _,C as b,a as w,b as g,B as y}from"./BEConfigProvider-705eafe2.js";import{u as k,g as h,S as v,a as f,A as F,M as A,b as N,l as C,c as S,d as M,v as I,e as D,f as O,N as P,h as L,i as H,j as x,k as T,m as K,n as R,P as B,o as V,p as Q,q,_ as j,C as $,r as z}from"./useCacheCustomers-102bfcf8.js";import{B as G}from"./BackendRouteErrorElement-6f34d3c9.js";import{q as U,a as W,C as Y}from"./CoverPicker-52693ec5.js";import{g as J,c as X,a as Z,u as ee,d as te,r as ae,b as ne,e as re}from"./store-bdc614dc.js";import{R as le,g as se,a as oe,p as me,c as ie,b as ce,d as ue,e as pe}from"./appointment.helper-07645f99.js";import{_ as de}from"./createBookTimeInput.helper-ed47ae63.js";import{v as Ee}from"./phoneInput.helper-806287af.js";function _e({icon:t,title:a,description:n,...r}){return e.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-gap-4 bw-rounded bw-py-2",...r},t,e.createElement("div",null,e.createElement("h5",{className:"bw-mb-1"},a),e.createElement("span",{className:"bw-text-sm bw-text-gray-500"},n)))}function be({agents:l}){const{clickAgent:s}=k();return e.createElement(t.CommandGroup,{key:"agent_results",heading:a.agents},(null==l?void 0:l.total)?e.createElement("div",null,l.data.map((a=>e.createElement(t.CommandItem,{key:a.agent_id,value:`agent_${a.agent_id}`,keywords:[a.first_name,a.last_name,a.email,a.phone],onSelect:()=>s&&s(a)},e.createElement(_e,{title:`${a.first_name} ${a.last_name}`,description:`Email: ${a.email}, Phone: ${a.phone}`,icon:e.createElement(t.Avatar,null,e.createElement(t.AvatarImage,{src:a.transient_avatar_url}),e.createElement(t.AvatarFallback,null,e.createElement(n.User,null)))}))))):e.createElement(le,null,r.sprintf(r.__("No Matched %(agent)s found!","bookster"),a)))}function we({customers:l}){const{clickCustomer:s}=k();return e.createElement(t.CommandGroup,{key:"customer_results",heading:"Customers"},(null==l?void 0:l.total)?e.createElement("div",null,l.data.map((a=>e.createElement(t.CommandItem,{key:a.customer_id,value:`customer_${a.customer_id}`,keywords:[a.first_name,a.last_name,a.email,a.phone],onSelect:()=>s&&s(a)},e.createElement(_e,{key:a.customer_id,title:`${a.first_name} ${a.last_name}`,description:`Email: ${a.email}, Phone: ${a.phone}`,icon:e.createElement(t.Avatar,null,e.createElement(t.AvatarImage,{src:a.transient_avatar_url}),e.createElement(t.AvatarFallback,null,e.createElement(n.User,null)))}))))):e.createElement(le,null,r.sprintf(r.__("No Matched %(customer)s found!","bookster"),a)))}function ge({services:s}){const{clickService:o}=k();return e.createElement(t.CommandGroup,{key:"service_results",heading:a.services},(null==s?void 0:s.total)?e.createElement("div",null,s.data.map((a=>e.createElement(t.CommandItem,{key:a.service_id,value:`${a.service_id}`,keywords:[a.name],onSelect:()=>o&&o(a)},e.createElement(_e,{key:a.service_id,title:`${a.name}`,description:`${l.formatPrice(a.price)} per ${a.duration} minutes`,icon:e.createElement(t.Avatar,null,e.createElement(t.AvatarImage,{src:a.transient_cover_url}),e.createElement(t.AvatarFallback,null,e.createElement(n.User,null)))}))))):e.createElement(le,null,r.sprintf(r.__("No Matched %(service)s found!","bookster"),a)))}function ye(){const[a,n]=s.useState("#"),[r,o]=s.useState(!1),m=l.useQueryClient(),i=E(),c=t.useDebounce(a,{wait:500}),u=h(c),p={limit:3,keywords:c},d="appointment"===(null==u?void 0:u.type)?u.search:null,{data:_,isLoading:b}=l.useQuery({queryKey:["appointment",d],queryFn:async()=>{if(!d)return null;try{return await J(d)}catch(e){if(e instanceof l.HTTPError&&404===e.response.status)return null;throw e}}}),w="record"===(null==u?void 0:u.type)?u.search:null,{data:g,isLoading:y}=l.useQuery({queryKey:["agents",w],queryFn:()=>w?U(p):null}),{data:k,isLoading:N}=l.useQuery({queryKey:["customers",w],queryFn:()=>w?l.queryCustomers(p):null}),{data:C,isLoading:S}=l.useQuery({queryKey:["services",w],queryFn:()=>w?W(p):null}),M=b||y||N||S;return e.createElement(v.Provider,{value:{search:a,isOpenModal:r,isLoading:M,setSearch:n,setIsOpenModal:o,clickAppointment:async e=>{i(`/appointments/${e.appointment_id}`),m.setQueryData(["appointment",e.appointment_id],e),o(!1)},clickAgent:async e=>{i(`/agents/${e.agent_id}`),m.setQueryData(["agent",e.agent_id],e),o(!1)},clickCustomer:async e=>{i(`/customers/${e.customer_id}`),m.setQueryData(["customer",e.customer_id],e),o(!1)},clickService:async e=>{i(`/services/${e.service_id}`),m.setQueryData(["service",e.service_id],e),o(!1)}}},e.createElement(t.Dialog,{open:r,onOpenChange:o},e.createElement(t.DialogTrigger,{asChild:!0},e.createElement(f,null)),e.createElement(t.DialogPortalContent,{className:"bw-top-[20%] bw-flex bw-max-h-[60vh] bw-max-w-2xl bw-translate-y-0 bw-flex-col bw-overflow-auto bw-p-0"},e.createElement(t.CommandInDialog,{className:"bw-max-h-full [&_[cmdk-group-heading]]:bw-text-base [&_[cmdk-group-heading]]:bw-font-semibold [&_[cmdk-item]]:bw-px-5 [&_[cmdk-item]]:bw-py-1.5",loop:!0,shouldFilter:!1},e.createElement(t.CommandInput,{placeholder:"Enter Appointment ID, e.g. #1234",className:"bw-h-14 bw-rounded-none bw-px-4 [&>input]:bw-ps-9 [&>input]:bw-text-base",value:a,onValueChange:n,isFetching:M}),e.createElement(t.LoadingOverlay,{loading:M}),e.createElement(t.CommandList,{className:"bw-py-2"},d&&e.createElement(F,{appt:_}),w&&e.createElement("div",null,e.createElement(be,{agents:g}),e.createElement(we,{customers:k}),e.createElement(ge,{services:C})),null===u&&e.createElement(A,null))))))}function ke(){const a=E();return e.createElement(t.Button,{size:"large",onClick:()=>{a("new")}},e.createElement(n.Plus,{className:"bw-h-3 bw-w-3"}),r.__("New Appointment","bookster"))}function he(){const{customerId:e}=l.useParams();return isNaN(Number(e))?null:Number(e)}function ve(e){return l.useQuery({queryKey:["customer",e],queryFn:()=>e?N(e):null,staleTime:0})}function fe(){const a=o.Form.useFormInstance(),{toast:s}=t.useToast(),i=he(),{data:c}=ve(i),u=null===i,p=o.Form.useWatch("wp_user_id",a),d=o.Form.useWatch("wp_user_display_name",a),E=p&&d,_=l.useQueryClient(),b=l.useMutation({mutationFn:({id:e,email:t})=>C(e,t),onSuccess:e=>{a.setFieldsValue({wp_user_id:e.wp_user_id,wp_user_display_name:e.wp_user_display_name}),_.invalidateQueries({queryKey:["customers"]})}}),w=l.useMutation({mutationFn:({id:e})=>S(e),onSuccess:e=>{a.setFieldsValue({wp_user_id:e.wp_user_id,wp_user_display_name:e.wp_user_display_name}),_.invalidateQueries({queryKey:["customers"]})}});return e.createElement(e.Fragment,null,u?null:e.createElement(t.FormItem,{label:e.createElement("span",{className:"bw-flex bw-items-center bw-gap-1"},e.createElement("span",null,r.__("Wordpress User","bookster"))),tooltip:r.__("Link Customer with WP User to allow them to login and browse Appointment History.","bookster")},e.createElement("div",{className:"bw-flex bw-h-9 bw-items-center bw-gap-4 bw-rounded bw-border bw-px-3 bw-text-sm"},e.createElement("div",{className:"bw-me-auto"},E?e.createElement("span",{className:"bw-flex bw-items-center bw-gap-1.5"},e.createElement(n.Link,null)," ",r.__("Linked to the WP User","bookster"),e.createElement(m,{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${p}`,target:"_blank"},d)):e.createElement("span",{className:"bw-flex bw-items-center bw-gap-1.5"},e.createElement(n.Unlink,null)," ",r.__("Not Linked to any WP User.","bookster"))),e.createElement(t.Separator,{orientation:"vertical"}),E?e.createElement(e.Fragment,null,w.isLoading?e.createElement(n.Loader2,{className:"bw-animate-spin"}):e.createElement(m,{onClick:async function(){(null==c?void 0:c.customer_id)&&await w.mutateAsync({id:c.customer_id})}},r.__("Unlink Now","bookster"))):e.createElement(e.Fragment,null,b.isLoading?e.createElement(n.Loader2,{className:"bw-animate-spin"}):e.createElement(m,{onClick:async function(){if(!(null==c?void 0:c.customer_id))return;try{await a.validateFields(["email","first_name","last_name"])}catch(t){return}const e=a.getFieldValue("email");if(e===c.email)try{await b.mutateAsync({id:c.customer_id,email:e})}catch(t){s.error(await l.getErrorMsg(t))}else s.warning("Email has changed! Please save form before linking.")}},r.__("Link Now","bookster"))))),e.createElement(o.Form.Item,{name:"wp_user_id",hidden:!0},e.createElement(t.InputNumber,null)),e.createElement(o.Form.Item,{name:"wp_user_display_name",hidden:!0},e.createElement(t.Input,null)))}function Fe(){const a=he(),{data:n}=ve(a),[l,m]=s.useState(""),c=o.Form.useFormInstance(),u=o.Form.useWatch("wp_user_id",c);return s.useEffect((()=>{n&&m((null==n?void 0:n.transient_avatar_url)??"")}),[n]),e.createElement(e.Fragment,null,e.createElement(Y,{coverSrc:l,onSelectCover:e=>{c.setFieldValue("avatar_id",+e.id),m(e.url)},onRemoveCover:e=>{c.setFieldValue("avatar_id",null),m(e)}}),e.createElement(o.Form.Item,{name:"avatar_id",hidden:!0},e.createElement(_,null)),e.createElement("div",{className:"bw-mt-4 bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},e.createElement("div",null,e.createElement(o.Form.Item,{label:r.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},e.createElement(t.Input,{placeholder:r.__("Please enter First Name","bookster"),autoFocus:!0}))),e.createElement("div",null,e.createElement(o.Form.Item,{label:r.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},e.createElement(t.Input,{placeholder:r.__("Please enter Last Name","bookster")}))),e.createElement("div",null,e.createElement(t.FormItem,{label:r.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"],tooltip:void 0!==u&&e.createElement(e.Fragment,null,r.__("Please change Email from","bookster"),"  ",e.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${u}`,className:"bw-text-info",target:"_blank"},r.__("Wordpress Profile","bookster")))},e.createElement(t.Input,{placeholder:r.__("Please enter Email","bookster"),disabled:void 0!==u}))),e.createElement("div",null,e.createElement(o.Form.Item,{label:r.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:Ee,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},e.createElement(t.PhoneInput,null))),e.createElement("div",{className:"bw-col-span-full"},e.createElement(fe,null)),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminCustomerForm.AfterWpUser,[]),e.createElement("div",{className:"bw-col-span-full"},e.createElement(o.Form.Item,{label:r.__("Notes by Staff","bookster"),name:"admin_note"},e.createElement(t.Textarea,{rows:3,placeholder:r.__("Please enter Note","bookster")}))),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminCustomerForm.EndForm,[])),e.createElement("button",{type:"submit",className:"bw-hidden"}))}function Ae(){const{toast:n}=t.useToast(),{nestedCustomer:m,setNestedCustomer:i}=de.useApptFormLogic(),[,c]=m,u=isNaN(Number(c))?null:Number(c),{data:p,isLoading:d}=ve(u),[E]=o.Form.useForm(),_=l.useQueryClient(),b=l.useMutation({mutationKey:["customers",u,"edit"],mutationFn:({id:e,values:t})=>M(e,t),onSuccess:e=>{_.setQueryData(["customer",u],e),_.invalidateQueries({queryKey:["customers"]})}});s.useEffect((()=>{p&&(E.resetFields(),E.setFieldsValue(p))}),[p]);const w=d||!p&&!d||b.isLoading;return e.createElement(e.Fragment,null,e.createElement(t.DrawerHeader,null,e.createElement(t.DrawerTitle,null,r.sprintf(r.__("Edit %(customer)s","bookster"),a)),e.createElement(t.DrawerCloseIcon,null)),e.createElement(t.DrawerBody,null,e.createElement(t.LoadingOverlay,{loading:w}),e.createElement(o.Form,{name:"customerForm",form:E,disabled:w,layout:"vertical",scrollToFirstError:!0,onFinish:async function(e){if(u&&p)try{e.email&&e.email!==p.email&&await I(e.email),await b.mutateAsync({id:p.customer_id,values:e}),n.success(r.sprintf(r.__("%(customer)s has been Saved Successfully!","bookster"),a)),i(["close"])}catch(t){n.error(await l.getErrorMsg(t))}}},e.createElement(Fe,null))),e.createElement(t.DrawerFooter,null,e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},r.__("Cancel","bookster"))),e.createElement(t.Button,{key:"submit",type:"submit",form:"customerForm",disabled:w,size:"large",className:"bw-min-w-[7rem]"},r.__("Save","bookster"))))}const Ne={first_name:"",last_name:"",email:"",admin_note:""};function Ce(){const{toast:n}=t.useToast(),{apptForm:s,setNestedBooking:m,setNestedCustomer:i}=de.useApptFormLogic(),{hasMultipleBookings:c}=de.useSelectedService(),u=l.useQueryClient(),p=l.useMutation({mutationKey:["customers","new"],mutationFn:D,onSuccess:e=>{u.setQueryData(["customer",e.customer_id],e),u.invalidateQueries({queryKey:["customers"]})}});return e.createElement(e.Fragment,null,e.createElement(t.DrawerHeader,null,e.createElement(t.DrawerTitle,null,r.sprintf(r.__("New %(customer)s","bookster"),a)),e.createElement(t.DrawerCloseIcon,null)),e.createElement(t.DrawerBody,null,e.createElement(t.LoadingOverlay,{loading:p.isLoading}),e.createElement(o.Form,{name:"customerForm",initialValues:Ne,disabled:p.isLoading,layout:"vertical",scrollToFirstError:!0,onFinish:async function(e){try{await I(e.email);const t=await p.mutateAsync(e);n.success(r.sprintf(r.__("%(customer)s has been Saved Successfully!","bookster"),a));const l=s.getFieldsValue(["bookings"]);if(c||1!==l.length){const e=se(s.getFieldsValue());m(["new",{...e,customer_id:t.customer_id}])}else s.setFieldsValue({bookings:[{...l[0],customer_id:t.customer_id}]});i(["close"])}catch(t){n.error(await l.getErrorMsg(t))}}},e.createElement(Fe,null))),e.createElement(t.DrawerFooter,null,e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},r.__("Cancel","bookster"))),e.createElement(t.Button,{key:"submit",type:"submit",form:"customerForm",disabled:p.isLoading,size:"large",className:"bw-min-w-[7rem]"},r.__("Save","bookster"))))}function Se(){const{nestedCustomer:a,setNestedCustomer:n}=de.useApptFormLogic(),[r]=a,s=l.useIsMutating({mutationKey:["customers"]});return e.createElement(t.Drawer,{open:"close"!==r,onOpenChange:e=>{e||s||n(["close"])}},e.createElement(t.DrawerPortal,null,e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.DrawerOverlay,{className:"bw-bg-transparent"})),e.createElement(t.DrawerContent,{className:"bw-w-[36rem]"},"close"===r&&e.createElement(b,null),"new"===r&&e.createElement(Ce,null),"edit"===r&&e.createElement(Ae,null))))}function Me({children:a}){const[n,m]=s.useState(!1),{toast:c}=t.useToast(),u=l.useQueryClient(),p=l.useMutation({mutationKey:["appointments","new"],mutationFn:X,onSuccess:e=>{u.setQueryData(["appointment",e.appointment_id],e),u.removeQueries(["appointment",e.appointment_id,"details"]),u.invalidateQueries({queryKey:["appointments"]})}}),[d]=o.Form.useForm(),E=l.useActiveServices(),_=l.useActiveAgents(),b=s.useMemo((()=>{let e=oe();return e=me(e,E,_),e=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.initFormValues,e,null),e=ie(e),e}),[E,_]),[g,y]=s.useState(["close"]),[k,h]=s.useState(["close"]);return e.createElement(e.Fragment,null,e.createElement(t.Slot,{onClick:function(){m(!0),d.resetFields()}},a),e.createElement(de.ApptFormContext.Provider,{value:{editMode:"new",roleMode:"manager",apptForm:d,initialValues:b,nestedCustomer:g,setNestedCustomer:y,nestedBooking:k,setNestedBooking:h}},e.createElement(t.Drawer,{open:n,onOpenChange:e=>{e||p.isLoading||m(!1)}},e.createElement(t.DrawerPortalContent,null,e.createElement(t.DrawerHeader,null,e.createElement(t.DrawerTitle,null,r.__("New Appointment","bookster")),e.createElement(t.DrawerCloseIcon,null)),e.createElement(w,{className:"bw-py-0"},e.createElement(t.LoadingOverlay,{loading:p.isLoading}),e.createElement(o.Form,{className:"bw-flex bw-h-full bw-min-h-full bw-flex-col",name:"apptForm",form:d,initialValues:b,onFinish:async function(e){try{let t=ce(e);t=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareApptInput,t,e);let a=ue(e);a=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareBookingsInput,a,e),await p.mutateAsync({apptInput:t,bookingsInput:a}),c.success("Appointment has been Saved Successfully!"),m(!1)}catch(t){c.error(await l.getErrorMsg(t))}},layout:"vertical",scrollToFirstError:!0},e.createElement(O,null))),e.createElement(t.DrawerFooter,null,e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},r.__("Cancel","bookster"))),e.createElement(t.Button,{key:"submit",type:"submit",form:"apptForm",disabled:p.isLoading,size:"large",className:"bw-min-w-[7rem]"},r.__("Create New","bookster"))))),e.createElement(Se,null),e.createElement(P,null)))}function Ie(){return e.createElement(Me,null,e.createElement(t.Button,{size:"large"},e.createElement(n.Plus,{className:"bw-h-3 bw-w-3"}),r.__("New Appointment","bookster")))}function De(){return e.createElement(l.Routes,null,e.createElement(l.Route,{path:"/dashboard/*",element:e.createElement(ke,null)}),e.createElement(l.Route,{path:"/calendar/*",element:e.createElement(ke,null)}),e.createElement(l.Route,{path:"/appointments/*",element:e.createElement(ke,null)}),e.createElement(l.Route,{path:"/services/*",element:e.createElement(Ie,null)}),e.createElement(l.Route,{path:"/agents/*",element:e.createElement(Ie,null)}),e.createElement(l.Route,{path:"/customers/*",element:e.createElement(Ie,null)}),e.createElement(l.Route,{path:"/settings/*",element:null}),e.createElement(l.Route,{path:"/customize/*",element:null}),e.createElement(l.Route,{path:"/integrations/*",element:null}),e.createElement(l.Route,{path:"/addons/*",element:null}),e.createElement(l.Route,{path:"*",element:e.createElement(Ie,null)}),i.booksterHooks.applyFilters(i.HOOK_NAMES.layout.ManagerHeaderButtons))}function Oe(){const l=i.booksterHooks.hasFilter(i.HOOK_NAMES.layout.ManagerMenuSubItems_+"services");return e.createElement(e.Fragment,null,e.createElement(t.SidebarGroup,{key:"management"},e.createElement(t.SidebarGroupLabel,{className:"bw-mt-4 group-data-[collapsible=icon]:bw-mt-0"},r.__("Management","bookster")),e.createElement(t.SidebarGroupContent,null,e.createElement(t.SidebarMenu,null,e.createElement(L,{to:"/dashboard",tooltip:r.__("Dashboard","bookster")},e.createElement(n.House,null),e.createElement("span",null,r.__("Dashboard","bookster"))),e.createElement(L,{to:"/calendar",tooltip:r.__("Calendar","bookster")},e.createElement(n.Calendar,null),e.createElement("span",null,r.__("Calendar","bookster")))))),e.createElement(t.SidebarSeparator,{className:"bw-mt-6 bw-bg-transparent group-data-[collapsible=icon]:bw-mt-3 group-data-[collapsible=icon]:bw-bg-sidebar-border"}),e.createElement(t.SidebarGroup,{key:"records"},e.createElement(t.SidebarGroupLabel,null,r.__("Records","bookster")),e.createElement(t.SidebarGroupContent,null,e.createElement(t.SidebarMenu,null,e.createElement(H,null,e.createElement(x,{to:{pathname:"/appointments",search:`?date-from=${Pe.format(c.DAY_KEY_FORMAT)}&date-to=${Le.format(c.DAY_KEY_FORMAT)}`}},e.createElement(n.ListCheck,null),e.createElement("span",null,r.__("Appointments","bookster"))),e.createElement(T,null,e.createElement(K,{to:"/appointments",search:"status=pending"},u("pending")),e.createElement(K,{to:"/appointments",search:""},r.__("All Appointments","bookster")))),e.createElement(L,{to:"/agents",tooltip:a.agents},e.createElement(n.Users,null),e.createElement("span",null,a.agents)),!l&&e.createElement(L,{to:"/services",tooltip:a.services},e.createElement(n.Box,null),e.createElement("span",null,a.services)),l&&e.createElement(H,null,e.createElement(x,{to:"/services"},e.createElement(n.Box,null),e.createElement("span",null,a.services)),e.createElement(T,null,e.createElement(K,{to:"/services/list"},r.__("List","bookster")," ",a.services),i.booksterHooks.applyFilters(i.HOOK_NAMES.layout.ManagerMenuSubItems_+"services",[]))),e.createElement(L,{to:"/customers",tooltip:a.customers},e.createElement(n.SquareUser,null),e.createElement("span",null,a.customers)),i.booksterHooks.applyFilters(i.HOOK_NAMES.layout.ManagerMenuItems_+"records",[])))),e.createElement(t.SidebarSeparator,{className:"bw-mt-6 bw-bg-transparent group-data-[collapsible=icon]:bw-mt-3 group-data-[collapsible=icon]:bw-bg-sidebar-border"}),e.createElement(t.SidebarGroup,{key:"administration"},e.createElement(t.SidebarGroupLabel,null,r.__("Administration","bookster")),e.createElement(t.SidebarGroupContent,null,e.createElement(t.SidebarMenu,null,e.createElement(H,null,e.createElement(x,{to:"/settings"},e.createElement(n.Bolt,null),e.createElement("span",null,r.__("Settings","bookster"))),e.createElement(T,null,e.createElement(K,{to:"/settings/general"},r.__("General","bookster")),e.createElement(K,{to:"/settings/schedule"},r.__("Schedule","bookster")),e.createElement(K,{to:"/settings/holiday"},r.__("Holiday","bookster")),e.createElement(K,{to:"/settings/permissions"},r.__("Permissions","bookster")),e.createElement(K,{to:"/settings/payment"},r.__("Payment","bookster")),i.booksterHooks.applyFilters(i.HOOK_NAMES.layout.ManagerMenuSubItems_+"settings",[]))),e.createElement(L,{to:"/customize",tooltip:r.__("Customize","bookster")},e.createElement(n.SlidersVertical,null),e.createElement("span",null,r.__("Customize","bookster"))),e.createElement(H,null,e.createElement(x,{to:"/integrations"},e.createElement(n.Cpu,null),e.createElement("span",null,r.__("Integrations","bookster"))),e.createElement(T,null,e.createElement(K,{to:"/integrations/overview"},r.__("Overview","bookster")),e.createElement(K,{to:"/integrations/email"},r.__("Email","bookster")),i.booksterHooks.applyFilters(i.HOOK_NAMES.layout.ManagerMenuSubItems_+"integrations",[]))),e.createElement(L,{to:"/addons",tooltip:r.__("Add-ons","bookster")},e.createElement(n.Plug,null),e.createElement("span",null,r.__("Add-ons","bookster")))))))}const Pe=c.dayjs(),Le=Pe.add(7,"day");function He(){return e.createElement(R,{userInfo:e.createElement(B,null),sideMenu:e.createElement(Oe,null),headerButtons:e.createElement(De,null),searchGlobal:e.createElement(ye,null)},e.createElement(l.Outlet,null),e.createElement(t.Toaster,null))}function xe(e){const{data:t}=l.useQuery({queryKey:["appointment",e],enabled:!1}),a=l.useQuery({queryKey:["appointment",e,"details"],queryFn:()=>e?Z(e):null,staleTime:0});return{selectedAppt:s.useMemo((()=>{var n;if(!e)return null;if(!(null==(n=a.data)?void 0:n.appointment))return t||null;const r=a.data.appointment;return r.appointment_id===(null==t?void 0:t.appointment_id)&&r.updated_at===(null==t?void 0:t.updated_at)?t:a.data.appointment}),[e,t,a.data]),detailsQuery:a}}function Te(){const o=V(),{selectedAppt:m}=xe(o),{toast:c}=t.useToast(),u=l.useQueryClient(),p=E(),d=ee((e=>e.resetAppointmentForm)),[_,b]=s.useState(!1),w=l.useMutation({mutationKey:["appointments",o,"delete"],mutationFn:te,onSuccess:()=>{u.removeQueries(["appointment",o]),u.invalidateQueries({queryKey:["appointments"]})}}),g=l.useIsMutating(["appointments",o]),y=!m||g>0;return e.createElement(e.Fragment,null,e.createElement(t.DropdownMenu,null,e.createElement(t.DropdownMenuTrigger,{asChild:!0},e.createElement(t.Button,{key:"more",variant:"trivial",size:"icon",className:"bw-me-auto bw-h-9 bw-w-9"},e.createElement(n.EllipsisVertical,null))),e.createElement(t.DropdownMenuContent,{align:"start",side:"top",className:"bw-w-64"},e.createElement(t.DropdownMenuLabel,null,r.__("More Actions","bookster")),e.createElement(t.DropdownMenuSeparator,null),e.createElement(t.DropdownMenuGroup,{className:"bw-space-y-1.5 bw-p-1.5"},e.createElement(t.DropdownMenuItem,{onClick:()=>{!async function(){if(m&&!_)try{b(!0),await ae(m.appointment_id),c.success(r.__("Email Notification has been Sent Successfully!","bookster"))}catch(e){const t=await l.getErrorMsg(e);c.error(t)}finally{b(!1)}}()}},e.createElement(n.Mails,null),e.createElement("span",{className:"bw-ml-2"},r.sprintf(r.__("Resend Email to %(customer)s","bookster"),a))),e.createElement(t.DropdownMenuItem,{onClick:()=>{!async function(){if(m&&!_)try{b(!0),await ne(m.appointment_id),c.success(r.__("Email Notification has been Sent Successfully!","bookster"))}catch(e){const t=await l.getErrorMsg(e);c.error(t)}finally{b(!1)}}()}},e.createElement(n.Mail,null),e.createElement("span",{className:"bw-ml-2"},r.sprintf(r.__("Resend Email to %(agent)s","bookster"),a))),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.MoreAppointmentActions,[],m)),e.createElement(t.DropdownMenuSeparator,{className:"bw-mx-2 bw-h-0 bw-border-t bw-border-dashed bw-bg-inherit"}),e.createElement(t.DropdownMenuGroup,{className:"bw-space-y-1.5 bw-p-1.5"},e.createElement(t.DropdownMenuItem,{disabled:y,onClick:()=>(async()=>{if(null==m?void 0:m.appointment_id)try{await w.mutateAsync(m.appointment_id),c.success("Appointment has been Deleted Successfully!"),p(".."),d()}catch(e){c.error(await l.getErrorMsg(e))}})()},e.createElement(n.Trash,null),e.createElement("span",{className:"bw-ml-2"},r.__("Delete","bookster")))))))}function Ke(){const a=ee((e=>e.resetAppointmentForm)),n=V(),{selectedAppt:m}=xe(n),{toast:c}=t.useToast(),u=E(),p=l.useQueryClient(),d=l.useMutation({mutationKey:["appointments",n,"edit"],mutationFn:({id:e,values:t})=>re(e,t),onSuccess:e=>{p.setQueryData(["appointment",n],e),p.removeQueries(["appointment",n,"details"]),p.invalidateQueries({queryKey:["appointments"]})}}),[_]=o.Form.useForm(),b=s.useMemo((()=>{let e=oe();return m&&(e=pe(m)),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.initFormValues,e,m)}),[m]);t.useUpdateEffect((()=>{_.resetFields(),h(["close"]),f(["close"]),m&&_.setFieldsValue(b)}),[m]),Q(m);const g=l.useIsMutating(["appointments",n]),y=!m||g>0,[k,h]=s.useState(["close"]),[v,f]=s.useState(["close"]);return e.createElement(de.ApptFormContext.Provider,{value:{editMode:"edit",roleMode:"manager",apptForm:_,initialValues:b,nestedCustomer:k,setNestedCustomer:h,nestedBooking:v,setNestedBooking:f}},e.createElement(t.DrawerHeader,null,e.createElement(t.DrawerTitle,null,r.__("Edit Appointment","bookster")," ",e.createElement(t.Badge,{color:"base",variant:"fill",className:"bw-font-medium bw-tracking-wide"},`#${n}`)),e.createElement(t.DrawerCloseIcon,null)),e.createElement(w,{className:"bw-py-0"},e.createElement(t.LoadingOverlay,{loading:y}),e.createElement(o.Form,{className:"bw-flex bw-h-full bw-min-h-full bw-flex-col",name:"apptForm",form:_,initialValues:b,onFinish:async function(e){if(m)try{let t=ce(e);t=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareApptInput,t,e);let n=ue(e);n=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareBookingsInput,n,e),await d.mutateAsync({id:m.appointment_id,values:{apptInput:t,bookingsInput:n}}),c.success("Appointment has been Saved Successfully!"),u(".."),a()}catch(t){c.error(await l.getErrorMsg(t))}},layout:"vertical",scrollToFirstError:!0},e.createElement(O,null))),e.createElement(t.DrawerFooter,null,e.createElement(Te,null),e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},r.__("Cancel","bookster"))),e.createElement(t.Button,{key:"submit",type:"submit",form:"apptForm",disabled:y,size:"large",className:"bw-min-w-[7rem]"},r.__("Save","bookster"))),e.createElement(Se,null),e.createElement(P,null))}function Re(){const{presetValues:a}=ee((e=>e.appointments.form)),n=ee((e=>e.resetAppointmentForm)),{toast:m}=t.useToast(),c=E(),u=l.useQueryClient(),p=l.useMutation({mutationKey:["appointments","new"],mutationFn:X,onSuccess:e=>{u.setQueryData(["appointment",e.appointment_id],e),u.removeQueries(["appointment",e.appointment_id,"details"]),u.invalidateQueries({queryKey:["appointments"]})}}),[d]=o.Form.useForm(),_=l.useActiveServices(),b=l.useActiveAgents(),g=s.useMemo((()=>{let e=oe();return e=me(e,_,b,a),e=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.initFormValues,e,null),e=ie(e),e}),[a,_,b]),[y,k]=s.useState(["close"]),[h,v]=s.useState(["close"]);return e.createElement(de.ApptFormContext.Provider,{value:{editMode:"new",roleMode:"manager",apptForm:d,initialValues:g,nestedCustomer:y,setNestedCustomer:k,nestedBooking:h,setNestedBooking:v}},e.createElement(t.DrawerHeader,null,e.createElement(t.DrawerTitle,null,r.__("New Appointment","bookster")),e.createElement(t.DrawerCloseIcon,null)),e.createElement(w,{className:"bw-py-0"},e.createElement(t.LoadingOverlay,{loading:p.isLoading}),e.createElement(o.Form,{className:"bw-flex bw-h-full bw-min-h-full bw-flex-col",name:"apptForm",form:d,initialValues:g,onFinish:async function(e){try{let t=ce(e);t=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareApptInput,t,e);let a=ue(e);a=i.booksterHooks.applyFilters(i.HOOK_NAMES.adminApptForm.prepareBookingsInput,a,e),await p.mutateAsync({apptInput:t,bookingsInput:a}),m.success("Appointment has been Saved Successfully!"),c(".."),n()}catch(t){m.error(await l.getErrorMsg(t))}},layout:"vertical",scrollToFirstError:!0},e.createElement(O,null))),e.createElement(t.DrawerFooter,null,e.createElement(t.DrawerClose,{asChild:!0},e.createElement(t.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},r.__("Cancel","bookster"))),e.createElement(t.Button,{key:"submit",type:"submit",form:"apptForm",disabled:p.isLoading,size:"large",className:"bw-min-w-[7rem]"},r.__("Create New","bookster"))),e.createElement(Se,null),e.createElement(P,null))}const Be=q((()=>j((()=>import("./DashboardPage-bd0090cf.js")),["DashboardPage-bd0090cf.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","AppointmentFormDrawer-884f27d3.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","CalendarContent-e50ff6c3.js","react-dom-3e43fe1d.js","appointment.helper-07645f99.js","createBookTimeInput.helper-ed47ae63.js","main-6566bc29.js","useAgentResources-6fea2cc0.js","queue.helper-cc60359e.js","CalendarNav.styled-cb1aebbc.js","ReloadButton-117ef334.js","StatsRate-10303d5b.js"]))),Ve=q((()=>j((()=>import("./CalendarPage-fcfdd7f6.js")),["CalendarPage-fcfdd7f6.js","prefetch.helper-04349684.js","CalendarContent-e50ff6c3.js","react-dom-3e43fe1d.js","appointment.helper-07645f99.js","createBookTimeInput.helper-ed47ae63.js","UIComponents-7ff4460b.js","AppointmentFormDrawer-884f27d3.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","main-70b6d0e7.js","main-6566bc29.js","useAgentResources-6fea2cc0.js","queue.helper-cc60359e.js","ApptsFilterAgent-3decfdb7.js","ApptsFilterService-c1f460fc.js","useCacheCustomers-102bfcf8.js","CalendarNav.styled-cb1aebbc.js","ReloadButton-117ef334.js"]))),Qe=q((()=>j((()=>import("./AppointmentsPage-dfb8e7c4.js")),["AppointmentsPage-dfb8e7c4.js","prefetch.helper-04349684.js","CalendarNav.styled-cb1aebbc.js","UIComponents-7ff4460b.js","AppointmentFormDrawer-884f27d3.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","ApptsFilterAgent-3decfdb7.js","ApptsFilterService-c1f460fc.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","appointment.helper-07645f99.js","ReloadButton-f13d4c5e.js","apptDataTable-a0a4fccd.js","ReloadButton-117ef334.js"]))),qe=q((()=>j((()=>import("./NewAgentDrawer-b8639ef5.js")),["NewAgentDrawer-b8639ef5.js","prefetch.helper-04349684.js","CoverPicker-52693ec5.js","BEConfigProvider-705eafe2.js","agent.helper-a271074e.js","AgentGeneralTab-a55c53ee.js","phoneInput.helper-806287af.js","AgentScheduleTab-5fda5591.js","WeeklyScheduleEditor-9e383627.js","lodash-f550b173.js","CalendarNav.styled-cb1aebbc.js"]))),je=q((()=>j((()=>import("./EditAgentDrawer-1ff4d378.js")),["EditAgentDrawer-1ff4d378.js","prefetch.helper-04349684.js","CoverPicker-52693ec5.js","BEConfigProvider-705eafe2.js","agent.helper-a271074e.js","AgentGeneralTab-a55c53ee.js","phoneInput.helper-806287af.js","AgentScheduleTab-5fda5591.js","WeeklyScheduleEditor-9e383627.js","lodash-f550b173.js","CalendarNav.styled-cb1aebbc.js","store-bdc614dc.js"]))),$e=q((()=>j((()=>import("./AgentsPage-32b05b30.js")),["AgentsPage-32b05b30.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","AgentsList-21806846.js","BEConfigProvider-705eafe2.js","CoverPicker-52693ec5.js","agent.helper-a271074e.js","apptDataTable-a0a4fccd.js","store-bdc614dc.js"]))),ze=q((()=>j((()=>import("./NewServiceDrawer-6ff6b82d.js")),["NewServiceDrawer-6ff6b82d.js","prefetch.helper-04349684.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","CoverPicker-52693ec5.js","useServiceFormContext-43091331.js","ServiceGeneralTab-007b1fbe.js","color.helper-9b8c6bb8.js"]))),Ge=q((()=>j((()=>import("./EditServiceDrawer-81dfc13f.js")),["EditServiceDrawer-81dfc13f.js","prefetch.helper-04349684.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","CoverPicker-52693ec5.js","useServiceFormContext-43091331.js","ServiceGeneralTab-007b1fbe.js","color.helper-9b8c6bb8.js"]))),Ue=q((()=>j((()=>import("./ServicesPage-1f3d4f1c.js")),["ServicesPage-1f3d4f1c.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","ServiceFormDrawer-3b6bfb3d.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","CoverPicker-52693ec5.js","ServiceCard-1f94e7ea.js","queue.helper-cc60359e.js","react-dom-3e43fe1d.js","useServiceFormContext-43091331.js"]))),We=q((()=>j((()=>import("./NewCustomerDrawer-5d23c899.js")),["NewCustomerDrawer-5d23c899.js","prefetch.helper-04349684.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","BEConfigProvider-705eafe2.js","appointment.helper-07645f99.js","BackendRouteErrorElement-6f34d3c9.js","CoverPicker-52693ec5.js","store-bdc614dc.js","phoneInput.helper-806287af.js"]))),Ye=q((()=>j((()=>import("./EditCustomerDrawer-19ee7eba.js")),["EditCustomerDrawer-19ee7eba.js","prefetch.helper-04349684.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","BEConfigProvider-705eafe2.js","appointment.helper-07645f99.js","store-bdc614dc.js","BackendRouteErrorElement-6f34d3c9.js","CoverPicker-52693ec5.js","phoneInput.helper-806287af.js"]))),Je=q((()=>j((()=>import("./CustomersPage-26c41ca7.js")),["CustomersPage-26c41ca7.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","BEConfigProvider-705eafe2.js","apptDataTable-a0a4fccd.js","store-bdc614dc.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","appointment.helper-07645f99.js"]))),Xe=q((()=>j((()=>import("./SettingsPage-3f706abb.js")),["SettingsPage-3f706abb.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","appointment.helper-07645f99.js","settings.constants-7edf7550.js","Settings.styled-aa4d422d.js","WeeklyScheduleEditor-9e383627.js","lodash-f550b173.js","CalendarNav.styled-cb1aebbc.js"]))),Ze=q((()=>j((()=>import("./CustomizePage-7760c17a.js")),["CustomizePage-7760c17a.js","prefetch.helper-04349684.js","createBookTimeInput.helper-ed47ae63.js","BookingFormRoot-a7a3ac97.js","agentSchedule.helper-648c495b.js","ErrorAlert-4c797dab.js","phoneInput.helper-806287af.js","ServiceCard-1f94e7ea.js","store-bdc614dc.js","BEConfigProvider-705eafe2.js","react-dom-3e43fe1d.js","useCacheCustomers-102bfcf8.js","appointment.helper-07645f99.js","BookingFormBlock-d69c0483.js"]))),et=q((()=>j((()=>import("./IntegrationsPage-4ab6efde.js")),["IntegrationsPage-4ab6efde.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","useCacheCustomers-102bfcf8.js","createBookTimeInput.helper-ed47ae63.js","BEConfigProvider-705eafe2.js","appointment.helper-07645f99.js","color.helper-9b8c6bb8.js","useAddonMetadata-521c8d51.js"]))),tt=q((()=>j((()=>import("./AddonsPage-15bf67f9.js")),["AddonsPage-15bf67f9.js","prefetch.helper-04349684.js","UIComponents-7ff4460b.js","useAddonMetadata-521c8d51.js"])));var at;p(),d.createRoot(document.getElementById("bookster-app-manager")).render(e.createElement(e.StrictMode,null,e.createElement(y,null,e.createElement(l.RouterProvider,{router:l.createHashRouter([{path:"*",element:e.createElement(He,null),errorElement:e.createElement(G,null),children:(at=[{index:!0,loader:()=>{if(g($.MANAGE_SHOP_RECORDS_CAP))return l.redirect("/dashboard");if(g($.MANAGE_SHOP_SETTINGS_CAP))return l.redirect("/settings/general");throw new Error("Sorry You don't Have Permission to Access this Page.")}},{path:"dashboard",element:e.createElement(Be,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(Re,null)},{path:":apptId",element:e.createElement(Ke,null)}]},{path:"calendar",element:e.createElement(Ve,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(Re,null)},{path:":apptId",element:e.createElement(Ke,null)}]},{path:"appointments",element:e.createElement(Qe,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(Re,null)},{path:":apptId",element:e.createElement(Ke,null)}]},{path:"agents",loader:()=>(qe.preload(),je.preload(),null),element:e.createElement($e,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(qe,null)},{path:":agentId",element:e.createElement(je,null)}]},{path:"services",children:[{index:!0,loader:()=>l.redirect("/services/list")},{path:"list",loader:()=>(ze.preload(),Ge.preload(),null),element:e.createElement(Ue,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(ze,null)},{path:":serviceId",element:e.createElement(Ge,null)}]}]},{path:"customers",loader:()=>(We.preload(),Ye.preload(),null),element:e.createElement(Je,null),children:[{index:!0,element:e.createElement(b,null)},{path:"new",element:e.createElement(We,null)},{path:":customerId",element:e.createElement(Ye,null)}]},{path:"settings",children:[{index:!0,loader:()=>l.redirect("/settings/general")},{path:":tabId/*",element:e.createElement(Xe,null)}]},{path:"customize/*",children:[{index:!0,loader:()=>l.redirect("/customize/step-booking")},{path:":tabId/*",element:e.createElement(Ze,null)}]},{path:"integrations",children:[{index:!0,loader:()=>l.redirect("/integrations/overview")},{path:":tabId/*",element:e.createElement(et,null)}]},{path:"addons",element:e.createElement(tt,null)},{path:"*",element:e.createElement(z,null)}],i.booksterHooks.applyFilters(i.HOOK_NAMES.router.managerRouter,at))}])}))));export{Fe as C,Ne as D,ve as a,he as u};
