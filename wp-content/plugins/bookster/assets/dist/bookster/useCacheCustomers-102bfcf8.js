import{k as e,R as t,l as a,m as n,a as r,n as l,o,q as s,c,_ as i,r as m,u,b,L as d,h as w,s as p,d as f,t as E,v as g,f as h,w as v}from"./prefetch.helper-04349684.js";import{a as y,_}from"./createBookTimeInput.helper-ed47ae63.js";import{g as k,c as N,H as x,a as C,C as S}from"./BEConfigProvider-705eafe2.js";import{R as F,f as A}from"./appointment.helper-07645f99.js";const I={},P=function(e,t,a){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/wp-content/plugins/bookster/assets/dist/bookster/"+e}(e))in I)return;I[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(a)for(let a=n.length-1;a>=0;a--){const r=n[a];if(r.href===e&&(!t||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const l=document.createElement("link");return l.rel=t?"stylesheet":"modulepreload",t||(l.as="script",l.crossOrigin=""),l.href=e,document.head.appendChild(l),t?new Promise(((t,a)=>{l.addEventListener("load",t),l.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))};var M=(e=>(e.MANAGE_SHOP_SETTINGS_CAP="bookster_manage_shop_settings",e.MANAGE_SHOP_RECORDS_CAP="bookster_manage_shop_records",e.MANAGE_AGENT_SETTINGS_CAP="bookster_manage_agent_settings",e.MANAGE_AGENT_RECORDS_CAP="bookster_manage_agent_records",e.MANAGE_AGENT_PROFILE_CAP="bookster_manage_agent_profile",e))(M||{});function D(e,t){if(null==e)return{};var a={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;a[n]=e[n]}return a}function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},B.apply(null,arguments)}var O={exports:{}},$={},j="function"==typeof Symbol&&Symbol.for,R=j?Symbol.for("react.element"):60103,T=j?Symbol.for("react.portal"):60106,L=j?Symbol.for("react.fragment"):60107,H=j?Symbol.for("react.strict_mode"):60108,V=j?Symbol.for("react.profiler"):60114,q=j?Symbol.for("react.provider"):60109,z=j?Symbol.for("react.context"):60110,K=j?Symbol.for("react.async_mode"):60111,G=j?Symbol.for("react.concurrent_mode"):60111,U=j?Symbol.for("react.forward_ref"):60112,W=j?Symbol.for("react.suspense"):60113,Q=j?Symbol.for("react.suspense_list"):60120,Z=j?Symbol.for("react.memo"):60115,Y=j?Symbol.for("react.lazy"):60116,J=j?Symbol.for("react.block"):60121,X=j?Symbol.for("react.fundamental"):60117,ee=j?Symbol.for("react.responder"):60118,te=j?Symbol.for("react.scope"):60119;function ae(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case R:switch(e=e.type){case K:case G:case L:case V:case H:case W:return e;default:switch(e=e&&e.$$typeof){case z:case U:case Y:case Z:case q:return e;default:return t}}case T:return t}}}function ne(e){return ae(e)===G}$.AsyncMode=K,$.ConcurrentMode=G,$.ContextConsumer=z,$.ContextProvider=q,$.Element=R,$.ForwardRef=U,$.Fragment=L,$.Lazy=Y,$.Memo=Z,$.Portal=T,$.Profiler=V,$.StrictMode=H,$.Suspense=W,$.isAsyncMode=function(e){return ne(e)||ae(e)===K},$.isConcurrentMode=ne,$.isContextConsumer=function(e){return ae(e)===z},$.isContextProvider=function(e){return ae(e)===q},$.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===R},$.isForwardRef=function(e){return ae(e)===U},$.isFragment=function(e){return ae(e)===L},$.isLazy=function(e){return ae(e)===Y},$.isMemo=function(e){return ae(e)===Z},$.isPortal=function(e){return ae(e)===T},$.isProfiler=function(e){return ae(e)===V},$.isStrictMode=function(e){return ae(e)===H},$.isSuspense=function(e){return ae(e)===W},$.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===L||e===G||e===V||e===H||e===W||e===Q||"object"==typeof e&&null!==e&&(e.$$typeof===Y||e.$$typeof===Z||e.$$typeof===q||e.$$typeof===z||e.$$typeof===U||e.$$typeof===X||e.$$typeof===ee||e.$$typeof===te||e.$$typeof===J)},$.typeOf=ae,O.exports=$;var re=O.exports,le={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},oe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},se={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},ce={};function ie(e){return re.isMemo(e)?se:ce[e.$$typeof]||le}ce[re.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ce[re.Memo]=se;var me=Object.defineProperty,ue=Object.getOwnPropertyNames,be=Object.getOwnPropertySymbols,de=Object.getOwnPropertyDescriptor,we=Object.getPrototypeOf,pe=Object.prototype;const fe=e((function e(t,a,n){if("string"!=typeof a){if(pe){var r=we(a);r&&r!==pe&&e(t,r,n)}var l=ue(a);be&&(l=l.concat(be(a)));for(var o=ie(t),s=ie(a),c=0;c<l.length;++c){var i=l[c];if(!(oe[i]||n&&n[i]||s&&s[i]||o&&o[i])){var m=de(a,i);try{me(t,i,m)}catch(u){}}}}return t}));var Ee=t.createContext(),ge={},he="PENDING",ve="REJECTED",ye=function(e){return e};function _e(e){var a=e.defaultResolveComponent,n=void 0===a?ye:a,r=e.render,l=e.onLoad;function o(e,a){void 0===a&&(a={});var o=function(e){return"function"==typeof e?{requireAsync:e,resolve:function(){},chunkName:function(){}}:e}(e),s={};function c(e){return a.cacheKey?a.cacheKey(e):o.resolve?o.resolve(e):"static"}function i(e,t,r){var l=a.resolveComponent?a.resolveComponent(e,t):n(e);return fe(r,l,{preload:!0}),l}var m,u,b=function(e){var t=c(e),a=s[t];return a&&a.status!==ve||((a=o.requireAsync(e)).status=he,s[t]=a,a.then((function(){a.status="RESOLVED"}),(function(t){console.error("loadable-components: failed to asynchronously load component",{fileName:o.resolve(e),chunkName:o.chunkName(e),error:t?t.message:t}),a.status=ve}))),a},d=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={result:null,error:null,loading:!0,cacheKey:c(t)},function(e){if(!e){var t=new Error("loadable: SSR requires `@loadable/babel-plugin`, please install it");throw t.framesToPop=1,t.name="Invariant Violation",t}}(!t.__chunkExtractor||o.requireSync),t.__chunkExtractor?(!1===a.ssr||(o.requireAsync(t).catch((function(){return null})),n.loadSync(),t.__chunkExtractor.addChunk(o.chunkName(t))),function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)):(!1!==a.ssr&&(o.isReady&&o.isReady(t)||o.chunkName&&ge[o.chunkName(t)])&&n.loadSync(),n)}y(t,e),t.getDerivedStateFromProps=function(e,t){var a=c(e);return B({},t,{cacheKey:a,loading:t.loading||t.cacheKey!==a})};var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0;var e=this.getCache();e&&e.status===ve&&this.setCache(),this.state.loading&&this.loadAsync()},n.componentDidUpdate=function(e,t){t.cacheKey!==this.state.cacheKey&&this.loadAsync()},n.componentWillUnmount=function(){this.mounted=!1},n.safeSetState=function(e,t){this.mounted&&this.setState(e,t)},n.getCacheKey=function(){return c(this.props)},n.getCache=function(){return s[this.getCacheKey()]},n.setCache=function(e){void 0===e&&(e=void 0),s[this.getCacheKey()]=e},n.triggerOnLoad=function(){var e=this;l&&setTimeout((function(){l(e.state.result,e.props)}))},n.loadSync=function(){if(this.state.loading)try{var e=i(o.requireSync(this.props),this.props,p);this.state.result=e,this.state.loading=!1}catch(t){console.error("loadable-components: failed to synchronously load component, which expected to be available",{fileName:o.resolve(this.props),chunkName:o.chunkName(this.props),error:t?t.message:t}),this.state.error=t}},n.loadAsync=function(){var e=this,t=this.resolveAsync();return t.then((function(t){var a=i(t,e.props,p);e.safeSetState({result:a,loading:!1},(function(){return e.triggerOnLoad()}))})).catch((function(t){return e.safeSetState({error:t,loading:!1})})),t},n.resolveAsync=function(){var e=this.props;e.__chunkExtractor,e.forwardedRef;var t=D(e,["__chunkExtractor","forwardedRef"]);return b(t)},n.render=function(){var e=this.props,t=e.forwardedRef,n=e.fallback;e.__chunkExtractor;var l=D(e,["forwardedRef","fallback","__chunkExtractor"]),o=this.state,s=o.error,c=o.loading,i=o.result;if(a.suspense&&(this.getCache()||this.loadAsync()).status===he)throw this.loadAsync();if(s)throw s;var m=n||a.fallback||null;return c?m:r({fallback:m,result:i,options:a,props:B({},l,{ref:t})})},t}(t.Component),w=(u=function(e){return t.createElement(Ee.Consumer,null,(function(a){return t.createElement(m,Object.assign({__chunkExtractor:a},e))}))},(m=d).displayName&&(u.displayName=m.displayName+"WithChunkExtractor"),u),p=t.forwardRef((function(e,a){return t.createElement(w,Object.assign({forwardedRef:a},e))}));return p.displayName="Loadable",p.preload=function(e){p.load(e)},p.load=function(e){return b(e)},p}return{loadable:o,lazy:function(e,t){return o(e,B({},t,{suspense:!0}))}}}var ke=_e({defaultResolveComponent:function(e){return e.__esModule?e.default:e.default||e},render:function(e){var a=e.result,n=e.props;return t.createElement(a,n)}}),Ne=ke.loadable,xe=ke.lazy,Ce=_e({onLoad:function(e,t){e&&t.forwardedRef&&("function"==typeof t.forwardedRef?t.forwardedRef(e):t.forwardedRef.current=e)},render:function(e){var t=e.result,a=e.props;return a.children?a.children(t):null}}),Se=Ce.loadable,Fe=Ce.lazy,Ae=Ne;function Ie(){return t.createElement(a,null,t.createElement(n,{className:"bw-text-warning"},t.createElement(r.AlertCircle,{className:"bw-h-16 bw-w-16"})),t.createElement(l,null,"404"),t.createElement(o,null,"Sorry, Page Not Found."),t.createElement(s,null,t.createElement(c.Link,{to:"/"},t.createElement(i.Button,{variant:"outline"},"Go Back"))))}Ae.lib=Se,xe.lib=Fe;const Pe=m.forwardRef((({...e},a)=>t.createElement("svg",{ref:a,xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"#829BF7",...e},t.createElement("path",{d:"M12 0C5.3724 0 0 5.3724 0 12C0 18.6276 5.3724 24 12 24C18.6276 24 24 18.6276 24 12C24 5.3724 18.6276 0 12 0ZM12.0097 6C13.9981 6 15.6097 7.6116 15.6097 9.6C15.6097 11.5884 13.9981 13.2 12.0097 13.2C10.0213 13.2 8.40967 11.5884 8.40967 9.6C8.40967 7.6116 10.0213 6 12.0097 6ZM12 22.2C9.348 22.2 6.92401 21.18 5.11201 19.512C5.64001 17.856 7.00805 16.2839 9.94805 16.2839H14.052C16.98 16.2839 18.348 17.868 18.888 19.512C17.076 21.18 14.652 22.2 12 22.2Z"}))));function Me({avatarSrc:e}){const{displayName:a,role:n,avatarUrl:l}=u((e=>e.wpUserInfo));return t.createElement(i.DropdownMenu,null,t.createElement(i.DropdownMenuTrigger,{className:"btr-dropdown-trigger bw-flex bw-w-14 bw-cursor-pointer bw-items-center bw-rounded-[18px] bw-bg-gray-20 hover:bw-bg-gray-70 [&_.avatar-fallback]:hover:bw-bg-gray-70"},t.createElement(i.Avatar,{className:"bw-h-9 bw-w-9 bw-items-center bw-justify-center"},t.createElement(i.AvatarImage,{className:"bw-h-6 bw-w-6 bw-rounded-full",src:e||l}),t.createElement(i.AvatarFallback,{className:"avatar-fallback bw-bg-inherit"},t.createElement(Pe,null))),t.createElement(r.ChevronDown,{strokeWidth:"2.5",className:"btr-dropdown-trigger-icon bw-z-50 bw-ms-0.5 bw-h-2 bw-w-2 bw-text-gray-500"})),t.createElement(i.DropdownMenuContent,{align:"end",sideOffset:6,className:"bw-w-56 bw-min-w-36"},t.createElement("div",{className:"bw-flex bw-px-5 bw-py-4 bw-text-gray-900"},t.createElement(i.Avatar,{className:"bw-h-9 bw-w-9"},t.createElement(i.AvatarImage,{src:e||l}),t.createElement(i.AvatarFallback,{className:"bw-bg-white"},t.createElement(Pe,{className:"bw-h-9 bw-w-9"}))),t.createElement("div",{className:"bw-pl-2"},t.createElement("h4",{className:"bw-font-medium"},a),t.createElement("span",{className:"bw-text-xs bw-text-gray-500"},n))),t.createElement(i.DropdownMenuSeparator,{className:"bw-my-0"}),t.createElement(i.DropdownMenuGroup,{className:"bw-space-y-1.5 bw-p-2"},t.createElement(i.DropdownMenuItem,{asChild:!0,className:"bw-rounded bw-px-3 bw-text-gray-900"},t.createElement("a",{target:"_blank",className:"bw-no-underline",href:window.booksterMeta.wpPath.adminUrl+"profile.php"},t.createElement(r.User,{className:"bw-h-4 bw-w-4"}),t.createElement("span",{className:"bw-ml-3"},b.__("My account","bookster")))),t.createElement(i.DropdownMenuItem,{asChild:!0,className:"bw-rounded bw-px-3 bw-text-gray-900"},t.createElement("a",{target:"_blank",className:"bw-no-underline",href:"https://wpbookster.com/addons/"},t.createElement(r.GridPlus,{className:"bw-h-4 bw-w-4"}),t.createElement("span",{className:"bw-ml-3"},b.__("Explore Addon","bookster")))),t.createElement(i.DropdownMenuItem,{asChild:!0,className:"bw-rounded bw-px-3 bw-text-gray-900"},t.createElement("a",{target:"_blank",className:"bw-no-underline",href:"https://wpbookster.com/support/"},t.createElement(r.LifeBuoy,{className:"bw-h-4 bw-w-4"}),t.createElement("span",{className:"bw-ml-3"},b.__("Support","bookster")))),t.createElement(i.DropdownMenuSeparator,null),t.createElement(i.DropdownMenuItem,{asChild:!0,className:"bw-rounded bw-px-3 bw-text-gray-900"},t.createElement("a",{className:"bw-no-underline",href:window.booksterMeta.wpPath.logoutUrl},t.createElement(r.LogOut,{className:"bw-h-4 bw-w-4"}),t.createElement("span",{className:"bw-ml-3"},b.__("Logout","bookster")))))))}function De(){const{isMobile:e}=i.useSidebar();return t.createElement(i.SidebarTrigger,{variant:"ghost",className:i.clsx("bw-flex-none",!e&&"bw-hidden")})}function Be(){const{open:e,isMobile:a,openMobile:n}=i.useSidebar(),r=a?n:e;return t.createElement(i.SidebarMenu,{className:"bw-border-b bw-border-white/10"},t.createElement(i.SidebarMenuItem,null,t.createElement(i.SidebarMenuButton,{tabIndex:-1,size:"lg",className:"bw-h-16 bw-cursor-default bw-items-end bw-bg-transparent bw-p-4"},t.createElement("img",{src:window.booksterMeta.appPath.bookster.assets+"/images/bookster.svg",alt:"Bookster Logo",className:"group-data-[collapsible=icon]:group-hover/menu-item:bw-opacity-0"}),t.createElement("span",{className:"bw-ml-0.5 bw-text-xl bw-font-bold bw-text-sidebar-accent-foreground"},"Bookster")),t.createElement(i.TooltipRoot,null,t.createElement(i.TooltipTrigger,{asChild:!0},t.createElement(i.SidebarMenuAction,{showOnHover:!0,asChild:!0,className:"bw-h-8 bw-w-8 group-data-[collapsible=icon]:bw-right-5 group-data-[collapsible=icon]:bw-block group-data-[collapsible=icon]:bw-opacity-0 group-data-[collapsible=icon]:group-hover/menu-item:bw-opacity-100"},t.createElement("div",null,t.createElement(i.SidebarTrigger,{variant:"ghost",className:"bw-text-sidebar-foreground hover:bw-bg-[#27282B] hover:bw-text-white"})))),t.createElement(i.TooltipPortalContent,{side:"right",sideOffset:r?13:25,align:"center",className:"bw-rounded-xs bw-px-2 bw-py-1.5 bw-leading-none"},r?b.__("Hide navigation","bookster"):b.__("Show navigation","bookster")))))}function Oe({children:e}){return t.createElement(i.Sidebar,{collapsible:"icon"},t.createElement(i.SidebarHeader,{className:"bw-p-0"},t.createElement(Be,null)),t.createElement(i.SidebarContent,{className:"btr-scrollbar-hidden"},e),t.createElement(i.SidebarFooter,{className:"bw-border-t bw-border-white/10"},t.createElement(i.SidebarMenu,null,t.createElement(i.SidebarMenuItem,null,t.createElement(i.SidebarMenuButton,{asChild:!0,tooltip:b.__("Back to WP","bookster")},t.createElement("a",{href:window.booksterMeta.wpPath.adminUrl},t.createElement(r.ArrowLeft,{className:"!bw-size-3.5"}),t.createElement("span",null,b.__("Back to WP","bookster"))))))))}function $e({children:e,sideMenu:a,headerButtons:n,userInfo:r,searchGlobal:l}){return t.createElement(i.SidebarProvider,{defaultOpen:k().pageSider,onOpenChange:e=>{N({pageSider:e})}},t.createElement(Oe,null,a),t.createElement(i.SidebarInset,{className:"bw-overflow-x-auto"},t.createElement("header",{className:"bw-z-20 bw-flex bw-h-16 bw-w-full bw-flex-none bw-items-center bw-gap-4 bw-bg-white bw-px-6",style:{boxShadow:"0px 1px 12px 0px rgba(0, 0, 0, 0.03)"}},t.createElement(De,null),l,n,r),t.createElement("main",{className:"bw-relative bw-flex-grow bw-overflow-y-hidden"},e)))}const je=m.createContext(void 0);function Re(){const e=m.useContext(je);if(!e)throw new Error("Missing InputSearchHeaderContext.Provider in the tree");return e}const Te=m.forwardRef(((e,a)=>{const{setIsOpenModal:n}=Re();return i.useKeyPress(["meta.k"],(()=>{n(!0)})),t.createElement("div",{className:"bw-relative bw-me-auto bw-w-72 bw-shrink bw-cursor-pointer",onClick:e=>{e.stopPropagation(),n(!0)}},t.createElement(i.InputPrefix,{className:"bw-pointer-events-none"},t.createElement(r.Search,{className:"bw-text-gray-500"})),t.createElement(i.Input,{ref:a,className:"bw-h-9 bw-cursor-pointer bw-rounded bw-border-gray-300 bw-pe-12 bw-ps-9 placeholder:bw-text-gray-300",placeholder:"Search...",withStatus:!1,onFocus:e=>{e.target.blur()},...e,type:"text"}),t.createElement(i.InputSuffixBadge,{className:"bw-inset-y-[5px] bw-end-[5px] bw-rounded-xs bw-px-2.5 bw-text-sm"},t.createElement("span",{className:"bw-text-gray-500"},"⌘ K")))}));function Le({appt:e}){var a,n,r,l,o;const{clickAppointment:s}=Re(),c=null==(a=null==e?void 0:e.agents)?void 0:a[0],m=null==(r=null==(n=null==e?void 0:e.bookings)?void 0:n[0])?void 0:r.customer;return t.createElement(i.CommandGroup,{key:"appointment_results",heading:"Appointments"},e?t.createElement(i.CommandItem,{key:e.appointment_id,value:`${e.appointment_id}`,keywords:[null==(l=e.service)?void 0:l.name],onSelect:()=>s(e)},t.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-gap-4 bw-rounded bw-py-2"},t.createElement("h4",{className:"bw-mb-0 bw-mr-4 bw-text-2xl bw-text-gray-800"},"#",e.appointment_id),t.createElement("div",null,t.createElement("h4",{className:"bw-mb-1"},null==(o=e.service)?void 0:o.name),t.createElement("span",{className:"bw-text-sm bw-text-gray-500"},c&&m&&`${d.agent}: ${c.first_name} ${c.last_name}, ${m&&`${d.customer}: ${m.first_name} ${m.last_name}`}`)))):t.createElement(F,null,"No Matched Appointment found!"))}function He(e){if(!e)return null;let t=e.trim();if(t.startsWith("#")){t=t.substring(1);const e=parseInt(t);return Number.isNaN(e)?null:{type:"appointment",search:e}}return{type:"record",search:t}}const Ve=i.styled.div("bw-py-3 bw-flex bw-items-center bw-gap-4 bw-px-4 bw-text-base bw-text-gray-500"),qe=i.styled.span("bw-text-gray-500"),ze=i.styled.span("bw-text-gray-800");function Ke(){return t.createElement(t.Fragment,null,t.createElement(Ve,null,t.createElement(r.ListCheck,{className:"bw-h-5 bw-w-5"}),t.createElement(qe,null,"Appointment search e.g:"),t.createElement(ze,null,"#123")),t.createElement(Ve,null,t.createElement(r.Box,{className:"bw-h-5 bw-w-5"}),t.createElement(qe,null,b.sprintf(b.__("%(service)s search e.g:","bookster"),d)),t.createElement(ze,null,b.sprintf(b.__("%(service)s name","bookster"),d))),t.createElement(Ve,null,t.createElement(r.SquareUser,{className:"bw-h-5 bw-w-5"}),t.createElement(qe,null,b.sprintf(b.__("%(customer)s or %(agent)s search e.g:","bookster"),d)),t.createElement(ze,null,"Jeremy")),t.createElement(Ve,null,t.createElement(r.Phone,{className:"bw-mx-0.5 bw-h-[16px] bw-w-[16px]",strokeWidth:"1.5"}),t.createElement(qe,null,b.sprintf(b.__("%(customer)s or %(agent)s phone search e.g:","bookster"),d)),t.createElement(ze,null,"0123")))}function Ge(){return t.createElement(Ve,null,t.createElement(r.ListCheck,{className:"bw-h-5 bw-w-5"}),t.createElement(qe,null,"Appointment search e.g:"),t.createElement(ze,null,"#123"))}function Ue({value:e,onChange:a,className:n,...l}){const[o,s]=m.useState(!1),u=(null==e?void 0:e[0])||null,w=c.useAllAgents(),p=c.useActiveAgents(),f=m.useMemo((()=>{const e=u?w.find((e=>e.agent_id===u)):null;return e?t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(i.Avatar,{className:"bw-h-5 bw-w-5"},t.createElement(i.AvatarImage,{src:e.transient_avatar_url}),t.createElement(i.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),t.createElement("span",null,`${e.first_name} ${e.last_name}`))):t.createElement("span",{role:"placeholder"},b.__("Select","bookster")," ",d.agent)}),[u,w]);return t.createElement(i.Combobox,{open:o,onOpenChange:s},t.createElement(i.ComboboxTrigger,{className:n,...l},t.createElement("span",{className:"bw-overflow-hidden"},f),t.createElement(i.ComboboxIcon,null)),t.createElement(i.ComboboxPortalContent,{className:"bw-w-[var(--radix-popover-trigger-width)] bw-p-0 bw-shadow-md",side:"bottom"},t.createElement(i.Command,{loop:!0},t.createElement(i.CommandInput,{placeholder:"Search"}),t.createElement(i.CommandList,null,t.createElement(i.CommandEmpty,null,b.sprintf(b.__("No %(agents)s found.","bookster"),d)),t.createElement(i.CommandGroup,null,p.map((e=>t.createElement(i.ComboboxItem,{key:e.agent_id,value:`${e.agent_id}`,isActive:u===e.agent_id,keywords:[e.first_name,e.last_name,e.email,e.phone],onSelect:()=>{return t=e.agent_id,a&&a([t]),void s(!1);var t}},t.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(i.Avatar,{className:"bw-h-6 bw-w-6"},t.createElement(i.AvatarImage,{src:e.transient_avatar_url}),t.createElement(i.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),t.createElement("span",null,`${e.first_name} ${e.last_name}`)),t.createElement(i.ComboboxItemIcon,null)))))))))}function We(e){return t.createElement(i.Select,{...e},t.createElement(i.SelectTrigger,{size:"large",className:"bw-ps-2.5 [&>span]:bw-justify-start"},t.createElement(i.SelectValue,null)),t.createElement(i.SelectContent,null,t.createElement(i.SelectGroup,null,t.createElement(Qe,{value:"pending"},t.createElement(r.Pending,{className:"bw-text-warning"})," ",w("pending")),t.createElement(Qe,{value:"approved"},t.createElement(r.CheckCircle,{className:"bw-text-success"})," ",w("approved")),t.createElement(Qe,{value:"canceled"},t.createElement(r.XCircle,{className:"bw-text-error"})," ",w("canceled")))))}function Qe(e){return t.createElement(i.SelectItem,{className:"[&>span]:bw-justify-start",...e})}function Ze({value:e,onChange:a,...n}){const[r,l]=m.useState(!1),o=e||null,s=c.useAllServices(),u=c.useActiveServices(),w=m.useMemo((()=>{const e=o?s.flatMap((e=>e.services)).find((e=>e.service_id===o)):null;return e?e.name:t.createElement("span",{role:"placeholder"},b.sprintf(b.__("Select a %(service)s name","bookster"),d))}),[o,s]);return t.createElement(i.Combobox,{open:r,onOpenChange:l},t.createElement(i.ComboboxTrigger,{...n},t.createElement("span",{className:"bw-truncate"},w),t.createElement(i.ComboboxIcon,null)),t.createElement(i.ComboboxPortalContent,{className:"bw-w-[var(--radix-popover-trigger-width)] bw-p-0 bw-shadow-md",side:"bottom"},t.createElement(i.Command,{loop:!0},t.createElement(i.CommandInput,{placeholder:"Search"}),t.createElement(i.CommandList,null,t.createElement(i.CommandEmpty,null,b.sprintf(b.__("No %(services)s found.","bookster"),d)),u.map((e=>t.createElement(i.CommandGroup,{key:e.service_category_id,heading:e.name,className:"[&_[cmdk-item]]:bw-pl-5"},e.services.map((e=>t.createElement(i.ComboboxItem,{key:e.service_id,value:e.name,isActive:o===e.service_id,onSelect:()=>{return t=e.service_id,a&&a(t),void l(!1);var t}},e.name,t.createElement(i.ComboboxItemIcon,null)))))))))))}async function Ye(e){return await c.api.get(`customers/${e}`).json()}async function Je(e){return await c.api.post("customers",{json:e}).json()}async function Xe(e,t){return await c.api.patch(`customers/${e}`,{json:t}).json()}async function et(e,t){return await c.api.patch(`customers/${e}/link-wp-user`,{json:{email:t}}).json()}async function tt(e){return await c.api.patch(`customers/${e}`,{json:{wp_user_id:null}}).json()}async function at(e){return await c.api.delete(`customers/${e}`).json()}async function nt(e){if(0!==await c.api.patch("customers/count",{json:{email:e}}).json())throw new Error(b.sprintf(b.__("%(customer)s with this email already exists!","bookster"),d))}async function rt(e){return await c.api.delete("customers/bulk-action",{json:{ids:e}}).json()}function lt({value:e,onChange:a,className:n,...l}){const[o,s]=m.useState(!1),{setNestedCustomer:u}=_.useApptFormLogic(),[d,w]=m.useState(""),p=i.useDebounce(d,{wait:300}),f=e||null,E=c.useQueryClient(),{data:g}=c.useQuery(["customers",f],(async()=>f?await Ye(f):null)),{data:h,isFetching:v,isSuccess:y}=c.useQuery({queryKey:["customers",{keywords:p}],queryFn:async()=>p?await c.queryCustomers({keywords:p,limit:10}):await c.queryCustomers({limit:10}),keepPreviousData:!0}),k=[...g&&!((null==h?void 0:h.data)??[]).some((e=>e.customer_id===g.customer_id))?[g]:[],...(null==h?void 0:h.data)??[]],N=y&&0===k.length,x=m.useMemo((()=>f?t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},t.createElement(i.Avatar,{className:"bw-h-5 bw-w-5"},t.createElement(i.AvatarImage,{src:null==g?void 0:g.transient_avatar_url}),t.createElement(i.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),t.createElement("span",null,g?`${g.first_name} ${g.last_name}`:`Customer #${f}`))):t.createElement("span",{role:"placeholder"},b.__("Select Customer","bookster"))),[f,g]);return t.createElement(i.Combobox,{open:o,onOpenChange:s},t.createElement(i.ComboboxTrigger,{size:"large",className:n,...l},t.createElement("span",{className:"bw-overflow-hidden"},x),t.createElement(i.ComboboxIcon,null)),t.createElement(i.ComboboxPortalContent,{className:"bw-w-[var(--radix-popover-trigger-width)] bw-p-0 bw-shadow-md",side:"bottom",align:"start"},t.createElement(i.Command,{...f?{defaultValue:`${f}`}:{},loop:!0,shouldFilter:!1},t.createElement(i.CommandInput,{placeholder:"Search",className:"bw-px-4 [&_[cmdk-input]]:bw-h-11 [&_[cmdk-input]]:bw-ps-8",value:d,onValueChange:w,isFetching:v}),t.createElement(i.CommandList,null,t.createElement(i.CommandGroup,{className:"bw-pt-2"},t.createElement(i.ComboboxItem,{className:"bw-px-2 bw-py-2 bw-text-gray-500 aria-selected:bw-text-primary",value:"create-new",onSelect:()=>{u(["new"]),s(!1)}},t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2.5 bw-overflow-x-hidden"},t.createElement("div",{className:"bw-inline-flex bw-h-6 bw-w-6 bw-items-center bw-justify-center bw-rounded-full bw-border bw-border-dashed bw-border-current"},t.createElement(r.Plus,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})),t.createElement("span",null,b.__("Create New","bookster")))),t.createElement(i.Separator,{className:"bw-mb-0 bw-mt-2"})),t.createElement(i.CommandGroup,null,N&&t.createElement("div",{className:"bw-py-6 bw-text-center bw-text-gray-500"},"No Customers found."),k.map((e=>t.createElement(i.ComboboxItem,{key:e.customer_id,value:`${e.customer_id}`,isActive:f===e.customer_id,className:"bw-px-2 bw-py-2",keywords:[e.first_name,e.last_name,e.email,e.phone],onSelect:()=>(e=>{E.setQueryData(["customers",e.customer_id],e),a&&a(e.customer_id),s(!1)})(e)},t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2.5 bw-overflow-x-hidden"},t.createElement(i.Avatar,{className:"bw-h-6 bw-w-6"},t.createElement(i.AvatarImage,{src:e.transient_avatar_url}),t.createElement(i.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),t.createElement("div",{className:"bw-leading-tight"},t.createElement("span",{className:"bw-text-nowrap"},`${e.first_name} ${e.last_name}`),t.createElement("br",null),t.createElement("span",{className:"bw-text-xs bw-font-normal bw-text-gray-500 group-data-[active=true]:bw-text-gray-800"},e.phone,t.createElement("span",{className:"bw-px-2 bw-text-gray-500/30"},"•"),e.email))),t.createElement(i.ComboboxItemIcon,null)))))))))}const ot=i.stylex.div("bw-w-[3px] bw-h-[11px] bw-bg-primary"),st=i.stylex.h4("bw-mb-2 bw-text-sm bw-leading-none bw-font-medium bw-text-gray-900 bw-uppercase bw-flex bw-items-center bw-gap-2"),ct=m.createContext(void 0);function it({value:e,onChange:a,...n}){const r=e??0;return t.createElement(i.InputNumber,{precision:c.NUMBER_OF_DECIMALS,decimalSeparator:c.DECIMAL_SEPARATOR,min:0,step:5,value:r,onChange:e=>{a&&a(e)},"data-negative":r<0,...n})}const mt={booking:{items:[],subtotal:p.ZERO},adjustment:{items:[],subtotal:p.ZERO},tax:{items:[],total:p.ZERO}};function ut(){const e=m.useContext(ct);if(!e)throw new Error("BookingDetailsEditorContext.Provider is missing!");return e}function bt({value:e,onChange:a}){const n=e||mt.adjustment,l=e=>{null==a||a(e)},{isDetailsLoading:o,isDetailsDisabled:s,onChangeAdjustment:u}=ut(),b=m.useRef(void 0);return m.useEffect((()=>{if(b.current){const e=document.getElementById(`adjustment-${b.current}-title`);e&&(e.focus(),b.current=void 0)}}),[n]),o?null:t.createElement(t.Fragment,null,n.items.map((e=>t.createElement(m.Fragment,{key:e.id},t.createElement("div",{className:"bw-col-span-1 bw-mb-2 bw-flex bw-items-center bw-gap-x-2"},t.createElement(r.MinusCircle,{className:"bw-h-5 bw-w-5 bw-cursor-pointer bw-text-gray-500/40 hover:bw-text-gray-500",onClick:()=>function(e){const t={...n};t.items=t.items.filter((t=>t.id!==e)),l(t),u()}(e.id)}),t.createElement(i.Input,{withStatus:!1,id:`adjustment-${e.id}-title`,size:"small",className:"bw-w-[calc(100%+0.25rem)]",disabled:s,value:e.title,onChange:t=>n&&function(e,t){const a={...n};a.items=a.items.map((a=>a.id===e?{...a,title:t}:a)),l(a)}(e.id,t.target.value)})),t.createElement("div",{className:"bw-relative bw-col-span-1 bw-mb-2 bw-text-right"},t.createElement(i.InputPrefix,{className:"bw-text-base bw-font-medium bw-text-gray-500"},c.CURRENCY_SYMBOL),t.createElement(it,{className:"bw-w-[calc(100%+0.25rem)] bw-ps-6",size:"small",align:"right",min:void 0,disabled:s,value:e.amount.numberValue,onChange:t=>function(e,t){const a={...n};a.items=a.items.map((a=>a.id===e?{...a,formula:["fixed",t]}:a)),l(a),u()}(e.id,t||0)}))))),t.createElement(wt,{align:"center",key:"add-adjustment",className:"bw-col-span-full bw-my-0 bw-gap-0"},t.createElement(pt,{className:"bw-border-b bw-border-dashed bw-border-gray-300 bw-bg-transparent"}),t.createElement(dt,{asChild:!0},t.createElement(i.Button,{variant:"outline",className:"bw-h-[21px] bw-rounded-full bw-border-dashed bw-bg-white bw-px-1.5 bw-text-xs bw-leading-none bw-text-primary hover:bw-text-primary/80",onClick:function(){const e=c.genUniqueId(),t={...n};t.items=[...t.items,{id:e,title:"",formula:["fixed",0],amount:p.ZERO}],b.current=e,l(t),u()}},"+ Adjust")),t.createElement(ft,{className:"bw-border-b bw-border-dashed bw-border-gray-300 bw-bg-transparent"})))}const{Middle:dt,Root:wt,Before:pt,After:ft}=i.SectionSeparator;function Et(){const{name:e,isDetailsLoading:a}=ut(),n=f.Form.useFormInstance(),r=f.Form.useWatch([...e,"booking_details","tax","total"],n),l=f.Form.useWatch([...e,"paid_amount"],n),o=f.Form.useWatch([...e,"payment_status"],n),s=r&&l?r.subtract(l):p.ZERO;return a||"incomplete"!==o?null:t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-mb-2 bw-flex bw-items-center bw-font-medium"},b.__("Balance Due","bookster")),t.createElement("div",{className:"bw-relative bw-mb-2"},t.createElement(i.InputPrefix,{className:"bw-text-base bw-font-medium bw-text-gray-500"},c.CURRENCY_SYMBOL),t.createElement(it,{size:"small",align:"right",style:{paddingBottom:"0"},className:"bw-pointer-events-none bw-w-full bw-select-none bw-border-transparent bw-bg-gray-100 bw-ps-6 bw-font-medium [&_input]:!bw-bg-gray-100",min:0,readOnly:!0,value:s.numberValue})))}function gt({value:e}){const a=e||mt.booking,{isDetailsLoading:n}=ut();return n?null:t.createElement(t.Fragment,null,a.items.map((e=>t.createElement(m.Fragment,{key:e.id},t.createElement("div",{className:"bw-col-span-1 bw-mb-2 bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap"},e.title," (",e.quantity," x ",c.formatPrice(e.unitPrice),")"),t.createElement("div",{className:"bw-col-span-1 bw-mb-1 bw-text-right"},c.formatPrice(e.amount))))),t.createElement("div",{key:"bottom-space",className:"bw-col-span-full bw-mb-2"}))}window.booksterPublicData.paymentSettings.currency;const ht=window.booksterPublicData.paymentSettings.currency_symbol;function vt(){const{apptId:e}=c.useParams();return isNaN(Number(e))?null:Number(e)}function yt(){var e;const a=vt(),{name:n,isDetailsLoading:l}=ut(),o=f.Form.useFormInstance(),s=f.Form.useWatch([...n,"customer_id"],o),{data:i}=c.useQuery({queryKey:["appointment",a,"details"],enabled:!1}),m=null==(e=null==i?void 0:i.transactions)?void 0:e.find((e=>e.customer_id===s));return l||!m?null:t.createElement(E,{target:"_blank",href:m.transaction_link},t.createElement("span",{className:"bw-me-1 bw-inline-flex bw-items-center bw-gap-1.5 bw-capitalize"},"Via ",function(e){switch(e){case"payment-stripe":return"Stripe";case"payment-paypal":return"PayPal";default:return""}}(m.payment_gateway),t.createElement(r.ExternalLink,{className:"bw-mb-0.5 bw-h-3.5 bw-w-3.5"})))}function _t({value:e,onChange:a}){const n=e||p.ZERO,r=f.Form.useFormInstance(),{isDetailsLoading:l,isDetailsDisabled:o,name:s}=ut(),c=f.Form.useWatch([...s,"payment_status"],r);return l||"incomplete"!==c?null:t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-mb-2 bw-flex bw-items-center bw-justify-between"},b.__("Total Paid","bookster"),"incomplete"===c&&t.createElement(yt,null)),t.createElement("div",{className:"bw-relative bw-mb-2"},t.createElement(i.InputPrefix,{className:"bw-text-base bw-font-medium bw-text-gray-500"},ht),t.createElement(it,{size:"small",align:"right",className:"bw-w-full bw-ps-6",style:{paddingBottom:"0"},min:0,disabled:o,value:n.numberValue,onChange:e=>{return t=p.Decimal.fromNumber(e||0),void(null==a||a(t));var t}})))}function kt({value:e,onChange:a}){const n=e||"incomplete",{editMode:r}=_.useApptFormLogic(),{isDetailsLoading:l,isDetailsDisabled:o,onChangePaymentStatus:s}=ut();return l?null:t.createElement(t.Fragment,null,t.createElement(i.Separator,{className:"bw-col-span-full bw-mx-0 bw-mb-4 bw-mt-2 bw-w-auto bw-bg-gray-300"}),t.createElement("div",{className:"bw-mb-2 bw-flex bw-items-center bw-justify-between"},b.__("Payment Status","bookster"),"incomplete"!==n&&t.createElement(yt,null)),t.createElement("div",{className:"bw-mb-2"},t.createElement(i.Select,{disabled:o,value:n,onValueChange:e=>{null==a||a(e),s()}},t.createElement(i.SelectTrigger,{size:"small",className:"bw-h-[30px] bw-ps-3",withStatus:!1},t.createElement(i.SelectValue,null)),t.createElement(i.SelectContent,null,t.createElement(i.SelectItem,{value:"complete"},g("complete")),t.createElement(i.SelectItem,{value:"incomplete"},g("incomplete")),t.createElement(i.SelectItem,{value:"refunded",disabled:"new"===r},g("refunded"))))))}function Nt({value:e}){const a=e||mt.tax,n=f.Form.useFormInstance(),{isDetailsLoading:r,name:l}=ut(),o=f.Form.useWatch([...l,"booking_details","adjustment","subtotal"],n);if(r)return null;const s=a.items.length>0;return t.createElement(t.Fragment,null,t.createElement("div",{key:"top-space",className:"bw-col-span-full bw-mb-1"}),s&&t.createElement(m.Fragment,{key:"subtotal-booking"},t.createElement("div",{className:"bw-mb-2"},"Subtotal"),t.createElement("div",{className:"bw-mb-2 bw-text-right"},c.formatPrice(o||p.ZERO))),a.items.map((e=>t.createElement(m.Fragment,{key:e.id},t.createElement("div",{className:"bw-mb-2 bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap"},e.title),t.createElement("div",{className:"bw-mb-2 bw-text-right"},c.formatPrice(e.amount))))),t.createElement(m.Fragment,{key:"total"},t.createElement("div",{className:"bw-text-base bw-font-medium"},"Total"),t.createElement("div",{className:"bw-text-right bw-text-base"},c.formatPrice(a.total||0))))}function xt({name:e,headingVariant:a="inner"}){const{editMode:n,roleMode:l}=_.useApptFormLogic(),{selectedService:o}=_.useSelectedService(),s=null===o,c="disabled"===l,{reloadRecalculateBookingDetails:u,onChangeBooking:w,onChangeAdjustment:p,onChangeTax:E,onChangePaymentStatus:g}=function(e){const t=f.Form.useFormInstance(),{recalculatedPayment:a,reloadRecalculateBookingDetails:n}=_.useBookingRecalculate(e);function r(){return t.getFieldValue([...e,"booking_details"])}return{reloadRecalculateBookingDetails:n,onChangeBooking:function(){const n=r(),l=_.calculateDetails(n);t.setFieldValue([...e,"booking_details"],l),a(l.tax.total)},onChangeAdjustment:function(){const n=r(),l=n.booking,o=_.calculateAdjustment(n.adjustment,l.subtotal),s={booking:l,adjustment:o,tax:_.calculateTax(n.tax,o.subtotal)};t.setFieldValue([...e,"booking_details"],s),a(s.tax.total)},onChangeTax:function(){const n=r(),l=n.booking,o=n.adjustment,s={booking:l,adjustment:o,tax:_.calculateTax(n.tax,o.subtotal)};t.setFieldValue([...e,"booking_details"],s),a(s.tax.total)},onChangePaymentStatus:function(){const e=r();a(e.tax.total)}}}(e);return t.createElement(ct.Provider,{value:{name:e,isDetailsLoading:s,isDetailsDisabled:c,onChangeBooking:w,onChangeAdjustment:p,onChangeTax:E,onChangePaymentStatus:g}},"outer"===a&&t.createElement("div",{className:"bw-mb-2 bw-mt-4 bw-flex bw-items-center bw-justify-between"},t.createElement(st,{className:"bw-mb-0"},t.createElement(ot,null)," ",b.__("Booking Detail","bookster")),t.createElement(i.Button,{variant:"link",className:"bw-h-auto bw-gap-1.5 bw-py-0 bw-font-normal",onClick:()=>u(),disabled:s||c},t.createElement(r.RefreshCw,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})," ",b.__("Recalculate","bookster"))),s&&t.createElement(m.Fragment,{key:"details-skeleton"},t.createElement("div",{className:"bw-my-3 bw-flex-none bw-rounded-theme bw-bg-gray-50 bw-px-5 bw-py-4 bw-text-gray-500"},t.createElement(st,{className:"bw-mb-1"},b.__("Booking Detail","bookster")),t.createElement("span",{className:"bw-text-xs bw-leading-none"},"new"===n&&b.sprintf(b.__("Please select a %(service)s name","bookster"),d),"edit"===n&&"Details is Loading..."))),t.createElement("div",{className:i.clsx("bw-my-3 bw-grid bw-gap-x-2 bw-rounded-theme bw-bg-gray-50 bw-px-5 bw-pb-2 bw-pt-4",s&&"bw-hidden"),style:{gridTemplateColumns:"8fr 3fr"}},"inner"===a&&t.createElement("div",{className:"bw-col-span-full bw-mb-2 bw-flex bw-items-center bw-justify-between"},t.createElement(st,{className:"bw-mb-0"},b.__("Booking Detail","bookster")),t.createElement(i.Button,{variant:"link",className:"bw-h-auto bw-gap-1.5 bw-py-0 bw-font-normal",onClick:()=>u(),disabled:s||c},t.createElement(r.RefreshCw,{strokeWidth:"2",className:"bw-h-3 bw-w-3"})," ",b.__("Recalculate","bookster"))),t.createElement(f.Form.Item,{name:[...e,"booking_details","booking"],noStyle:!0},t.createElement(gt,null)),t.createElement(f.Form.Item,{name:[...e,"booking_details","adjustment"],noStyle:!0},t.createElement(bt,null)),t.createElement(f.Form.Item,{name:[...e,"booking_details","tax"],noStyle:!0},t.createElement(Nt,null)),t.createElement(f.Form.Item,{name:[...e,"payment_status"],noStyle:!0},t.createElement(kt,null)),t.createElement(f.Form.Item,{name:[...e,"paid_amount"],noStyle:!0},t.createElement(_t,null)),t.createElement(Et,null)))}function Ct({customerId:e}){const{data:a}=c.useQuery({queryKey:["customers",e],queryFn:async()=>e?await async function(e){return await c.api.get(`customers/${e}`).json()}(e):null,enabled:!1});return a?t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},t.createElement(i.Avatar,{className:"bw-h-5 bw-w-5"},t.createElement(i.AvatarImage,{src:null==a?void 0:a.transient_avatar_url}),t.createElement(i.AvatarFallback,{className:"bw-text-xs"},t.createElement(r.User,{className:"bw-h-3 bw-w-3"}))),t.createElement("span",null,`${a.first_name} ${a.last_name}`)):t.createElement(t.Fragment,null,`ID: ${e}`)}function St({bookings:e}){return t.createElement("div",{className:"bw-grid bw-gap-x-4"},t.createElement(f.Form.Item,{name:"bookings",hidden:!0},t.createElement(x,null)),t.createElement(f.Form.Item,{className:"bw-col-span-full",style:{marginBottom:"0.5rem"},label:d.customers},t.createElement(i.Button,{variant:"trivial",size:"large",disabled:!0,className:i.clsx("bw-relative bw-w-full bw-justify-between bw-pe-8 bw-ps-3 hover:!bw-text-inherit")},"Activate Group Booking addon to add multiple customers")),t.createElement("span",{className:"bw-mb-2 bw-text-xs bw-italic bw-text-gray-500"},"Selected Customers"),t.createElement("table",{className:"bw-border-collapse"},t.createElement("tbody",null,e.map((e=>e.customer_id?t.createElement("tr",{key:e.customer_id,className:"bw-border-b bw-border-gray-100 [&>td]:bw-px-1 [&>td]:bw-py-2"},t.createElement("td",null,t.createElement(Ct,{customerId:e.customer_id})),t.createElement("td",null,c.formatPrice(e.booking_details.tax.total)),t.createElement("td",{className:"bw-w-24 bw-capitalize"},e.payment_status)):null)))))}function Ft(){const{editMode:e,roleMode:a}=_.useApptFormLogic(),n=_.useBookingsValue(),r=1!==n.length,l=r?null:n[0].customer_id,{data:o}=c.useQuery(["customers",l],(async()=>l?await Ye(l):null));return r?t.createElement(St,{bookings:n}):t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},t.createElement(f.Form.Item,{className:"bw-col-span-full",name:["bookings",0,"customer_id"],label:d.customer,rules:[{required:!0}]},t.createElement(lt,{disabled:"manager"!==a})),t.createElement(f.Form.Item,{label:"Phone",required:!0},t.createElement(i.Input,{size:"large",disabled:!0,value:null==o?void 0:o.phone})),t.createElement(f.Form.Item,{label:"Email",required:!0},t.createElement(i.Input,{size:"large",disabled:!0,value:null==o?void 0:o.email})),"edit"===e&&t.createElement(f.Form.Item,{key:"customer-note",className:"bw-col-span-full",name:["bookings",0,"customer_note"],label:"Customer Note"},t.createElement(i.Textarea,{rows:2}))),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(40%, 1fr))"}},h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.BeforeSingleBookingsEditor,[],["bookings",0])),t.createElement(xt,{name:["bookings",0]}),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.AfterSingleBookingsEditor,[],["bookings",0])))}function At(){const{roleMode:e,apptForm:a}=_.useApptFormLogic(),n=c.useAllServices();return t.createElement("div",{className:"bw-static bw-flex bw-min-h-full bw-flex-col bw-pt-3"},t.createElement("div",{className:"bw-grid bw-gap-x-4"},t.createElement(i.FormItem,{name:"service_id",className:"bw-overflow-auto",label:d.service,tooltip:b.sprintf(b.__("Select a %(service)s to begin edit datetime, price, payment...","bookster"),d),rules:[{required:!0,message:b.__("Please select a service","bookster")}]},t.createElement(Ze,{autoFocus:!0,onChange:e=>async function(e){const t=A(n,e);if(!t)throw new Error(b.sprintf(b.__("Invalid %(service)s id","bookster"),d));const r=a.getFieldValue("start_time")?a.getFieldValue("start_time").absMinute:0;a.setFieldsValue({buffer_before:t.buffer_before,buffer_after:t.buffer_after,start_time:c.bookHelper.booktime.createFromAbsMinute(r),end_time:c.bookHelper.booktime.createFromAbsMinute(r+t.duration)}),h.booksterHooks.doAction(h.HOOK_NAMES.adminApptForm.doChangeService,a,t),function(e){const t=a.getFieldsValue();t.bookings.forEach(((n,r)=>{const l=h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.detailsReloadBookingValue,{items:[_.makeBasicItem(e)],subtotal:p.ZERO},t,n),o={...n.booking_details,booking:l},s=_.calculateDetails(o);a.setFieldValue(["bookings",r,"booking_details"],s);const c={paid_amount:n.paid_amount,payment_status:n.payment_status},{paid_amount:i,payment_status:m}=_.calculatePayment(c,s.tax.total);a.setFieldValue(["bookings",r,"paid_amount"],i),a.setFieldValue(["bookings",r,"payment_status"],m)}))}(t)}(e),disabled:"manager"!==e})),h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.AfterService,[])),t.createElement("div",{className:"bw-grid bw-gap-x-4"},t.createElement(f.Form.Item,{label:d.agent,name:"agent_ids",rules:[{required:!0}]},t.createElement(Ue,{disabled:"manager"!==e})),h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.AfterAgent,[])),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},t.createElement(f.Form.Item,{label:b.__("Book Date","bookster"),name:"book_date",rules:[{required:!0}]},t.createElement(i.DatePicker,{className:"bw-w-full",disabled:"disabled"===e,format:c.DATE_TEMPLATE})),t.createElement(f.Form.Item,{label:b.__("Book Status","bookster"),name:"book_status",rules:[{required:!0}],trigger:"onValueChange"},t.createElement(We,{disabled:"disabled"===e})),t.createElement(f.Form.Item,{label:b.__("Book Time","bookster"),name:"start_time",rules:[{required:!0}]},t.createElement(i.BookTimePicker,{className:"bw-w-full",disabled:"disabled"===e,placeholder:"Book Time",onChange:e=>{e&&async function(e){const t=a.getFieldValue("service_id");if(!t)return;const r=A(n,t);if(!r)throw new Error(b.sprintf(b.__("Invalid %(service)s id","bookster"),d));a.setFieldsValue({end_time:c.bookHelper.booktime.createFromAbsMinute(e.absMinute+r.duration)}),a.validateFields(["end_time"])}(e)}})),t.createElement(f.Form.Item,{className:"bw-w-full",label:b.__("End Time","bookster"),name:"end_time",dependencies:["start_time"],rules:[{validator:function(e,t){if(!t)return Promise.resolve();const n=a.getFieldValue("start_time");return n&&t.absMinute<n.absMinute?Promise.reject("End Time must be after Start Time"):Promise.resolve()}}]},t.createElement(i.BookTimePicker,{className:"bw-w-full",placeholder:b.__("End Time","bookster"),disabled:"disabled"===e})),t.createElement(i.FormItem,{name:"buffer_before",label:b.__("Buffer Before","bookster"),tooltip:b.__("Buffer time to prepare before the appointment start.","bookster")},t.createElement(i.InputNumber,{min:0,className:"bw-w-full",formatter:e=>`${e||0} mins`,parser:e=>null==e?void 0:e.replace(/\D/g,""),step:v(),disabled:"disabled"===e})),t.createElement(i.FormItem,{name:"buffer_after",label:b.__("Buffer After","bookster"),tooltip:b.__("Buffer time to rest/clean after the appointment end.","bookster")},t.createElement(i.InputNumber,{min:0,className:"bw-w-full",formatter:e=>`${e||0} mins`,parser:e=>null==e?void 0:e.replace(/\D/g,""),step:v(),disabled:"disabled"===e})),h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.AfterDatetime,[])),h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.BookingsEditor,t.createElement(Ft,null)),t.createElement("div",{className:"bw-h-3 bw-flex-none"}))}function It(e){const{data:t}=c.useQuery(["customers",e],(async()=>e?await Ye(e):null));return t}function Pt({customerId:e}){const{editMode:a}=_.useApptFormLogic(),n=It(e),r=h.booksterHooks.hasFilter(h.HOOK_NAMES.adminApptForm.AdditionalBookingFields),l=h.booksterHooks.hasFilter(h.HOOK_NAMES.adminApptForm.MoreBookingFields);return t.createElement(t.Fragment,null,t.createElement("div",null,t.createElement(st,{className:"bw-my-2"},t.createElement(ot,null)," ",b.__("Information","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},t.createElement(f.Form.Item,{name:"customer_id",hidden:!0},t.createElement(x,null)),t.createElement(f.Form.Item,{label:"Phone",required:!0},t.createElement(i.Input,{size:"large",disabled:!0,value:null==n?void 0:n.phone})),t.createElement(f.Form.Item,{label:"Email",required:!0},t.createElement(i.Input,{size:"large",disabled:!0,value:null==n?void 0:n.email})),"edit"===a&&t.createElement(f.Form.Item,{key:"customer-note",className:"bw-col-span-full",name:"customer_note",label:"Customer Note"},t.createElement(i.Textarea,{rows:2}))),r&&t.createElement(t.Fragment,null,t.createElement(st,{className:"bw-mb-2 bw-mt-4"},t.createElement(ot,null)," ",b.__("Additional","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.AdditionalBookingFields,[],[]))),t.createElement(xt,{name:[],headingVariant:"outer"}),l&&t.createElement(t.Fragment,null,t.createElement(st,{className:"bw-mb-2 bw-mt-4"},t.createElement(ot,null)," ",b.__("More","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4"},h.booksterHooks.applyFilters(h.HOOK_NAMES.adminApptForm.MoreBookingFields,[],[])))))}function Mt(){const{apptForm:e,nestedBooking:a,setNestedBooking:n}=_.useApptFormLogic(),[,l]=a;if(!l||!l.customer_id)throw new Error("Booking Form is not initiated properly");const o=vt(),s=It(l.customer_id);return t.createElement(t.Fragment,null,t.createElement(i.DrawerHeader,null,t.createElement(i.DrawerTitle,null,`${null==s?void 0:s.first_name} ${null==s?void 0:s.last_name}`," ",o&&t.createElement(i.Badge,{color:"base",variant:"fill",className:"bw-font-medium bw-tracking-wide"},`#${o}`)),t.createElement(i.DrawerCloseIcon,null)),t.createElement(C,null,t.createElement(f.Form,{name:"bookingForm",initialValues:l,layout:"vertical",scrollToFirstError:!0,onFinish:function(t){const a=e.getFieldValue(["bookings"]);e.setFieldsValue({bookings:a.map((e=>e.customer_id===t.customer_id?t:e))}),n(["close"])}},t.createElement(Pt,{customerId:l.customer_id}))),t.createElement(i.DrawerFooter,null,t.createElement(i.Button,{key:"more",variant:"trivial",size:"icon",className:"bw-me-auto bw-h-9 bw-w-9",onClick:function(){if(!(null==l?void 0:l.customer_id))return;const t=e.getFieldValue(["bookings"]);e.setFieldsValue({bookings:t.filter((e=>e.customer_id!==l.customer_id))}),n(["close"])}},t.createElement(r.Trash,null)),t.createElement(i.DrawerClose,{asChild:!0},t.createElement(i.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},b.__("Back","bookster"))),t.createElement(i.Button,{key:"submit",type:"submit",form:"bookingForm",size:"large",className:"bw-min-w-[7rem]"},b.__("Save","bookster"))))}function Dt(){const{apptForm:e,nestedBooking:a,setNestedBooking:n}=_.useApptFormLogic(),[,r]=a;if(!r||!r.customer_id)throw new Error("Booking Form is not initiated properly");const l=It(r.customer_id);return t.createElement(t.Fragment,null,t.createElement(i.DrawerHeader,null,t.createElement(i.DrawerTitle,null,`${null==l?void 0:l.first_name} ${null==l?void 0:l.last_name}`),t.createElement(i.DrawerCloseIcon,null)),t.createElement(C,null,t.createElement(f.Form,{name:"bookingForm",initialValues:r,layout:"vertical",scrollToFirstError:!0,onFinish:async function(t){const a=e.getFieldValue(["bookings"]);0===a.length||1===a.length&&null===a[0].customer_id?e.setFieldsValue({bookings:[t]}):e.setFieldsValue({bookings:[...a,t]}),n(["close"])}},t.createElement(Pt,{customerId:r.customer_id}))),t.createElement(i.DrawerFooter,null,t.createElement(i.DrawerClose,{asChild:!0},t.createElement(i.Button,{key:"back",tabIndex:-1,variant:"soft",size:"large",className:"bw-min-w-[7rem]"},b.__("Back","bookster"))),t.createElement(i.Button,{key:"submit",type:"submit",form:"bookingForm",size:"large",className:"bw-min-w-[7rem]"},b.__("Save","bookster"))))}function Bt(){const{nestedBooking:e,setNestedBooking:a}=_.useApptFormLogic(),[n]=e;return t.createElement(i.Drawer,{open:"close"!==n,onOpenChange:e=>{e||a(["close"])}},t.createElement(i.DrawerPortal,null,t.createElement(i.DrawerClose,{asChild:!0},t.createElement(i.DrawerOverlay,{className:"bw-bg-transparent"})),t.createElement(i.DrawerContent,{className:"bw-w-[36rem]"},"close"===n&&t.createElement(S,null),"new"===n&&t.createElement(Dt,null),"edit"===n&&t.createElement(Mt,null))))}window.booksterPublicData.paymentSettings.currency_position,window.booksterPublicData.paymentSettings.thousand_separator,window.booksterPublicData.paymentSettings.decimal_separator,window.booksterPublicData.paymentSettings.number_of_decimals;const Ot=t.forwardRef((({tooltip:e,children:a,...n},r)=>t.createElement(i.SidebarMenuItem,null,t.createElement(c.NavLink,{className:"bw-no-underline",...n},(({isActive:n})=>t.createElement(i.SidebarMenuButton,{ref:r,tooltip:e,isActive:n},a))))));function $t({children:e}){return t.createElement(i.HoverCard,{openDelay:100,closeDelay:100},t.createElement(i.SidebarMenuItem,null,e))}const jt=t.forwardRef((({children:e,...a},n)=>t.createElement(i.HoverCardTrigger,{asChild:!0,className:"bw-group/hovercard"},t.createElement("div",null,t.createElement(c.NavLink,{className:"bw-no-underline",...a},(({isActive:a})=>t.createElement("div",null,t.createElement(i.SidebarMenuButton,{ref:n,isActive:a},e),t.createElement(i.SidebarMenuAction,{className:"bw-pointer-events-none",asChild:!0},t.createElement(r.ChevronRight,{className:"bw-h-2.5 bw-w-2.5 bw-transition-transform bw-duration-300 group-data-[state=closed]/hovercard:bw-rotate-90"})))))))));function Rt({children:e}){return t.createElement(i.HoverCardPortalContent,{side:"right",align:"start",sideOffset:14,alignOffset:-6,className:"bw-p-0",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault()},t.createElement(i.SidebarMenuSub,{className:"bw-w-[195px]"},e))}function Tt({to:e,search:a,children:n}){return void 0!==a?t.createElement(i.SidebarMenuSubItem,null,t.createElement(c.NavLink,{to:{pathname:e,search:a},className:"bw-no-underline"},(({isActive:e})=>t.createElement(Lt,{search:a,isPathActive:e},n)))):t.createElement(i.SidebarMenuSubItem,null,t.createElement(c.NavLink,{to:e,className:"bw-no-underline"},(({isActive:e})=>t.createElement(i.SidebarMenuSubButton,{isActive:e},n))))}function Lt({search:e,isPathActive:a,children:n}){const[r]=c.useSearchParams(),l=r.toString()===e&&a;return t.createElement(i.SidebarMenuSubButton,{isActive:l},n)}function Ht(e){const t=c.useQueryClient();m.useEffect((()=>{e&&e.bookings.forEach((e=>{const a=t.getQueryState(["customers",e.customer_id]);"success"!==(null==a?void 0:a.status)&&t.setQueryData(["customers",e.customer_id],e.customer)}))}),[e])}export{Le as A,ot as B,M as C,Pe as D,st as H,Ke as M,Bt as N,Me as P,je as S,P as _,Te as a,Ye as b,tt as c,Xe as d,Je as e,At as f,He as g,Ot as h,$t as i,jt as j,Rt as k,et as l,Tt as m,$e as n,vt as o,Ht as p,Ae as q,Ie as r,Ge as s,at as t,Re as u,nt as v,rt as w};
